<!doctype html>
<html lang=en>
   <head>
      <meta charset=utf-8>
      <meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1">
      <title>API Reference</title>
      <link rel=icon href=images/bookmark.png>
      <link href=stylesheets/screen.css rel=stylesheet media=screen>
      <link href=stylesheets/print.css rel=stylesheet media=print>
      <link href=stylesheets/highlight-monokai.css rel=stylesheet media=screen,print>
      <script src=javascripts/all.js></script>
   </head>
   <body class="" data-languages="[&#34;json&#34;,&#34;solidity&#34;,&#34;python&#34;]">
      <a href=# id=nav-button>
         <span>NAV <img alt=navbar class=image-navbar src=images/navbar.png></span>
      </a>
      <div class=tocify-wrapper>
         <img alt=logo class=image-logo src=images/logo.png>
         <div class=lang-selector>
            <a href=# data-language-name="json">json</a>
            <a href=# data-language-name="solidity">solidity</a>
            <a href=# data-language-name="python">python</a>
         </div>
         <div class=search>
            <input type=text class=search id=input-search placeholder="Search">
         </div>
         <ul class=search-results></ul>
         <div id=toc></div>
         <ul class=toc-footer>
            <li><a href=https://github.com/center-key/node-slate>node-slate on GitHub</a></li>
            <li><a href=https://www.npmjs.com/package/node-slate>Documentation powered by Slate</a></li>
         </ul>
      </div>
      <div class=page-wrapper>
         <div class=dark-box></div>
         <div class=content>
            <h1 id="derivadex-api">DerivaDEX API</h1>
            <p>DerivaDEX is a decentralized derivatives exchange that combines the performance of centralized exchanges with the security of decentralized exchanges.</p>
            <p>Find us online <a href="https://discord.gg/a54BWuG">Discord</a> | <a href="https://t.me/DerivaDEX">Telegram</a> | <a href="https://medium.com/derivadex">Medium</a></p>
            <h1 id="getting-started">Getting started</h1>
            <p>To begin interacting with the DerivaDEX ecosystem programmatically, you generally will want to follow these steps:</p>
            <ol>
               <li>Deposit funds to the exchange via Ethereum via an Ethereum client (these funds are controlled by you and only you, and are cryptographically secure)</li>
               <li>Run the Auditor client locally (validates the system and serves a local REST and WebSocket API)</li>
               <li>Connect to the local Auditor WebSocket API (subscribe to state and transaction updates propagated in real time from the exchange) &amp; REST API (retrieve state entries)</li>
               <li>Connect to the Operator REST API (submit and cancel orders via <code>commands</code>)</li>
            </ol>
            <p>This set up provides you with the security, integrity, and trust model of a robust decentralized system, with the performance and API experience of a centralized exchange.</p>
            <p>Additionally, it&#39;s a good idea to familiarize yourself with the <a href="#Types">DerivaDEX types terminology</a> and <a href="#signatures--hashing">hashing &amp; signing schemes</a>, although the examples and sample client libraries abstract much of this complexity away.</p>
            <h2 id="auditor-api">Auditor API</h2>
            <p>The pre-packaged Pythonic Auditor connects to the DerivaDEX Operators WebSocket API upon initialization and underpins an extremely powerful, efficient, and easy-to-use setup for programmatic traders by allowing you to:</p>
            <ol>
               <li>validate the honesty and integrity of the exchange&#39;s operations</li>
               <li>use the Auditor as a backend datastore and API to ensure you are verifiably up-to-date with the latest exchange data</li>
            </ol>
            <p><strong>Please be extra careful to always do your own testing and validation of any of this tooling.</strong></p>
            <p>DerivaDEX&#39;s data model is powered by a Sparse Merkle Tree data store and a transaction log of state-modifying transitions. While these are emitted in raw formats by the DerivaDEX Operators API, they are not the most easily-consumable. Thus, the Auditor provides a worthwhile abstraction that efficiently allows you to locally maintain your own data validation while exposing an API for your easy consumption. If you would like to dive deeper into how the Auditor processes the state and raw transactions on DerivaDEX or would like to write your own Auditor tooling (in a different language perhaps, or to expose an interface more to your liking), please check out the <a href="#trader-api--auditor">Operator API &lt;&gt; Auditor</a> section. Otherwise, you are more than welcome to just check out the Setup section to get the Python tooling running and serving your trading needs.</p>
            <h2 id="setup">Setup</h2>
            <h3 id="using-docker">Using Docker</h3>
            <p>The preferred method of running the Auditor is to utilize the published Docker images at the <a href="https://hub.docker.com/repository/docker/derivadex/ddx-auditor">DerivaDEX docker registry</a>. For those who prefer to run the Auditor from source, refer to the <a href="#from-source">From source</a> section. To run the Auditor with docker, follow these steps from the DerivaDEX <code>trading_clients</code> repository (&lt; 5 minutes):</p>
            <ol>
               <li>Clone the DerivaDEX <code>trading_clients</code> repo: <code>git clone git@gitlab.com:derivadex/trading_clients.git</code></li>
               <li>Copy the <code>.config.template.json</code> file into a location of your choosing (we&#39;ll refer to this file path as <code>$CONFIG</code>). Since we&#39;re only discussing the auditor, we will only consider the <code>auditorDeployments</code> section, and you may set <code>mmDeployments</code> and <code>mtDeployments</code> to an empty array (i.e., <code>[]</code>).<ul>
                     <li>A common pattern traders have requested is to host the auditor by itself in a Kubernetes cluster, so there is a special boolean flag here if this is an approach you would like to take as well. This generates slightly different files to accommodate Kubernetes deployments. This is discussed in the <a href="#kubernetes-deployment">section</a> below.</li>
                  </ul>
               </li>
               <li>Generate a docker compose file and environment variables file from the config by running the command <code>python compose_generator.py --config $CONFIG</code> from the root of the repo. Make sure to replace <code>$CONFIG</code> with your config!</li>
            </ol>
            <p>These three steps will generate files that are used by the command below. In the event that you change the configuration file, the old generated files will be overwritten. If this occurs, make sure to use the <code>--remove-orphans</code> flag when tearing the container down.</p>
            <p>You may now deploy the DerivaDEX auditor with the command below:</p>
            <pre class="highlight bash"><code>./compose-generated.bash up -d</code></pre>
            <h3 id="from-source">From source</h3>
            <p>To run the Auditor from source, follow these steps from the DerivaDEX <code>trading_clients</code> repository (&lt; 5 minutes):</p>
            <ol>
               <li>
                  <p>If you don&#39;t already have it, we recommend setting up <a href="https://docs.anaconda.com/anaconda/install/index.html">Anaconda/Python(&gt;3)</a> on your machine</p>
               </li>
               <li>
                  <p>Initialize and activate a Conda environment (located at the root level of the repo) from which you will run the Auditor: <code>conda env create -f environment.yml &amp;&amp; conda activate derivadex</code></p>
               </li>
               <li>
                  <p>Set your PYTHONPATH: <code>export PYTHONPATH=&quot;${PYTHONPATH}:/your/full/path/upto/but/not/including/trading_clients&quot;</code></p>
               </li>
               <li>
                  <p>Navigate to the <code>auditor</code> subdirectory and create an <code>.env-auditor</code> file using the template: <code>cp .env-auditor.template .env-auditor</code></p>
               </li>
               <li>
                  <p>Run the Auditor with: <code>PYTHON_LOG=verbose python auditor_driver.py --config &quot;.env-auditor&quot;</code></p>
               </li>
            </ol>
            <p>You will immediately see logging messages (should be lots of green) with state initialized and transactions streaming through successfully.</p>
            <p>Voila! You now have the Auditor running locally validating the <strong>entire</strong> DerivaDEX exchange, and serving as a local REST &amp; WebSocket API for whatever your trading needs may be!</p>
            <h1 id="command-api-operator">Command API (Operator)</h1>
            <p>Sending commands or requests (placing orders, canceling orders, and withdrawing funds) is something you can do vs. the Operator directly.</p>
            <p>Since commands modify system state, these requests must include an <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-712.md">EIP-712 signature</a>. Examples are included in the <a href="samples.md">sample code</a>.</p>
            <p><strong>Please keep in mind, all sample command requests displayed below are NOT encrypted. The reason for this is to more clearly display the formats of the various commands you may send. You MUST encrypt these messages prior to sending them to the exchange.</strong></p>
            <h2 id="place-order">Place order</h2>
            <h3 id="request">Request</h3>
            <blockquote>
               <p>Request format (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Order&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x603699848c84529987E14Ba32C8a66DEF67E9eCE&quot;</span>,
        <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
        <span class="hljs-attr">&quot;strategy&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
        <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Bid&quot;</span>,
        <span class="hljs-attr">&quot;orderType&quot;</span>: <span class="hljs-string">&quot;Limit&quot;</span>,
        <span class="hljs-attr">&quot;nonce&quot;</span>: <span class="hljs-string">&quot;0x3136313839303336353634383833373230303000000000000000000000000000&quot;</span>,
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-number">487.50</span>,
        <span class="hljs-attr">&quot;stopPrice&quot;</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">&quot;signature&quot;</span>: <span class="hljs-string">&quot;0xd5a1ca6d40a030368710ab86d391e5d16164ea16d2c809894eefddd1658bb08c6898177aa492d4d45272ee41cb40f252327a23e8d1fc2af6904e8860d3f72b3b1b&quot;</span>
    }
}</code></pre>
            <p>You can place new orders by specifying specific attributes in the <code>Order</code> command&#39;s request payload. These requests are subject to a set of validations.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>Command type, which in this case will be <code>Order</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Command contents containing the order being placed</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.traderAddress</td>
                     <td>Trader&#39;s Ethereum address (same as the one that facilitated the deposit)</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.symbol</td>
                     <td>Name of the market to trade. Currently, this is limited to <code>ETHPERP</code>, but new symbols are coming soon!</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.strategy</td>
                     <td>Name of the cross-margined strategy this trade belongs to. Currently, this is limited to the default <code>main</code> strategy, but support for multiple strategies is coming soon!</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.side</td>
                     <td>Side of trade, either <code>Bid</code> (buy/long) or an <code>Ask</code> (sell/short)</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.orderType</td>
                     <td>Order type, either <code>Limit</code> or <code>Market</code>. Other order types coming soon!</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>cc.nonce</td>
                     <td>An incrementing numeric identifier for this request that is unique per user for all time</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>c.amount</td>
                     <td>The order amount/size requested</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>c.price</td>
                     <td>The order price (If <code>orderType</code> is <code>Market</code>, this must be set to <code>0</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>c.stopPrice</td>
                     <td>Currently, always set to <code>0</code> as stops are not implemented.</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.signature</td>
                     <td>EIP-712 signature of the order placement intent</td>
                  </tr>
               </tbody>
            </table>
            <p>To be more explicit, all of these fields must be passed in, even if not all of the fields apply due to certain functionalities not currently implemented (i.e. stops) or the fact that prices aren&#39;t applicable in the case of market orders. Please follow the guidelines specified in the table above around these conditions.</p>
            <h3 id="response">Response</h3>
            <blockquote>
               <p>Receipt (success) format (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Sequenced&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;nonce&quot;</span>: <span class="hljs-string">&quot;0x3136323631383732373739373732303230303000000000000000000000000000&quot;</span>,
        <span class="hljs-attr">&quot;requestHash&quot;</span>: <span class="hljs-string">&quot;0xdfcdd015a63119477e456e48ab16a6324cb4820b99c47d8a0520f1d43834d7ef&quot;</span>,
        <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">54913</span>,
        <span class="hljs-attr">&quot;sender&quot;</span>: <span class="hljs-string">&quot;0xe36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
        <span class="hljs-attr">&quot;enclaveSignature&quot;</span>: <span class="hljs-string">&quot;0x69865fca4901d21c84e1fd9b12b0e6ba4d7f7a885594fa8a1aa4dfdaf0dc7b6f433069b38c7822d215e55b3d46118ed012c874bf524fe73cb6aafe9adb42d3e81c&quot;</span>
    }
}</code></pre>
            <p>A place order <code>command</code> returns a response receipt, which confirms that an Operator has received the request and has sequenced it for processing. The receipt <code>type</code> will be either <code>Sequenced</code> or <code>Error</code>.</p>
            <p>A successful <code>command</code> returns a <code>Sequenced</code> receipt from the Operator. DerivaDEX Operators execute code within a trusted execution environment. The enclaveSignature affirms that this environment has the security guarantees associated with Intel SGX TEEs.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>Message type, which in this case will be <code>Sequenced</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Message contents</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.nonce</td>
                     <td>The same <code>nonce</code> that was passed in the initial request, which can be used to correlate your initial requests with receipts</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.requestHash</td>
                     <td>Hash of the request</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.requestIndex</td>
                     <td>A ticket number which guarantees fair sequencing. All tickets are processed and handled by the exchange in order of this <code>requestIndex</code>.</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.sender</td>
                     <td>The request sender&#39;s Ethereum address</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.enclaveSignature</td>
                     <td>An Operator&#39;s signature which proves secure handling of the request</td>
                  </tr>
               </tbody>
            </table>
            <blockquote>
               <p>Receipt (error) format (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Error&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Error: timeout of 2000ms exceeded&quot;</span>
    }
}</code></pre>
            <p>An erroneous command returns an <code>Error</code> receipt from the Operator.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>msg</td>
                     <td>Error message</td>
                  </tr>
               </tbody>
            </table>
            <h2 id="cancel-order">Cancel order</h2>
            <h3 id="request-1">Request</h3>
            <blockquote>
               <p>Request format (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;CancelOrder&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
        <span class="hljs-attr">&quot;orderHash&quot;</span>: <span class="hljs-string">&quot;0xedee9c27b4fc64a481bd45c145eaf35806d6ad49ca0c68890a00000000000000&quot;</span>,
        <span class="hljs-attr">&quot;nonce&quot;</span>: <span class="hljs-string">&quot;0x3136323635353034303835323735383330303000000000000000000000000000&quot;</span>,
        <span class="hljs-attr">&quot;signature&quot;</span>: <span class="hljs-string">&quot;0xee6c271fc010e25fb28556b39f8999d832485b03335c9c4a5ceca84455ce6bb205483995f5240e62adeb50bda12ed8db67a990c0930e5512709b3bcff4a98ca01b&quot;</span>
    }
}</code></pre>
            <p>You can cancel existing orders by specifying specific attributes in the <code>CancelOrder</code> command&#39;s request payload.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>Command type, which in this case will be <code>CancelOrder</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Command contents containing the order being canceled</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.symbol</td>
                     <td>Currently always <code>ETHPERP</code>. New symbols coming soon!</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.orderHash</td>
                     <td>The first 25 bytes of the order&#39;s unique hash that is being canceled.</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.nonce</td>
                     <td>An incrementing numeric identifier for this request that is unique per user for all time</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.signature</td>
                     <td>EIP-712 signature of the order cancellation request</td>
                  </tr>
               </tbody>
            </table>
            <p>As described in the <code>Signatures &amp; hashing</code> section, the <code>orderHash</code> is something that you construct client-side prior to submitting the order to the exchange. In this regard, you have the <code>orderHash</code> for each order you submit irrespective of acknowledgement from the exchange. However, you likely will fire order cancellations after you have already had acknowledgement of placement receipt from the exchange. You can obtain the order hashes of your open orders using appropriately defined REST requests or WebSocket subscriptions.</p>
            <h3 id="response-1">Response</h3>
            <blockquote>
               <p>Receipt (success) format (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Sequenced&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;nonce&quot;</span>: <span class="hljs-string">&quot;0x3136323635353034303835323735383330303000000000000000000000000000&quot;</span>,
        <span class="hljs-attr">&quot;requestHash&quot;</span>: <span class="hljs-string">&quot;0xdab45fe8ddac0cf1231f79bf4fcbfa847606f45341b446d143b0b0688aa7eed0&quot;</span>,
        <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">108095</span>,
        <span class="hljs-attr">&quot;sender&quot;</span>: <span class="hljs-string">&quot;0xe36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
        <span class="hljs-attr">&quot;enclaveSignature&quot;</span>: <span class="hljs-string">&quot;0x040d24750b994b3603cabb4097093bc310fbfcbe88246501fac4f1d9a441798b20a09eedfdbe52a576cba17ed3986984ba0bfe4a8a3141a525759e7c39f49a441b&quot;</span>
    }
}</code></pre>
            <p>A cancel order <code>command</code> returns a response receipt, which confirms that an Operator has received the request and has sequenced it for processing. The receipt <code>type</code> will be either <code>Sequenced</code> or <code>Error</code>.</p>
            <p>A successful <code>command</code> returns a <code>Received</code> receipt from the Operator. DerivaDEX Operators execute code within a trusted execution environment. The enclaveSignature affirms that this environment has the security guarantees associated with Intel SGX TEEs.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>Message type, which in this case will be <code>Sequenced</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Message contents</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.nonce</td>
                     <td>The same <code>nonce</code> that was passed in the initial request, which can be used to correlate your initial requests with receipts</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.requestHash</td>
                     <td>Hash of the request</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.requestIndex</td>
                     <td>A ticket number which guarantees fair sequencing. All tickets are processed and handled by the exchange in order of this <code>requestIndex</code>.</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.sender</td>
                     <td>The request sender&#39;s Ethereum address</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.enclaveSignature</td>
                     <td>An Operator&#39;s signature which proves secure handling of the request</td>
                  </tr>
               </tbody>
            </table>
            <blockquote>
               <p>Receipt (error) format (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Error&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Error: timeout of 2000ms exceeded&quot;</span>
    }
}</code></pre>
            <p>An erroneous command returns an <code>Error</code> receipt from the Operator.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>msg</td>
                     <td>Error message</td>
                  </tr>
               </tbody>
            </table>
            <h2 id="withdraw">Withdraw</h2>
            <h3 id="request-2">Request</h3>
            <blockquote>
               <p>Request format (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Withdraw&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x603699848c84529987E14Ba32C8a66DEF67E9eCE&quot;</span>,
        <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
        <span class="hljs-attr">&quot;currency&quot;</span>: <span class="hljs-string">&quot;0x41082c820342539de44c1b404fead3b4b39e15d6&quot;</span>,
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-number">440.32</span>,
        <span class="hljs-attr">&quot;nonce&quot;</span>: <span class="hljs-string">&quot;0x3136313839303336353634383833373230303000000000000000000000000000&quot;</span>,
        <span class="hljs-attr">&quot;signature&quot;</span>: <span class="hljs-string">&quot;0xd5a1ca6d40a030368710ab86d391e5d16164ea16d2c809894eefddd1658bb08c6898177aa492d4d45272ee41cb40f252327a23e8d1fc2af6904e8860d3f72b3b1b&quot;</span>
    }
}</code></pre>
            <p>You can signal withdrawal intents to the Operators by specifying specific attributes in the <code>Withdraw</code> command&#39;s request payload. Withdrawal is a 2-step process: submitting a withdrawal intent, and performing a smart contract withdrawal. Once a withdrawal intent is initiated, you won&#39;t be able to trade with the collateral you are attempting to withdraw. You will only be able to formally initiate a smart contract withdrawal/token transfer once the epoch in which you signal your withdrawal desire has concluded.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>Command type, which in this case will be <code>Withdraw</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Command contents containing the withdrawal data</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.traderAddress</td>
                     <td>Trader&#39;s Ethereum address (same as the one that facilitated the deposit)</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.strategyId</td>
                     <td>Name of the cross-margined strategy this withdrawal belongs to. Currently, this is limited to the default <code>main</code> strategy, but support for multiple strategies is coming soon!</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.currency</td>
                     <td>ERC-20 token address being withdrawn</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>c.amount</td>
                     <td>Amount withdrawn (be sure to use the grains format specific to the collateral token being used (e.g. if you wanted to withdraw 1 USDC, you would enter 1000000 since the USDC token contract has 6 decimal places)</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.nonce</td>
                     <td>An incrementing numeric identifier for this request that is unique per user for all time</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.signature</td>
                     <td>EIP-712 signature for the withdrawal request</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="response-2">Response</h3>
            <blockquote>
               <p>Receipt (success) format (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Sequenced&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;nonce&quot;</span>: <span class="hljs-string">&quot;0x3136323631383732373739373732303230303000000000000000000000000000&quot;</span>,
        <span class="hljs-attr">&quot;requestHash&quot;</span>: <span class="hljs-string">&quot;0xdfcdd015a63119477e456e48ab16a6324cb4820b99c47d8a0520f1d43834d7ef&quot;</span>,
        <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">54913</span>,
        <span class="hljs-attr">&quot;sender&quot;</span>: <span class="hljs-string">&quot;0xe36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
        <span class="hljs-attr">&quot;enclaveSignature&quot;</span>: <span class="hljs-string">&quot;0x69865fca4901d21c84e1fd9b12b0e6ba4d7f7a885594fa8a1aa4dfdaf0dc7b6f433069b38c7822d215e55b3d46118ed012c874bf524fe73cb6aafe9adb42d3e81c&quot;</span>
    }
}</code></pre>
            <p>A withdraw <code>command</code> returns a response receipt, which confirms that an Operator has received the request and has sequenced it for processing. The receipt <code>type</code> will be either <code>Received</code> or <code>Error</code>.</p>
            <p>A successful <code>command</code> returns a <code>Received</code> receipt from the Operator. DerivaDEX Operators execute code within a trusted execution environment. The enclaveSignature affirms that this environment has the security guarantees associated with Intel SGX TEEs.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>Message type, which in this case will be <code>Sequenced</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Message contents</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.nonce</td>
                     <td>The same <code>nonce</code> that was passed in the initial request, which can be used to correlate your initial requests with receipts</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.requestHash</td>
                     <td>Hash of the request</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.requestIndex</td>
                     <td>A ticket number which guarantees fair sequencing. All tickets are processed and handled by the exchange in order of this <code>requestIndex</code>.</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.sender</td>
                     <td>The request sender&#39;s Ethereum address</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.enclaveSignature</td>
                     <td>An Operator&#39;s signature which proves secure handling of the request</td>
                  </tr>
               </tbody>
            </table>
            <blockquote>
               <p>Receipt (error) format (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Error&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Error: timeout of 2000ms exceeded&quot;</span>
    }
}</code></pre>
            <p>An erroneous command returns an <code>Error</code> receipt from the Operator.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>msg</td>
                     <td>Error message</td>
                  </tr>
               </tbody>
            </table>
            <h1 id="rest-api-auditor">REST API (Auditor)</h1>
            <p>The local Auditor running exposes a simple REST API for your consumption. The currently available endpoints are described below, but you are of course more than welcome to add your own or modify the Auditor implementation to expose a REST interface that best suits your needs.</p>
            <p>REST endpoint URL (if running using Docker): <a href="http://ddx-auditor:8766">http://ddx-auditor:8766</a> REST endpoint URL (if running using source): <a href="http://localhost:8766">http://localhost:8766</a></p>
            <h2 id="trader">Trader</h2>
            <h3 id="request-3">Request</h3>
            <blockquote>
               <p>Sample Trader REST query</p>
            </blockquote>
            <pre class="highlight json"><code>GET /trader/topic={topic}

e.g. topic = STATE/TRADER/
e.g. topic = STATE/TRADER/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/</code></pre>
            <p>You may obtain the <code>Trader</code> leaf details for any trader address with the following query parameter definition:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>topic</td>
                     <td>Must be of the format <code>STATE/TRADER/[&lt;trader_address&gt;/]</code>. <code>trader_address</code> should be an <code>address_pre_s</code> type.</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="response-3">Response</h3>
            <blockquote>
               <p>Sample trader REST response</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Success&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: [{
        <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/TRADER/0x00a8dda8d7f5310e4a9e24f8eba77e091ac264f872/&quot;</span>,
        <span class="hljs-attr">&quot;c&quot;</span>: {
            <span class="hljs-attr">&quot;freeDDXBalance&quot;</span>: <span class="hljs-string">&quot;2557.077625570776255707&quot;</span>,
            <span class="hljs-attr">&quot;frozenDDXBalance&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
            <span class="hljs-attr">&quot;referralAddress&quot;</span>: <span class="hljs-string">&quot;0x0000000000000000000000000000000000000000&quot;</span>
        }
    }, {
        <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/TRADER/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/&quot;</span>,
        <span class="hljs-attr">&quot;c&quot;</span>: {
            <span class="hljs-attr">&quot;freeDDXBalance&quot;</span>: <span class="hljs-string">&quot;1917.808219178082191778&quot;</span>,
            <span class="hljs-attr">&quot;frozenDDXBalance&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
            <span class="hljs-attr">&quot;referralAddress&quot;</span>: <span class="hljs-string">&quot;0x0000000000000000000000000000000000000000&quot;</span>
        }
    }]
}</code></pre>
            <p>A sample response back is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>Whether HTTP request was successful or not</td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c</td>
                     <td>HTTP response result returning a list of <code>Trader</code> leaves</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c[n]</td>
                     <td>An individual <code>Trader</code> leaf, containing the identifying key information and its contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c[n].t</td>
                     <td><code>Trader</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/TRADER/&lt;trader_address&gt;/</code>. <code>trader_address</code> should be an <code>address_pre_s</code> type.</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c[n].c</td>
                     <td><code>Trader</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c[n].c.freeDDXBalance</td>
                     <td>Trader&#39;s free DDX collateral (available for use on the exchange)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c[n].c.frozenDDXBalance</td>
                     <td>Trader&#39;s frozen DDX collateral (available for withdrawal)</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c[n].c.referralAddress</td>
                     <td>The Ethereum address of the trader who referred this one</td>
                  </tr>
               </tbody>
            </table>
            <h2 id="strategy">Strategy</h2>
            <h3 id="request-4">Request</h3>
            <blockquote>
               <p>Sample Strategy REST query</p>
            </blockquote>
            <pre class="highlight json"><code>GET /strategy/topic={topic}

e.g. topic = STATE/STRATEGY/
e.g. topic = STATE/STRATEGY/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/
e.g. topic = STATE/STRATEGY/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/</code></pre>
            <p>You may obtain the <code>Strategy</code> leaf details for any trader and strategy id with the following query parameter definition:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>topic</td>
                     <td>Must be of the format <code>STATE/STRATEGY/[&lt;trader_address&gt;/][[abbrev_strategy_id_hash]]</code>. <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="response-4">Response</h3>
            <blockquote>
               <p>Sample strategy REST response</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Success&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: [{
        <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/STRATEGY/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
        <span class="hljs-attr">&quot;c&quot;</span>: {
            <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
            <span class="hljs-attr">&quot;freeCollateral&quot;</span>: {
                <span class="hljs-attr">&quot;0xb69e673309512a9d726f87304c6984054f87a93b&quot;</span>: <span class="hljs-string">&quot;1008.334242735906152015&quot;</span>
            },
            <span class="hljs-attr">&quot;frozenCollateral&quot;</span>: {},
            <span class="hljs-attr">&quot;maxLeverage&quot;</span>: <span class="hljs-number">20</span>,
            <span class="hljs-attr">&quot;frozen&quot;</span>: <span class="hljs-literal">false</span>
        }
    }]
}</code></pre>
            <p>A sample response back is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>Whether HTTP request was successful or not</td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c</td>
                     <td>HTTP response result returning a list of <code>Strategy</code> leaves</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c[n]</td>
                     <td>An individual <code>Strategy</code> leaf, containing the identifying key information and its contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c[n].t</td>
                     <td><code>Strategy</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/STRATEGY/&lt;trader_address&gt;/&lt;abbrev_strategy_id_hash&gt;/</code>. <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4 bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c[n].c</td>
                     <td><code>Strategy</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c[n].c.strategyId</td>
                     <td>Cross-margined strategy identifier. Currently only <code>main</code> is supported.</td>
                  </tr>
                  <tr>
                     <td>dict&lt;address_s, decimal_s&gt;</td>
                     <td>c[n].c.freeCollateral</td>
                     <td>Strategy&#39;s free collateral (available for trading) mapping from ERC-20 collateral token address to amount</td>
                  </tr>
                  <tr>
                     <td>dict&lt;address_s, decimal_s&gt;</td>
                     <td>c[n].c.frozenCollateral</td>
                     <td>Strategy&#39;s frozen collateral (available for withdrawal) mapping from ERC-20 collateral token address to amount</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c[n].c.maxLeverage</td>
                     <td>Strategy&#39;s maximum leverage setting</td>
                  </tr>
                  <tr>
                     <td>bool</td>
                     <td>c[n].c.frozen</td>
                     <td>Flag indicating whether strategy is tokenized (<code>true</code>) or not (<code>false</code>). Currently only <code>false</code> is supported</td>
                  </tr>
               </tbody>
            </table>
            <h2 id="position">Position</h2>
            <h3 id="request-5">Request</h3>
            <blockquote>
               <p>Sample Position REST query</p>
            </blockquote>
            <pre class="highlight json"><code>GET /position/topic={topic}

e.g. topic = STATE/POSITION/
e.g. topic = STATE/POSITION/ETHPERP/
e.g. topic = STATE/POSITION/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/
e.g. topic = STATE/POSITION/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/</code></pre>
            <p>You may obtain the <code>Position</code> leaf details for any symbol, chain discriminant, trader, and strategy id with the following query parameter definition:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>topic</td>
                     <td>Must be of the format <code>STATE/POSITION/[&lt;symbol&gt;/][[&lt;trader_address&gt;/]][[[&lt;abbrev_strategy_id_hash&gt;/]]]</code>. <code>symbol</code> is a <code>string</code> type (e.g. <code>ETHPERP</code>), <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4 bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="response-5">Response</h3>
            <blockquote>
               <p>Sample Position REST response</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Success&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: [{
        <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/POSITION/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
        <span class="hljs-attr">&quot;c&quot;</span>: {
            <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Long&quot;</span>,
            <span class="hljs-attr">&quot;balance&quot;</span>: <span class="hljs-string">&quot;0.1&quot;</span>,
            <span class="hljs-attr">&quot;avgEntryPrice&quot;</span>: <span class="hljs-string">&quot;2300&quot;</span>
        }
    }]
}</code></pre>
            <p>A sample response back is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>Whether HTTP request was successful or not</td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c</td>
                     <td>HTTP response result returning a list of <code>Position</code> leaves</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c[n]</td>
                     <td>An individual <code>Position</code> leaf, containing the identifying key information and its contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c[n].t</td>
                     <td><code>Position</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/POSITION/&lt;symbol&gt;/&lt;trader_address&gt;/&lt;abbrev_strategy_id_hash&gt;</code>. <code>symbol</code> is a <code>string</code> type (e.g. <code>ETHPERP</code>), <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c[n].c</td>
                     <td><code>Position</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c[n].c.side</td>
                     <td>Position side (<code>Long</code>, <code>Short</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c[n].c.balance</td>
                     <td>Size of position</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c[n].c.avgEntryPrice</td>
                     <td>Average entry price of position</td>
                  </tr>
               </tbody>
            </table>
            <h2 id="book-order">Book order</h2>
            <h3 id="request-6">Request</h3>
            <blockquote>
               <p>Sample BookOrder REST query</p>
            </blockquote>
            <pre class="highlight json"><code>GET /book_order/topic={topic}

e.g. topic = STATE/BOOK_ORDER/
e.g. topic = STATE/BOOK_ORDER/ETHPERP/
e.g. topic = STATE/BOOK_ORDER/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/
e.g. topic = STATE/BOOK_ORDER/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/</code></pre>
            <p>You may obtain book order information (<code>BookOrder</code> leaves) for any symbol, trader, and strategy id with the following query parameter definition:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>topic</td>
                     <td>Must be of the format <code>STATE/BOOK_ORDER/[&lt;symbol&gt;/][[&lt;trader_address&gt;/]][[[&lt;abbrev_strategy_id_hash&gt;/]]]</code>. <code>symbol</code> is a <code>string</code> type (e.g. <code>ETHPERP</code>), <code>trader_address</code> should be an <code>address_pre_s</code> type, <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
               </tbody>
            </table>
            <p>This endpoint can be used for a variety of use-cases:</p>
            <ul>
               <li>L3 order book: An L3 order book is a granular, order-by-order view of the entire market for any given symbol (i.e. no aggregation). You are welcome to consume this data and aggregate as you see fit. You can obtain this order book view using a topic such as <code>STATE/BOOK_ORDER/ETHPERP/</code>, where <code>ETHPERP</code> is an example market you may be requesting.</li>
               <li>Open orders: You can obtain your open orders for a given trader and strategy via this REST endpoint at any given time using a topic such as <code>STATE/BOOK_ORDER/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/</code>, where <code>0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84</code> is an example Ethereum address prefixed with the chain discriminant you are trading with and <code>0x2576ebd1</code> is the first 4 bytes of the hash of the strategy you are trading from (e.g. <code>main</code>)</li>
            </ul>
            <h3 id="response-6">Response</h3>
            <blockquote>
               <p>Sample BookOrder REST response</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Success&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: [{
        <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/0x56de91db6731ea375171888896c87234f6b2a49513e7890d48/&quot;</span>,
        <span class="hljs-attr">&quot;c&quot;</span>: {
            <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Bid&quot;</span>,
            <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;5.42&quot;</span>,
            <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;2381.92&quot;</span>,
            <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
            <span class="hljs-attr">&quot;strategyIdHash&quot;</span>: <span class="hljs-string">&quot;0x2576ebd1&quot;</span>,
            <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">3</span>
        }
    }, {
        <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/0x67069f8829cbdfa2a0c2b215e80c05482699ac1d1dfb6f4c20/&quot;</span>,
        <span class="hljs-attr">&quot;c&quot;</span>: {
            <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Ask&quot;</span>,
            <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;2&quot;</span>,
            <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;2390&quot;</span>,
            <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
            <span class="hljs-attr">&quot;strategyIdHash&quot;</span>: <span class="hljs-string">&quot;0x2576ebd1&quot;</span>,
            <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">4</span>
        }
    }]
}</code></pre>
            <p>A sample response back is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>Whether HTTP request was successful or not</td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c</td>
                     <td>HTTP response result returning a list of open <code>BookOrder</code> leaves</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c[n]</td>
                     <td>An individual <code>BookOrder</code> leaf, containing the identifying key information and its contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c[n].t</td>
                     <td>Book order topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/BOOK_ORDER/&lt;symbol&gt;/&lt;trader_address&gt;/&lt;abbrev_strategy_id_hash&gt;/&lt;order_hash&gt;/</code>. <code>symbol</code> is a <code>string</code> type (e.g. <code>ETHPERP</code>), <code>trader_address</code> should be an <code>address_pre_s</code> type, <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>), and &#39;order_hash&#39; is a <code>bytes_s</code> type representing the first 25-bytes of the order&#39;s unique hash.</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c[n].c</td>
                     <td><code>BookOrder</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c[n].c.side</td>
                     <td>Order side (<code>Bid</code>, <code>Ask</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c[n].c.amount</td>
                     <td>Size of order</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c[n].c.price</td>
                     <td>Price order is currently resting at</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c[n].c.traderAddress</td>
                     <td>Trader&#39;s Ethereum address (prefixed with the chain discriminant) responsible for this maker order</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c[n].c.strategyIdHash</td>
                     <td>Trader&#39;s abbreviated strategy id hash (first 4 bytes of the hash of the strategy id) responsible for this maker order</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c[n].c.bookOrdinal</td>
                     <td>Numeric sequencing identifier for order, can be used to arrange multiple orders at the same price level in a locally-maintained order book</td>
                  </tr>
               </tbody>
            </table>
            <h1 id="websocket-api-auditor">WebSocket API (Auditor)</h1>
            <p>The local Auditor running exposes a simple WebSocket API for your consumption. The currently available endpoints are described below, but you are of course more than welcome to add your own or modify the Auditor implementation to expose a WebSocket interface that best suits your needs.</p>
            <p>You can use the WebSocket API to receive data per <code>subscriptions</code>. We broadly group them into two categories:</p>
            <ol>
               <li>State events: for when a state/leaf item changes</li>
               <li>Transaction log events: for when a state-changing transaction has been emitted. These events are what triggers state to change.</li>
            </ol>
            <p>WS endpoint URL (if running using Docker): ws://localhost:8765 WS endpoint URL (if running using source): ws://ddx-auditor:8765</p>
            <h2 id="state-events">State events</h2>
            <p>State events can be subscribed to track changes to specific state entries on DerivaDEX.</p>
            <h3 id="trader-1">Trader</h3>
            <p>You may subscribe to updates for any trader&#39;s <code>Trader</code> data.</p>
            <h4 id="request-7">Request</h4>
            <blockquote>
               <p>Sample Trader state subscription (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code><span class="hljs-comment">// All traders</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/TRADER/&quot;</span>
}

<span class="hljs-comment">// Trader for a trader address</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/TRADER/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/&quot;</span>
}</code></pre>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type - must be <code>Subscribe</code></td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c</td>
                     <td>Subscription topic of the format <code>STATE/TRADER/[&lt;trader_address&gt;/]</code>. <code>trader_address</code> should be an <code>address_pre_s</code> type.</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="response-7">Response</h4>
            <h5 id="partial">Partial</h5>
            <blockquote>
               <p>Sample Trader leaf event partial response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/TRADER/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Partial&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;itemData&quot;</span>: [{
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/TRADER/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;freeDDXBalance&quot;</span>: <span class="hljs-string">&quot;2557.077625570776255707&quot;</span>,
                <span class="hljs-attr">&quot;frozenDDXBalance&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;referralAddress&quot;</span>: <span class="hljs-string">&quot;0x0000000000000000000000000000000000000000&quot;</span>
            }
        }, {
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/TRADER/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;freeDDXBalance&quot;</span>: <span class="hljs-string">&quot;639.269406392694063926&quot;</span>,
                <span class="hljs-attr">&quot;frozenDDXBalance&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;referralAddress&quot;</span>: <span class="hljs-string">&quot;0x0000000000000000000000000000000000000000&quot;</span>
            }
        }],
        <span class="hljs-attr">&quot;eventTrigger&quot;</span>: <span class="hljs-literal">null</span>
    }
}</code></pre>
            <p>Upon subscription, you will first receive an initial snapshot of the current trader data. A sample response is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which in the case of a snapshot, will be <code>Partial</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing a snapshot of <code>Trader</code> leaf data based on the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c.itemData</td>
                     <td>Contains a list of the snapshotted <code>Trader</code> leaf data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData[n]</td>
                     <td>An individual <code>Trader</code> leaf as part of the snapshot</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData[n].t</td>
                     <td><code>Trader</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/TRADER/&lt;trader_address&gt;/</code>. <code>trader_address</code> should be an <code>address_pre_s</code> type.</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData[n].c</td>
                     <td><code>Trader</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData[n].c.freeDDXBalance</td>
                     <td>Trader&#39;s free DDX collateral (available for use on the exchange)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData[n].c.frozenDDXBalance</td>
                     <td>Trader&#39;s frozen DDX collateral (available for withdrawal)</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.itemData[n].c.referralAddress</td>
                     <td>The Ethereum address of the trader who referred this one</td>
                  </tr>
               </tbody>
            </table>
            <h5 id="update">Update</h5>
            <blockquote>
               <p>Sample Trader leaf event update response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/TRADER/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Update&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;itemData&quot;</span>: {
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/TRADER/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;freeDDXBalance&quot;</span>: <span class="hljs-string">&quot;1278.538812785388127852&quot;</span>,
                <span class="hljs-attr">&quot;frozenDDXBalance&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;referralAddress&quot;</span>: <span class="hljs-string">&quot;0x0000000000000000000000000000000000000000&quot;</span>
            }
        },
        <span class="hljs-attr">&quot;eventTrigger&quot;</span>: {
            <span class="hljs-attr">&quot;eventType&quot;</span>: <span class="hljs-number">11</span>,
            <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">16823</span>,
            <span class="hljs-attr">&quot;tradeMiningEpochId&quot;</span>: <span class="hljs-number">21</span>,
            <span class="hljs-attr">&quot;ddxDistributed&quot;</span>: <span class="hljs-string">&quot;3196.347031963470319633&quot;</span>,
            <span class="hljs-attr">&quot;totalVolume&quot;</span>: {
                <span class="hljs-attr">&quot;makerVolume&quot;</span>: <span class="hljs-string">&quot;0.1&quot;</span>,
                <span class="hljs-attr">&quot;takerVolume&quot;</span>: <span class="hljs-string">&quot;0.1&quot;</span>
            },
            <span class="hljs-attr">&quot;timeValue&quot;</span>: <span class="hljs-number">2365</span>
        }
    }
}</code></pre>
            <p>After the initial snapshot response, you will receive streaming <code>Update</code> messages with updates to the strategy leaf. A sample response is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which in the case of an update, will be <code>Update</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing the <code>Trader</code> leaf update event data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData</td>
                     <td>Contains the new <code>Trader</code> leaf data</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData.t</td>
                     <td><code>Trader</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/TRADER/&lt;trader_address&gt;/</code>. <code>trader_address</code> should be a <code>address_pre_s</code> type.</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData.c</td>
                     <td><code>Trader</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData.c.freeDDXBalance</td>
                     <td>Trader&#39;s free DDX collateral (available for use on the exchange)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData.c.frozenDDXBalance</td>
                     <td>Trader&#39;s frozen DDX collateral (available for withdrawal)</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.itemData.c.referralAddress</td>
                     <td>The Ethereum address of the trader who referred this one</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.eventTrigger</td>
                     <td>The transaction log event that triggered an update. Since this is an <code>Update</code> response, there will be a transaction log event that triggered it. The possible events that can result in a an update to a strategy are <code>StrategyUpdate</code>, <code>WithdrawDDX</code>, and <code>TradeMining</code>. Please check out each transaction type in these docs for additional information as necessary.</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="strategy-1">Strategy</h3>
            <p>You may subscribe to updates for any trader&#39;s <code>Strategy</code> data.</p>
            <h4 id="request-8">Request</h4>
            <blockquote>
               <p>Sample Strategy state subscription (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code><span class="hljs-comment">// All strategies</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/STRATEGY/&quot;</span>
}

<span class="hljs-comment">// All strategies for a trader address</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/STRATEGY/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/&quot;</span>
}

<span class="hljs-comment">// Strategy for a trader address and strategy id</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/STRATEGY/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>
}</code></pre>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type - must be <code>Subscribe</code></td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c</td>
                     <td>Subscription topic of the format <code>STATE/STRATEGY/[&lt;trader_address&gt;/][[&lt;abbrev_strategy_id_hash&gt;/]]</code>. <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="response-8">Response</h4>
            <h5 id="partial-1">Partial</h5>
            <blockquote>
               <p>Sample Strategy leaf event partial response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/STRATEGY/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Partial&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;itemData&quot;</span>: [{
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/STRATEGY/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
                <span class="hljs-attr">&quot;freeCollateral&quot;</span>: {
                    <span class="hljs-attr">&quot;0xb69e673309512a9d726f87304c6984054f87a93b&quot;</span>: <span class="hljs-string">&quot;108744.388472786563252582&quot;</span>
                },
                <span class="hljs-attr">&quot;frozenCollateral&quot;</span>: {},
                <span class="hljs-attr">&quot;maxLeverage&quot;</span>: <span class="hljs-number">20</span>,
                <span class="hljs-attr">&quot;frozen&quot;</span>: <span class="hljs-literal">false</span>
            }
        }],
        <span class="hljs-attr">&quot;eventTrigger&quot;</span>: <span class="hljs-literal">null</span>
    }
}</code></pre>
            <p>Upon subscription, you will first receive an initial snapshot of the current strategy data. A sample response is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which in the case of a snapshot, will be <code>Partial</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing a snapshot of <code>Strategy</code> leaf data based on the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c.itemData</td>
                     <td>Contains a list of the snapshotted <code>Strategy</code> leaf data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData[n]</td>
                     <td>An individual <code>Strategy</code> leaf as part of the snapshot</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData[n].t</td>
                     <td><code>Strategy</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/STRATEGY/&lt;trader_address&gt;/&lt;abbrev_strategy_id_hash&gt;</code>. <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData[n].c</td>
                     <td><code>Strategy</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData[n].c.strategyId</td>
                     <td>Cross-margined strategy identifier. Currently only <code>main</code> is supported.</td>
                  </tr>
                  <tr>
                     <td>dict&lt;address_s, decimal_s&gt;</td>
                     <td>c.itemData[n].c.freeCollateral</td>
                     <td>Strategy&#39;s free collateral (available for trading) mapping from ERC-20 collateral token address to amount</td>
                  </tr>
                  <tr>
                     <td>dict&lt;address_s, decimal_s&gt;</td>
                     <td>c.itemData[n].c.frozenCollateral</td>
                     <td>Strategy&#39;s free collateral (available for withdrawal) mapping from ERC-20 collateral token address to amount</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.itemData[n].c.maxLeverage</td>
                     <td>Strategy&#39;s maximum leverage setting</td>
                  </tr>
                  <tr>
                     <td>bool</td>
                     <td>c.itemData[n].c.frozen</td>
                     <td>Flag indicating whether strategy is tokenized (<code>true</code>) or not (<code>false</code>). Currently only <code>false</code> is supported</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.eventTrigger</td>
                     <td>The transaction log event that triggered an update. Since this is a <code>Partial</code> response, there is no update, thus will always be null.</td>
                  </tr>
               </tbody>
            </table>
            <h5 id="update-1">Update</h5>
            <blockquote>
               <p>Sample Strategy leaf event update response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/STRATEGY/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Update&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;itemData&quot;</span>: {
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/STRATEGY/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
                <span class="hljs-attr">&quot;freeCollateral&quot;</span>: {
                    <span class="hljs-attr">&quot;0xb69e673309512a9d726f87304c6984054f87a93b&quot;</span>: <span class="hljs-string">&quot;113744.388472786563252582&quot;</span>
                },
                <span class="hljs-attr">&quot;frozenCollateral&quot;</span>: {},
                <span class="hljs-attr">&quot;maxLeverage&quot;</span>: <span class="hljs-number">20</span>,
                <span class="hljs-attr">&quot;frozen&quot;</span>: <span class="hljs-literal">false</span>
            }
        },
        <span class="hljs-attr">&quot;eventTrigger&quot;</span>: {
            <span class="hljs-attr">&quot;eventType&quot;</span>: <span class="hljs-number">5</span>,
            <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">10119</span>,
            <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
            <span class="hljs-attr">&quot;collateralAddress&quot;</span>: <span class="hljs-string">&quot;0xb69e673309512a9d726f87304c6984054f87a93b&quot;</span>,
            <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
            <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;5000&quot;</span>,
            <span class="hljs-attr">&quot;updateType&quot;</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">&quot;txHash&quot;</span>: <span class="hljs-string">&quot;0x2881c07c3f5da89feda42ba5529128d0ffb65c6bbe5459d28295d60748b35da5&quot;</span>
        }
    }
}</code></pre>
            <p>After the initial snapshot response, you will receive streaming <code>Update</code> messages with updates to the strategy leaf. A sample response is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which in the case of an update, will be <code>Update</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing the <code>Strategy</code> leaf update event data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData</td>
                     <td>Contains the new <code>Strategy</code> leaf data</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData.t</td>
                     <td><code>Strategy</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/STRATEGY/&lt;trader_address&gt;/&lt;abbrev_strategy_id_hash&gt;</code>. <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData.c</td>
                     <td><code>Strategy</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData.c.strategyId</td>
                     <td>Cross-margined strategy identifier. Currently only <code>main</code> is supported.</td>
                  </tr>
                  <tr>
                     <td>dict&lt;address_s, decimal_s&gt;</td>
                     <td>c.itemData.c.freeCollateral</td>
                     <td>Strategy&#39;s free collateral (available for trading) mapping from ERC-20 collateral token address to amount</td>
                  </tr>
                  <tr>
                     <td>dict&lt;address_s, decimal_s&gt;</td>
                     <td>c.itemData.c.frozenCollateral</td>
                     <td>Strategy&#39;s free collateral (available for withdrawal) mapping from ERC-20 collateral token address to amount</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.itemData.c.maxLeverage</td>
                     <td>Strategy&#39;s maximum leverage setting</td>
                  </tr>
                  <tr>
                     <td>bool</td>
                     <td>c.itemData.c.frozen</td>
                     <td>Flag indicating whether strategy is tokenized (<code>true</code>) or not (<code>false</code>). Currently only <code>false</code> is supported</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.eventTrigger</td>
                     <td>The transaction log event that triggered an update. Since this is an <code>Update</code> response, there will be a transaction log event that triggered it. The possible events that can result in a an update to a strategy are <code>StrategyUpdate</code>, <code>Withdraw</code>, <code>PartialFill</code> (<code>Fill</code>), <code>CompleteFill</code> (<code>Fill</code>), <code>Liquidation</code>, and <code>Funding</code>. Please check out each transaction type in these docs for additional information as necessary.</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="position-1">Position</h3>
            <p>You may subscribe to updates for any trader&#39;s <code>Position</code> data.</p>
            <h4 id="request-9">Request</h4>
            <blockquote>
               <p>Sample Position state subscription (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code><span class="hljs-comment">// All positions</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/POSITION/&quot;</span>
}

<span class="hljs-comment">// All positions for a symbol</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/POSITION/ETHPERP/&quot;</span>
}

<span class="hljs-comment">// All positions for a symbol and trader address</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/POSITION/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/&quot;</span>
}

<span class="hljs-comment">// All positions for a symbol, trader address, and strategy id</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/POSITION/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>
}</code></pre>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type - must be <code>Subscribe</code></td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c</td>
                     <td>Subscription topic of the format <code>STATE/POSITION/[&lt;symbol&gt;/][[&lt;trader_address&gt;/]][[[&lt;abbrev_strategy_id_hash&gt;/]]]</code>. <code>symbol</code> is of <code>string</code> type (e.g. <code>ETHPERP</code>), <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="response-9">Response</h4>
            <h5 id="partial-2">Partial</h5>
            <blockquote>
               <p>Sample Position leaf event partial response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/POSITION/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Partial&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;itemData&quot;</span>: [{
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/POSITION/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Short&quot;</span>,
                <span class="hljs-attr">&quot;balance&quot;</span>: <span class="hljs-string">&quot;10.13&quot;</span>,
                <span class="hljs-attr">&quot;avgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1946.458727521116845949&quot;</span>
            }
        }],
        <span class="hljs-attr">&quot;eventTrigger&quot;</span>: <span class="hljs-literal">null</span>
    }
}</code></pre>
            <p>Upon subscription, you will first receive an initial snapshot of the current position data. A sample response is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which in the case of a snapshot, will be <code>Partial</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing a snapshot of <code>Position</code> leaf data based on the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c.itemData</td>
                     <td>Contains a list of the snapshotted <code>Position</code> leaf data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData[n]</td>
                     <td>An individual <code>Position</code> leaf as part of the snapshot</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData[n].t</td>
                     <td><code>Position</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/POSITION/&lt;symbol&gt;/&lt;trader_address&gt;/&lt;abbrev_strategy_id_hash&gt;</code>. <code>symbol</code> is of <code>string</code> type, <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData[n].c</td>
                     <td><code>Position</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData[n].c.side</td>
                     <td>Position side (<code>Long</code>, <code>Short</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData[n].c.balance</td>
                     <td>Position size</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData[n].c.avgEntryPrice</td>
                     <td>Position average entry price</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.eventTrigger</td>
                     <td>The transaction log event that triggered an update. Since this is a <code>Partial</code> response, there is no update, thus will always be null.</td>
                  </tr>
               </tbody>
            </table>
            <h5 id="update-2">Update</h5>
            <blockquote>
               <p>Sample Position leaf event update response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/POSITION/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Update&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;itemData&quot;</span>: {
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/POSITION/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Short&quot;</span>,
                <span class="hljs-attr">&quot;balance&quot;</span>: <span class="hljs-string">&quot;11.87&quot;</span>,
                <span class="hljs-attr">&quot;avgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1946.508753983901739634&quot;</span>
            }
        },
        <span class="hljs-attr">&quot;eventTrigger&quot;</span>: {
            <span class="hljs-attr">&quot;eventType&quot;</span>: <span class="hljs-number">14</span>,
            <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">12289</span>,
            <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
            <span class="hljs-attr">&quot;takerOrderHash&quot;</span>: <span class="hljs-string">&quot;0x4a9a3e9b462ca1678df83819c9cd62d65306b967ce9879192a&quot;</span>,
            <span class="hljs-attr">&quot;makerOrderHash&quot;</span>: <span class="hljs-string">&quot;0x4315e691b9b6e7046578823aa59ea0c8f4b96b5e48d2d07f2d&quot;</span>,
            <span class="hljs-attr">&quot;makerOrderRemainingAmount&quot;</span>: <span class="hljs-string">&quot;6.94&quot;</span>,
            <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1.74&quot;</span>,
            <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;1946.8&quot;</span>,
            <span class="hljs-attr">&quot;takerSide&quot;</span>: <span class="hljs-string">&quot;Bid&quot;</span>,
            <span class="hljs-attr">&quot;makerOutcome&quot;</span>: {
                <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
                <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
                <span class="hljs-attr">&quot;fee&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;ddxFeeElection&quot;</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">&quot;realizedPnl&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;newCollateral&quot;</span>: <span class="hljs-string">&quot;999155.746041827306396849&quot;</span>,
                <span class="hljs-attr">&quot;newPositionAvgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1946.508753983901739634&quot;</span>,
                <span class="hljs-attr">&quot;newPositionBalance&quot;</span>: <span class="hljs-string">&quot;11.87&quot;</span>,
                <span class="hljs-attr">&quot;positionSide&quot;</span>: <span class="hljs-string">&quot;Short&quot;</span>
            },
            <span class="hljs-attr">&quot;takerOutcome&quot;</span>: {
                <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x006ecbe1db9ef729cbe972c83fb886247691fb6beb&quot;</span>,
                <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
                <span class="hljs-attr">&quot;fee&quot;</span>: <span class="hljs-string">&quot;6.774864&quot;</span>,
                <span class="hljs-attr">&quot;ddxFeeElection&quot;</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">&quot;realizedPnl&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;newCollateral&quot;</span>: <span class="hljs-string">&quot;99994.506474276943985849&quot;</span>,
                <span class="hljs-attr">&quot;newPositionAvgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1945.889456858208289734&quot;</span>,
                <span class="hljs-attr">&quot;newPositionBalance&quot;</span>: <span class="hljs-string">&quot;4.87&quot;</span>,
                <span class="hljs-attr">&quot;positionSide&quot;</span>: <span class="hljs-string">&quot;Long&quot;</span>
            }
        }
    }
}</code></pre>
            <p>After the initial snapshot response, you will receive streaming <code>Update</code> messages with updates to the <code>Position</code> leaf. A sample response is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which in the case of an update, will be <code>Update</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content containing the updated <code>Position</code> leaf data</td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c.itemData</td>
                     <td>Contains a an entry for the <code>Position</code> leaf data</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData.t</td>
                     <td><code>Position</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/POSITION/&lt;symbol&gt;/&lt;trader_address&gt;/&lt;abbrev_strategy_id_hash&gt;</code>. <code>symbol</code> is of <code>string</code> type, <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData.c</td>
                     <td><code>Position</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData.c.side</td>
                     <td>Position side (<code>Long</code>, <code>Short</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData.c.balance</td>
                     <td>Position size</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData.c.avgEntryPrice</td>
                     <td>Position average entry price</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.eventTrigger</td>
                     <td>The transaction log event that triggered an update. Since this is an <code>Update</code> response, there will be a transaction log event that triggered it. The possible events that can result in a an update to a strategy are <code>PartialFill</code> (<code>Fill</code>), <code>CompleteFill</code> (<code>Fill</code>), and <code>Liquidation</code>. Please check out each transaction type in these docs for additional information as necessary.</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="book-order-1">Book order</h3>
            <p>You may subscribe to updates to orders in the order book.</p>
            <h4 id="request-10">Request</h4>
            <blockquote>
               <p>Sample BookOrder state subscription (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code><span class="hljs-comment">// All book orders</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/&quot;</span>
}

<span class="hljs-comment">// All book orders for a given symbol</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/ETHPERP/&quot;</span>
}

<span class="hljs-comment">// All book orders for a given symbol and trader</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/ETHPERP/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/&quot;</span>
}

<span class="hljs-comment">// All book orders for a given symbol, trader, and strategy</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/ETHPERP/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/0x2576ebd1/&quot;</span>
}</code></pre>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type - must be <code>Subscribe</code></td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c</td>
                     <td>Subscription topic of the format <code>STATE/BOOK_ORDER/[&lt;symbol&gt;/][[&lt;trader_address&gt;/]][[[&lt;abbrev_strategy_id_hash&gt;/]]]</code>. <code>symbol</code> is of <code>string</code> type (e.g. <code>ETHPERP</code>), <code>trader_address</code> should be an <code>address_pre_s</code> type and <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>).</td>
                  </tr>
               </tbody>
            </table>
            <p>Like its REST counterpart, this is endpoint can be used for a variety of purposes. You can subscribe to <code>BookOrder</code> state updates to track:</p>
            <ul>
               <li>L3 order book: An L3 order book is a granular, order-by-order view of the entire market for any given symbol (i.e. no aggregation). You can subscribe to a market&#39;s order book using a topic such as <code>STATE/BOOK_ORDER/ETHPERP</code>, where <code>ETHPERP</code> is an example market you may be requesting. This will send an initial <code>Partial</code> response with all of the <code>BookOrder</code> leaf entries making up the order book, and subsequently, <code>Update</code> messages with any new, canceled, or updated orders in the book. You are welcome to process this data in any local order book data structure you see fit.</li>
               <li>Open orders: You can obtain your open orders in a given strategy using a topic such as <code>STATE/BOOK_ORDER/ETHPERP/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/0x2576ebd1/</code>, where <code>ETHPERP</code> is an example market, <code>0x006ecbe1db9ef729cbe972c83fb886247691fb6beb</code> is an example of your Ethereum address prefixed with the chain discriminant, and <code>0x2576ebd1</code> is an example of the first 4 bytes of the hash of your strategy&#39;s name (in this case, <code>main</code>). This will send an initial <code>Partial</code> response with all of the <code>BookOrder</code> leaf entries corresponding to the open orders in your strategy, and subsequently, <code>Update</code> messages with any new, canceled, or updated orders of yours. You are welcome to process this data however you see fit.</li>
            </ul>
            <h4 id="response-10">Response</h4>
            <h5 id="partial-3">Partial</h5>
            <blockquote>
               <p>Sample BookOrder partial response</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/ETHPERP/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Partial&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;itemData&quot;</span>: [{
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/ETHPERP/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/0x2576ebd1/0x8f9f1044d35dfef941e6af68cbaa183f0794d4dc4317206326/&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Short&quot;</span>,
                <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,
                <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;2057.9926&quot;</span>,
                <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x006ecbe1db9ef729cbe972c83fb886247691fb6beb&quot;</span>,
                <span class="hljs-attr">&quot;strategyIdHash&quot;</span>: <span class="hljs-string">&quot;0x2576ebd1&quot;</span>,
                <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">4</span>
            }
        }, {
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/0xfe3094706dde23aeccba4639715d801c53b58807575efcf285/&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Bid&quot;</span>,
                <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;3.68&quot;</span>,
                <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;2050.92&quot;</span>,
                <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
                <span class="hljs-attr">&quot;strategyIdHash&quot;</span>: <span class="hljs-string">&quot;0x2576ebd1&quot;</span>,
                <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">3</span>
            }
        }],
        <span class="hljs-attr">&quot;eventTrigger&quot;</span>: <span class="hljs-literal">null</span>
    }
}</code></pre>
            <p>Upon subscription, you will first receive an initial snapshot of the orders you have subscribed to. A sample response is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which in the case of a snapshot, will be <code>Partial</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing a snapshot of <code>BookOrder</code> leaf data based on the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c.itemData</td>
                     <td>Contains a list of the snapshotted <code>BookOrder</code> leaf data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData[n]</td>
                     <td>An individual <code>BookOrder</code> leaf as part of the snapshot</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData[n].t</td>
                     <td><code>BookOrder</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/BOOK_ORDER/&lt;symbol&gt;/&lt;trader_address&gt;/&lt;abbrev_strategy_id_hash&gt;/&lt;order_hash&gt;/</code>. <code>symbol</code> is of <code>string</code> type, <code>trader_address</code> should be an <code>address_pre_s</code> type, <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>), and <code>order_hash</code> is of <code>bytes_s</code> type representing the first 25 bytes of the order&#39;s unique hash.</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData[n].c</td>
                     <td><code>BookOrder</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData[n].c.side</td>
                     <td>Order side (<code>Bid</code>, <code>Ask</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData[n].c.amount</td>
                     <td>Order size</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData[n].c.price</td>
                     <td>Order price</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.itemData[n].c.traderAddress</td>
                     <td>The trader&#39;s Ethereum address responsible for this order</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.itemData[n].c.strategyIdHash</td>
                     <td>The trader&#39;s strategy identifier (first 4 bytes of the hash of the strategy, e.g. <code>main</code>) for which this order belongs</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.itemData[n].c.bookOrdinal</td>
                     <td>Numerical identifier signifying the order&#39;s sequencing in the book, can be useful to arrange orders that are at the same level in priority</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.eventTrigger</td>
                     <td>The transaction log event that triggered an update. Since this is a <code>Partial</code> response, there is no update, thus will always be null.</td>
                  </tr>
               </tbody>
            </table>
            <h5 id="update-3">Update</h5>
            <blockquote>
               <p>Sample book order leaf event update response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/ETHPERP/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Update&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;itemData&quot;</span>: {
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;STATE/BOOK_ORDER/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/0x85f483c62fc5a2172db06a3dd322cd89a464bd31ad2408f6d6/&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Bid&quot;</span>,
                <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;14.37&quot;</span>,
                <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;1948.25&quot;</span>,
                <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
                <span class="hljs-attr">&quot;strategyIdHash&quot;</span>: <span class="hljs-string">&quot;0x2576ebd1&quot;</span>,
                <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">6</span>
            }
        },
        <span class="hljs-attr">&quot;eventTrigger&quot;</span>: {
            <span class="hljs-attr">&quot;eventType&quot;</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">13977</span>,
            <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
            <span class="hljs-attr">&quot;orderHash&quot;</span>: <span class="hljs-string">&quot;0x85f483c62fc5a2172db06a3dd322cd89a464bd31ad2408f6d6&quot;</span>,
            <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Bid&quot;</span>,
            <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;14.37&quot;</span>,
            <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;1948.25&quot;</span>,
            <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
            <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
            <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">6</span>
        }
    }
}</code></pre>
            <p>After the initial snapshot response, you will receive streaming <code>Update</code> messages with updates to the <code>BookOrder</code> leaf. A sample response is shown on the right, with fields defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which in the case of a snapshot, will be <code>Partial</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing a snapshot of <code>BookOrder</code> leaf data based on the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData</td>
                     <td>Contains the updated <code>BookOrder</code> leaf data</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData.t</td>
                     <td><code>BookOrder</code> topic (corresponding to its key), containing identifying information. This key is of the format <code>STATE/BOOK_ORDER/&lt;symbol&gt;/&lt;trader_address&gt;/&lt;abbrev_strategy_id_hash&gt;/&lt;order_hash&gt;/</code>. <code>symbol</code> is of <code>string</code> type, <code>trader_address</code> should be an <code>address_pre_s</code> type, <code>abbrev_strategy_id_hash</code> is a <code>bytes_s</code> type representing the first 4-bytes of the hash of the strategy id (e.g. <code>main</code>), and <code>order_hash</code> is of <code>bytes_s</code> type representing the first 25 bytes of the order&#39;s unique hash.</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.itemData.c</td>
                     <td><code>BookOrder</code> leaf contents</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.itemData.c.side</td>
                     <td>Order side (<code>Bid</code>, <code>Ask</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData.c.amount</td>
                     <td>Order size</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.itemData.c.price</td>
                     <td>Order price</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.itemData.c.traderAddress</td>
                     <td>The trader&#39;s Ethereum address responsible for this order</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.itemData.c.strategyIdHash</td>
                     <td>The trader&#39;s strategy identifier (first 4 bytes of the hash of the strategy, e.g. <code>main</code>) for which this order belongs</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.itemData.c.bookOrdinal</td>
                     <td>Numerical identifier signifying the order&#39;s sequencing in the book, can be useful to arrange orders that are at the same level in priority</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.eventTrigger</td>
                     <td>The transaction log event that triggered an update.</td>
                  </tr>
               </tbody>
            </table>
            <h2 id="transaction-log-events">Transaction log events</h2>
            <p>Transaction (oft-abbreviated tx) log events can be subscribed to when seeking to follow all the state-transitioning events taking place on DerivaDEX.</p>
            <h3 id="post">Post</h3>
            <p>You may subscribe to new posted orders on DerivaDEX. A post transaction occurs when an order successfully places an order on the exchange&#39;s order book (with some unmatched amount).</p>
            <h4 id="request-11">Request</h4>
            <blockquote>
               <p>Sample post subscription (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code><span class="hljs-comment">// All posts</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/POST/&quot;</span>
}

<span class="hljs-comment">// All posts for a symbol</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/POST/ETHPERP/&quot;</span>
}

<span class="hljs-comment">// All posts for a symbol and trader address</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/POST/ETHPERP/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/&quot;</span>
}

<span class="hljs-comment">// All posts for a symbol, trader address, and strategy id</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/POST/ETHPERP/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/0x2576ebd1/&quot;</span>
}</code></pre>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type - must be <code>Subscribe</code></td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c</td>
                     <td>Subscription topic of the format <code>TX_LOG/POST/[&lt;symbol&gt;/][[&lt;trader_address&gt;/]][[[&lt;abbrev_strategy_id_hash&gt;/]]]</code>. <code>symbol</code> is of <code>string</code> type (e.g. <code>ETHPERP</code>), <code>trader_address</code> is of <code>address_pre_s</code> type corresponding to the trader&#39;s Ethereum address and <code>abbrev_strategy_id_hash</code> is of <code>bytes_s</code> type corresponding to the first 4 bytes of the hash of the strategy to which this fill belongs (e.g. <code>main</code>).</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="response-11">Response</h4>
            <h5 id="update-4">Update</h5>
            <blockquote>
               <p>Sample post transaction event update response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;TX_LOG/POST/ETHPERP/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Update&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;TX_LOG/POST/ETHPERP/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/0x2576ebd1/&quot;</span>,
        <span class="hljs-attr">&quot;c&quot;</span>: {
            <span class="hljs-attr">&quot;eventType&quot;</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">52623</span>,
            <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
            <span class="hljs-attr">&quot;orderHash&quot;</span>: <span class="hljs-string">&quot;0x24b67dd08a9157b9431a087e892a2cbe1e3258034477af6e8b&quot;</span>,
            <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Bid&quot;</span>,
            <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1.39&quot;</span>,
            <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;2030.25&quot;</span>,
            <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x006ecbe1db9ef729cbe972c83fb886247691fb6beb&quot;</span>,
            <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
            <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">5920</span>
        }
    }
}</code></pre>
            <p>After subscription, you will receive streaming <code>Update</code> messages with new strategy updates defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which will be <code>Update</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing the <code>Post</code> transaction event data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.t</td>
                     <td><code>Post</code> event topic</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.c</td>
                     <td><code>Post</code> event contents</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.eventType</td>
                     <td>Enum value corresponding to this transaction log event type (<code>2=Post</code>)</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.requestIndex</td>
                     <td>Numerical sequencing identifier pertaining to this transaction. All transactions are processed in order of their <code>requestIndex</code>.</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.c.symbol</td>
                     <td>Market this order has been placed on (e.g. <code>ETHPERP</code>)</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.c.orderHash</td>
                     <td>First 25 bytes of the order intent&#39;s unique EIP-712 hash</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.side</td>
                     <td>Side of order (<code>0=bid</code>, <code>1=ask</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.amount</td>
                     <td>Size of order</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.price</td>
                     <td>Price the order has been placed at</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.c.traderAddress</td>
                     <td>Trader&#39;s Ethereum address (prefixed with the chain discriminant) responsible for order placement</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.c.strategyId</td>
                     <td>Cross-margined strategy identifier this order belongs to</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.bookOrdinal</td>
                     <td>Numerical identifier with sequencing implications. You can use this to arrange multiple orders at a given level in a local order book for prioritization.</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="strategy-update">Strategy update</h3>
            <p>You may subscribe to new strategy updates on DerivaDEX. A strategy update can take place when a trader successfully deposits or withdraws a supported collateral type on-chain.</p>
            <h4 id="request-12">Request</h4>
            <blockquote>
               <p>Sample strategy update subscription (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code><span class="hljs-comment">// All strategy updates</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/STRATEGY_UPDATE/&quot;</span>
}

<span class="hljs-comment">// All strategy updates for a trader</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/STRATEGY_UPDATE/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/&quot;</span>
}

<span class="hljs-comment">// All strategy updates for a trader and strategy id</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/STRATEGY_UPDATE/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/0x2576ebd1/&quot;</span>
}</code></pre>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type - must be <code>Subscribe</code></td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c</td>
                     <td>Subscription topic of the format <code>TX_LOG/STRATEGY_UPDATE/[&lt;trader_address&gt;/][[&lt;abbrev_strategy_id_hash&gt;/]]</code>. <code>trader_address</code> is of <code>address_pre_s</code> type corresponding to the trader&#39;s Ethereum address and <code>abbrev_strategy_id_hash</code> is of <code>bytes_s</code> type corresponding to the first 4 bytes of the hash of the strategy to which this fill belongs (e.g. <code>main</code>).</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="response-12">Response</h4>
            <h5 id="update-5">Update</h5>
            <blockquote>
               <p>Sample strategy update transaction event update response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;TX_LOG/STRATEGY_UPDATE/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Update&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;TX_LOG/STRATEGY_UPDATE/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/0x2576ebd1/&quot;</span>,
        <span class="hljs-attr">&quot;c&quot;</span>: {
            <span class="hljs-attr">&quot;eventType&quot;</span>: <span class="hljs-number">5</span>,
            <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">36006</span>,
            <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x006ecbe1db9ef729cbe972c83fb886247691fb6beb&quot;</span>,
            <span class="hljs-attr">&quot;collateralAddress&quot;</span>: <span class="hljs-string">&quot;0xb69e673309512a9d726f87304c6984054f87a93b&quot;</span>,
            <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
            <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1000&quot;</span>,
            <span class="hljs-attr">&quot;updateType&quot;</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">&quot;txHash&quot;</span>: <span class="hljs-string">&quot;0x38d35506f2b75035c14e5ed9fab99edc1d6920bd6c06133b081dfe89c2cb90df&quot;</span>
        }
    }
}</code></pre>
            <p>After subscription, you will receive streaming <code>Update</code> messages with new strategy updates defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which will be <code>Update</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing the <code>StrategyUpdate</code> transaction event data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.t</td>
                     <td><code>StrategyUpdate</code> event topic</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.c</td>
                     <td><code>StrategyUpdate</code> event contents</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.eventType</td>
                     <td>Enum value corresponding to this transaction log event type (<code>5=StrategyUpdate</code>)</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.requestIndex</td>
                     <td>Numerical sequencing identifier pertaining to this transaction. All transactions are processed in order of their <code>requestIndex</code>.</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.c.traderAddress</td>
                     <td>Trader&#39;s Ethereum address (prefixed with the chain discriminant) to which this event belongs to</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.c.collateralAddress</td>
                     <td>Ethereum address of the token being deposited/withdrawn</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.c.strategyId</td>
                     <td>Cross-margined strategy identifier to which this event belongs</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.amount</td>
                     <td>Number of tokens being deposited/withdrawn</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.updateType</td>
                     <td>Enum signifying the type of event (<code>0=deposit</code>, <code>1=withdraw</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.txHash</td>
                     <td>Ethereum transaction hash of the on-chain event</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="price-checkpoint">Price checkpoint</h3>
            <p>You may subscribe to new price updates on DerivaDEX.</p>
            <h4 id="request-13">Request</h4>
            <blockquote>
               <p>Sample price checkpoint subscription (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code><span class="hljs-comment">// All price checkpoints</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/PRICE_CHECKPOINT/&quot;</span>
}

<span class="hljs-comment">// All price checkpoints for a market</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/PRICE_CHECKPOINT/ETHPERP/&quot;</span>
}</code></pre>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type - must be <code>Subscribe</code></td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c</td>
                     <td>Subscription topic of the format <code>TX_LOG/PRICE_CHECKPOINT/[&lt;symbol&gt;/]</code>. <code>symbol</code> is of <code>string</code> type and corresponds to a given market (e.g. <code>ETHPERP</code>).</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="response-13">Response</h4>
            <h5 id="update-6">Update</h5>
            <blockquote>
               <p>Sample price checkpoint transaction event update response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;TX_LOG/PRICE_CHECKPOINT/ETHPERP/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Update&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;TX_LOG/PRICE_CHECKPOINT/ETHPERP/&quot;</span>,
        <span class="hljs-attr">&quot;c&quot;</span>: {
            <span class="hljs-attr">&quot;eventType&quot;</span>: <span class="hljs-number">9</span>,
            <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">15957</span>,
            <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
            <span class="hljs-attr">&quot;ema&quot;</span>: <span class="hljs-string">&quot;0.562806061520606728&quot;</span>,
            <span class="hljs-attr">&quot;indexPriceHash&quot;</span>: <span class="hljs-string">&quot;0xdf08ef420733ecf6055f279cbb296e70925d12ee4e04b945c9da42bfd5f0a3df&quot;</span>,
            <span class="hljs-attr">&quot;indexPrice&quot;</span>: <span class="hljs-string">&quot;1950.64619047619047619&quot;</span>
        }
    }
}</code></pre>
            <p>After subscription, you will receive streaming <code>Update</code> messages with new price checkpoints defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which will be <code>Update</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing the <code>PriceCheckpoint</code> transaction event data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.t</td>
                     <td><code>PriceCheckpoint</code> event topic</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.c</td>
                     <td><code>PriceCheckpoint</code> event contents</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.eventType</td>
                     <td>Enum value corresponding to this transaction log event type (<code>9=PriceCheckpoint</code>)</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.requestIndex</td>
                     <td>Numerical sequencing identifier pertaining to this transaction. All transactions are processed in order of their <code>requestIndex</code>.</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.c.symbol</td>
                     <td>Market for which this price checkpoint corresponds to</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.ema</td>
                     <td>Exponential moving average reflecting the spread between DerivaDEX&#39;s order book and the underlying composite index price</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.c.indexPriceHash</td>
                     <td>Unique hash of the index price</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.indexPrice</td>
                     <td>Composite index price the perpetual is tracking</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="fill">Fill</h3>
            <p>You may subscribe to new fill on DerivaDEX. A fill can take place as part of a <code>CompleteFill</code>, <code>PartialFill</code>, or <code>Liquidation</code> transaction.</p>
            <h4 id="request-14">Request</h4>
            <blockquote>
               <p>Sample price checkpoint subscription (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code><span class="hljs-comment">// All fills</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/FILL/&quot;</span>
}

<span class="hljs-comment">// All fills for a market</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/FILL/ETHPERP/&quot;</span>
}

<span class="hljs-comment">// All fills for a market and trader address</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/FILL/ETHPERP/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/&quot;</span>
}

<span class="hljs-comment">// All fills for a market, trader address, and strategy id</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Subscribe&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;TX_LOG/FILL/ETHPERP/0x006ecbe1db9ef729cbe972c83fb886247691fb6beb/0x2576ebd1/&quot;</span>
}</code></pre>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type - must be <code>Subscribe</code></td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c</td>
                     <td>Subscription topic of the format <code>TX_LOG/FILL/[&lt;symbol&gt;/][[&lt;trader_address&gt;/]][[[&lt;abbrev_strategy_id_hash&gt;/]]]</code>. <code>symbol</code> is of <code>string</code> type and corresponds to a given market (e.g. <code>ETHPERP</code>), <code>trader_address</code> is of <code>address_pre_s</code> type corresponding to the trader&#39;s Ethereum address, and <code>abbrev_strategy_id_hash</code> is of <code>bytes_s</code> type corresponding to the first 4 bytes of the hash of the strategy to which this fill belongs (e.g. <code>main</code>).</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="response-14">Response</h4>
            <h5 id="update-7">Update</h5>
            <blockquote>
               <p>Sample price checkpoint transaction event update response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;TX_LOG/FILL/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
    <span class="hljs-attr">&quot;e&quot;</span>: <span class="hljs-string">&quot;Update&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;TX_LOG/FILL/ETHPERP/0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84/0x2576ebd1/&quot;</span>,
        <span class="hljs-attr">&quot;c&quot;</span>: {
            <span class="hljs-attr">&quot;eventType&quot;</span>: <span class="hljs-number">14</span>,
            <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">16298</span>,
            <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
            <span class="hljs-attr">&quot;takerOrderHash&quot;</span>: <span class="hljs-string">&quot;0xe8adb15982728639fa19a6d00ba6baa763cd7c7fbb339b16f5&quot;</span>,
            <span class="hljs-attr">&quot;makerOrderHash&quot;</span>: <span class="hljs-string">&quot;0x20f5c6ddfae3950dd64b5915686342798bf57278cf8d793ce2&quot;</span>,
            <span class="hljs-attr">&quot;makerOrderRemainingAmount&quot;</span>: <span class="hljs-string">&quot;10.08&quot;</span>,
            <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1.23&quot;</span>,
            <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;1951.6&quot;</span>,
            <span class="hljs-attr">&quot;takerSide&quot;</span>: <span class="hljs-string">&quot;Ask&quot;</span>,
            <span class="hljs-attr">&quot;makerOutcome&quot;</span>: {
                <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
                <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
                <span class="hljs-attr">&quot;fee&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;ddxFeeElection&quot;</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">&quot;realizedPnl&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;newCollateral&quot;</span>: <span class="hljs-string">&quot;999149.891751616220046303&quot;</span>,
                <span class="hljs-attr">&quot;newPositionAvgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1951.6&quot;</span>,
                <span class="hljs-attr">&quot;newPositionBalance&quot;</span>: <span class="hljs-string">&quot;1.23&quot;</span>,
                <span class="hljs-attr">&quot;positionSide&quot;</span>: <span class="hljs-string">&quot;Long&quot;</span>
            },
            <span class="hljs-attr">&quot;takerOutcome&quot;</span>: {
                <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x006ecbe1db9ef729cbe972c83fb886247691fb6beb&quot;</span>,
                <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
                <span class="hljs-attr">&quot;fee&quot;</span>: <span class="hljs-string">&quot;4.800936&quot;</span>,
                <span class="hljs-attr">&quot;ddxFeeElection&quot;</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">&quot;realizedPnl&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;newCollateral&quot;</span>: <span class="hljs-string">&quot;99884.740517241403286802&quot;</span>,
                <span class="hljs-attr">&quot;newPositionAvgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1958.439229330850592231&quot;</span>,
                <span class="hljs-attr">&quot;newPositionBalance&quot;</span>: <span class="hljs-string">&quot;8.23&quot;</span>,
                <span class="hljs-attr">&quot;positionSide&quot;</span>: <span class="hljs-string">&quot;Short&quot;</span>
            }
        }
    }
}</code></pre>
            <p>After subscription, you will receive streaming <code>Update</code> messages with new price checkpoints defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>e</td>
                     <td>Websocket message event, which will be <code>Update</code></td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c</td>
                     <td>Websocket message content, containing the <code>Fill</code> transaction event data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.t</td>
                     <td><code>Fill</code> event topic</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.c</td>
                     <td><code>Fill</code> event contents</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.eventType</td>
                     <td>Enum value corresponding to this transaction log event type (<code>14=Fill</code>)</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.requestIndex</td>
                     <td>Numerical sequencing identifier pertaining to this transaction. All transactions are processed in order of their <code>requestIndex</code>.</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.c.symbol</td>
                     <td>Market for which this fill corresponds to</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.c.takerOrderHash</td>
                     <td>First 25 bytes of the hash of the taker&#39;s order intent</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.c.makerOrderHash</td>
                     <td>First 25 bytes of the hash of the maker&#39;s order intent</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.makerOrderRemainingAmount</td>
                     <td>The remaining size on the maker order</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.amount</td>
                     <td>Size / number of contracts of the fill</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.price</td>
                     <td>Price the fill took place</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.c.takerSide</td>
                     <td>Enum representing the side of the taker order (<code>Bid</code>, <code>Ask</code>)</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.c.makerOutcome</td>
                     <td>Data containing the some relevant information pertaining to the maker in the trade</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.c.makerOutcome.traderAddress</td>
                     <td>Maker trader&#39;s Ethereum address (prefixed with the chain discriminant)</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.c.makerOutcome.strategyId</td>
                     <td>Cross-margined strategy identifier for the maker trader</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.makerOutcome.fee</td>
                     <td>Fees paid by the maker as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>bool</td>
                     <td>c.c.makerOutcome.ddxFeeElection</td>
                     <td>Whether maker fees are being paid in DDX (<code>true</code>) or USDC (<code>false</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.makerOutcome.realizedPNL</td>
                     <td>Realized profits and losses for the maker as a result of the trade (not including fees)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.makerOutcome.newCollateral</td>
                     <td>New free collateral in maker trader&#39;s strategy as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.makerOutcome.newPositionAvgEntryPrice</td>
                     <td>New average entry price for maker&#39;s position as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.makerOutcome.newPositionBalance</td>
                     <td>New size for maker&#39;s position as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.c.makerOutcome.positionSide</td>
                     <td>New side for maker&#39;s position (<code>Long</code>, <code>Short</code>) as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.c.takerOutcome</td>
                     <td>Data containing the some relevant information pertaining to the taker in the trade</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>c.c.takerOutcome.traderAddress</td>
                     <td>Taker trader&#39;s Ethereum address (prefixed with the chain discriminant)</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>c.c.takerOutcome.strategyId</td>
                     <td>Cross-margined strategy identifier for the taker trader</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.takerOutcome.fee</td>
                     <td>Fees paid by the taker as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>bool</td>
                     <td>c.c.takerOutcome.ddxFeeElection</td>
                     <td>Whether taker fees are being paid in DDX (<code>true</code>) or USDC (<code>false</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.takerOutcome.realizedPNL</td>
                     <td>Realized profits and losses for the taker as a result of the trade (not including fees)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.takerOutcome.newCollateral</td>
                     <td>New free collateral in taker trader&#39;s strategy as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.takerOutcome.newPositionAvgEntryPrice</td>
                     <td>New average entry price for taker&#39;s position as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>c.c.takerOutcome.newPositionBalance</td>
                     <td>New size for taker&#39;s position as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.c.takerOutcome.positionSide</td>
                     <td>New side for taker&#39;s position (<code>Long</code>, <code>Short</code>) as a result of the trade</td>
                  </tr>
               </tbody>
            </table>
            <p>Please keep in mind that due to the subscription topic methodology, in the scenario where you don&#39;t specify a particular <code>trader_address</code> and <code>abbrev_strategy_id_hash</code> (e.g. a topic of the format <code>TX_LOG/FILL/ETHPERP/</code>), you will receive 2 <code>fill</code> event responses back on this WebSocket stream per <code>fill</code>, where the two response topics correspond to both the maker and taker&#39;s <code>trader_address</code> and <code>abbrev_strategy_id_hash</code>. You will be able to determine that these <code>fill</code> events are in fact the same by looking at the <code>requestIndex</code> and/or the equivalent pair of <code>makerOutcome</code> and <code>takerOutcome</code> in both events.</p>
            <h1 id="appendix">Appendix</h1>
            <p>The appendix covers some additional information for those of you wanting to dive a bit deeper into some of the above topics.</p>
            <h2 id="types">Types</h2>
            <p>The types labeled throughout this document in the request and response parameters may be familiar to those who have a background in Ethereum. In any case, please refer to the table below for additional information on the terminology used here. This reference in conjunction with the JSON samples should provide enough clarity:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>description</th>
                     <th>example</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>Literal of a sequence of characters surrounded by quotes</td>
                     <td>&quot;ETHPERP&quot;</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>20-byte &quot;0x&quot;-prefixed hexadecimal string literal (i.e. 40 digits long) corresponding to an <code>address</code> ETH type</td>
                     <td>&quot;0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48&quot;</td>
                  </tr>
                  <tr>
                     <td>address_pre_s</td>
                     <td>21-byte &quot;0x&quot;-prefixed hexadecimal string literal (i.e. 42 digits long) corresponding to an <code>address</code> ETH type prefixed with a single byte for the chain discriminant</td>
                     <td>&quot;0x00A0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48&quot;</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>Numerical value with up to, but no more than 18 decimals of precision</td>
                     <td>10.031500000000000000</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>String representation of <code>decimal</code></td>
                     <td>&quot;10.031500000000000000&quot;</td>
                  </tr>
                  <tr>
                     <td>bool</td>
                     <td>Boolean value, either <code>true</code> or <code>false</code></td>
                     <td>True</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>&quot;0x&quot;-prefixed hexadecimal string literal corresponding to a <code>bytes</code> ETH type</td>
                     <td>&quot;0x00000001&quot;</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>32-byte &quot;0x&quot;-prefixed hexadecimal string literal (i.e. 64 digits long) corresponding to an <code>bytes32</code> ETH type</td>
                     <td>&quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;</td>
                  </tr>
                  <tr>
                     <td>timestamp_s_i</td>
                     <td>String representation of numerical UNIX timestamp representing the number of seconds since 1/1/1970</td>
                     <td>&quot;1616667513875&quot;</td>
                  </tr>
                  <tr>
                     <td>timestamp_s</td>
                     <td>String representation representing the ISO 8601 UTC timestamp</td>
                     <td>&quot;2021-03-25T10:38:09.503654&quot;</td>
                  </tr>
               </tbody>
            </table>
            <h2 id="making-a-deposit">Making a deposit</h2>
            <blockquote>
               <p>Deposit ABI (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;inputs&quot;</span>: [
        {
            <span class="hljs-attr">&quot;internalType&quot;</span>: <span class="hljs-string">&quot;address&quot;</span>,
            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;_collateralAddress&quot;</span>,
            <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;address&quot;</span>
        },
        {
            <span class="hljs-attr">&quot;internalType&quot;</span>: <span class="hljs-string">&quot;bytes32&quot;</span>,
            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;_strategyId&quot;</span>,
            <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;bytes32&quot;</span>
        },
        {
            <span class="hljs-attr">&quot;internalType&quot;</span>: <span class="hljs-string">&quot;uint128&quot;</span>,
            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;_amount&quot;</span>,
            <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;uint128&quot;</span>
        }
    ],
    <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;deposit&quot;</span>,
    <span class="hljs-attr">&quot;outputs&quot;</span>: [],
    <span class="hljs-attr">&quot;stateMutability&quot;</span>: <span class="hljs-string">&quot;nonpayable&quot;</span>,
    <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;function&quot;</span>
}</code></pre>
            <blockquote>
               <p>Smart contract deposit function (Solidity)</p>
            </blockquote>
            <pre class="highlight solidity"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deposit</span>(<span class="hljs-params">
    <span class="hljs-keyword">address</span> _collateralAddress,
    <span class="hljs-keyword">bytes32</span> _strategyId,
    <span class="hljs-keyword">uint128</span> _amount
</span>) <span class="hljs-title"><span class="hljs-keyword">external</span></span></span>;</code></pre>
            <blockquote>
               <p>Smart contract deposit function (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> web3 <span class="hljs-keyword">import</span> Web3
<span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single
<span class="hljs-keyword">import</span> simplejson <span class="hljs-keyword">as</span> json

<span class="hljs-comment"># A Web3 instance</span>
w3 = Web3(Web3.HTTPProvider(<span class="hljs-string">&quot;https://kovan.infura.io/v3/&lt;your_api_key&gt;&quot;</span>))

<span class="hljs-comment"># Open up the ABI shown above saved at a file location, in this case `trader_abi.json` is the filename</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;trader_abi.json&#x27;</span>) <span class="hljs-keyword">as</span> f:
    trader_abi = json.load(f)

    <span class="hljs-comment"># Create an trader_abi contract wrapper</span>
    trader_contract = w3.eth.contract(address=Web3.toChecksumAddress(<span class="hljs-string">&#x27;0x80ead6c2d69acc72dad76fb3151820a9b5d6a9e9&#x27;</span>), abi=trader_abi)

    <span class="hljs-comment"># Deposit 1000 USDC</span>
    trader_contract.functions.deposit(<span class="hljs-string">&#x27;0xc4f290a59d66a2e06677ed27422a1106049d9e72&#x27;</span>, encode_single(<span class="hljs-string">&quot;bytes32&quot;</span>, <span class="hljs-string">&#x27;main&#x27;</span>.encode(<span class="hljs-string">&quot;utf8&quot;</span>)), <span class="hljs-number">1000000000</span>).transact()</code></pre>
            <p>DerivaDEX is a decentralized exchange. As such, trading is non-custodial. Users are responsible for their own funds, which are deposited to the DerivaDEX smart contracts on Ethereum for trading.</p>
            <p>To deposit funds on DerivaDEX, first ensure that you have created an Ethereum account. The deposit interaction is between a user and the DerivaDEX smart contracts. To be more explicit, you will not be utilizing the API to facilitate a deposit. The DerivaDEX Solidity smart contracts adhere to the <a href="https://medium.com/derivadex/the-diamond-standard-a-new-paradigm-for-upgradeability-569121a08954">Diamond Standard</a>. The <code>deposit</code> smart contract function you will need to use is located in the <code>Trader</code> facet, at the address of the main <code>DerivaDEX</code> proxy contract (<code>0x80ead6c2d69acc72dad76fb3151820a9b5d6a9e9</code>).</p>
            <p>Note: Valid deposit collateral is curated by the smart contract and is managed by governance.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>_collateralAddress</td>
                     <td>ERC-20 token address deposited as collateral</td>
                  </tr>
                  <tr>
                     <td>_strategyId</td>
                     <td>Strategy ID (encoded as a 32-byte value) being funded. The <code>strategy</code> refers to the cross-margined bucket this trade belongs to. Currently, there is only the default <code>main</code> strategy, but support for multiple strategies is coming soon!</td>
                  </tr>
                  <tr>
                     <td>_amount</td>
                     <td>Amount deposited (be sure to use the grains format specific of the collateral token you are using (e.g. if you wanted to deposit 1 USDC, you would enter 1000000 since the USDC token contract has 6 decimal places)</td>
                  </tr>
               </tbody>
            </table>
            <p>An example Python implementation is displayed on the right, but feel free to utilize whichever language, tooling, and abstractions you see fit.</p>
            <h2 id="signatures--hashing">Signatures &amp; hashing</h2>
            <p>All <a href="#Commands"><code>commands</code></a> on the API must be signed. The payload you will sign using an Ethereum wallet client of your choice (e.g. ethers, web3.js, web3.py, etc.) will need to be hashed as per the EIP-712 standard. We <strong>highly recommend</strong> referring to the <a href="https://eips.ethereum.org/EIPS/eip-712">original proposal</a> for full context, but in short, this standard introduced a framework by which users can securely sign typed structured data. This greatly improves the crypto UX as users can now sign data they see and understand as opposed to unreadable byte-strings. While these benefits may not be readily apparent for programmatic traders, you will need to conform to this standard regardless.</p>
            <p>EIP-712 hashing consists of three critical components - a <code>header</code>, <code>domain</code> struct hash, and <code>message</code> struct hash.</p>
            <h3 id="header">Header</h3>
            <blockquote>
               <p>Sample EIP-191 header definition</p>
            </blockquote>
            <pre class="highlight solidity"><code><span class="hljs-keyword">bytes2</span> eip191_header = <span class="hljs-number">0x1901</span>;</code></pre><pre class="highlight python"><code>eip191_header = <span class="hljs-string">b&quot;\x19\x01&quot;</span></code></pre>
            <p>The <code>header</code> is simply the byte-string <code>\x19\x01</code>. You are welcome to do this however you like, but it must adhere to the standard eventually, otherwise the signature will not ultimately successfully recover. Example Solidity and Python reference implementations are displayed on the right, but feel free to utilize whichever language, tooling, and abstractions you see fit.</p>
            <h3 id="domain">Domain</h3>
            <blockquote>
               <p>Domain separator for kovan. DO NOT modify these parameters.</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;DerivaDEX&quot;</span>,
    <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,
    <span class="hljs-attr">&quot;chainId&quot;</span>:  <span class="hljs-number">42</span>,
    <span class="hljs-attr">&quot;verifyingContract&quot;</span>: <span class="hljs-string">&quot;0x80ead6c2d69acc72dad76fb3151820a9b5d6a9e9&quot;</span>
}</code></pre>
            <blockquote>
               <p>Sample computation of domain struct hash</p>
            </blockquote>
            <pre class="highlight solidity"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compute_eip712_domain_struct_hash</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-keyword">memory</span> _name, <span class="hljs-keyword">string</span> <span class="hljs-keyword">memory</span> _version, <span class="hljs-keyword">uint256</span> _chainId, <span class="hljs-keyword">address</span> _verifyingContract</span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span> <span class="hljs-title"><span class="hljs-keyword">view</span></span> <span class="hljs-title"><span class="hljs-keyword">returns</span></span> (<span class="hljs-params"><span class="hljs-keyword">bytes32</span></span>) </span>{
    <span class="hljs-comment">// keccak-256 hash of the encoded schema for the domain separator</span>
    <span class="hljs-keyword">bytes32</span> domainSchemaHash = <span class="hljs-built_in">keccak256</span>(<span class="hljs-built_in">abi</span>.<span class="hljs-built_in">encodePacked</span>(
        <span class="hljs-string">&quot;EIP712Domain(&quot;</span>,
        <span class="hljs-string">&quot;string name,&quot;</span>,
        <span class="hljs-string">&quot;string version,&quot;</span>,
        <span class="hljs-string">&quot;uint256 chainId,&quot;</span>,
        <span class="hljs-string">&quot;address verifyingContract&quot;</span>,
        <span class="hljs-string">&quot;)&quot;</span>
    ));

    <span class="hljs-keyword">bytes32</span> domainStructHash = <span class="hljs-built_in">keccak256</span>(<span class="hljs-built_in">abi</span>.<span class="hljs-built_in">encodePacked</span>(
        domainSchemaHash,
        <span class="hljs-built_in">keccak256</span>(<span class="hljs-keyword">bytes</span>(_name)),
        <span class="hljs-built_in">keccak256</span>(<span class="hljs-keyword">bytes</span>(_version)),
        _chainId,
        <span class="hljs-keyword">uint256</span>(_verifyingContract)
    ));

    <span class="hljs-keyword">return</span> domainStructHash;
}</code></pre><pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single
<span class="hljs-keyword">from</span> eth_utils.crypto <span class="hljs-keyword">import</span> keccak

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_eip712_domain_struct_hash</span>(<span class="hljs-params">chain_id, verifying_contract</span>):</span>
    <span class="hljs-comment"># keccak-256 hash of the encoded schema for the domain separator</span>
    eip712_domain_separator_schema_hash = keccak(
        <span class="hljs-string">b&quot;EIP712Domain(&quot;</span>
        + <span class="hljs-string">b&quot;string name,&quot;</span>
        + <span class="hljs-string">b&quot;string version,&quot;</span>
        + <span class="hljs-string">b&quot;uint256 chainId,&quot;</span>
        + <span class="hljs-string">b&quot;address verifyingContract&quot;</span>
        + <span class="hljs-string">b&quot;)&quot;</span>
    )

    <span class="hljs-keyword">return</span> keccak(
        eip712_domain_separator_schema_hash
        + keccak(<span class="hljs-string">b&quot;DerivaDEX&quot;</span>)
        + keccak(<span class="hljs-string">b&quot;1&quot;</span>)
        + encode_single(<span class="hljs-string">&#x27;uint256&#x27;</span>, chain_id)
        + encode_single(<span class="hljs-string">&#x27;address&#x27;</span>, verifying_contract)
    )</code></pre>
            <p>The <code>domain</code> is a mandatory field that allows for signature/hashing schemes on one dApp to be unique to itself from other dApps. All <code>commands</code> use the same <code>domain</code> specification. The parameters that comprise the domain are as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>name</td>
                     <td>Name of the dApp or protocol</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>version</td>
                     <td>Current version of the signing domain</td>
                  </tr>
                  <tr>
                     <td>uint256</td>
                     <td>chainId</td>
                     <td>EIP-155 chain ID</td>
                  </tr>
                  <tr>
                     <td>address</td>
                     <td>verifyingContract</td>
                     <td>DerivaDEX smart contract&#39;s Ethereum address</td>
                  </tr>
               </tbody>
            </table>
            <p>To generate the <code>domain</code> struct hash, you must perform a series of encodings and hashings of the schema and contents of the <code>domain</code> specfication. You are welcome to do this however you like, but it must adhere to the standard eventually, otherwise the signature will not ultimately successfully recover. Example Solidity and Python reference implementations are displayed on the right, but feel free to utilize whichever language, tooling, and abstractions you see fit.</p>
            <h3 id="message">Message</h3>
            <p>The <code>message</code> field varies depending on the typed data you are signing, and is illustrated on a case-by-case basis below.</p>
            <h4 id="place-order-1">Place order</h4>
            <blockquote>
               <p>Sample computation of place order message struct hash</p>
            </blockquote>
            <pre class="highlight solidity"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compute_eip712_message_struct_hash</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> _traderAddress, <span class="hljs-keyword">bytes32</span> _symbol, <span class="hljs-keyword">bytes32</span> _strategy, <span class="hljs-keyword">uint256</span> _side, <span class="hljs-keyword">uint256</span> _orderType, <span class="hljs-keyword">bytes32</span> _nonce, <span class="hljs-keyword">uint256</span> _amount, <span class="hljs-keyword">uint256</span> _price, <span class="hljs-keyword">uint256</span> _stopPrice</span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span> <span class="hljs-title"><span class="hljs-keyword">view</span></span> <span class="hljs-title"><span class="hljs-keyword">returns</span></span> (<span class="hljs-params"><span class="hljs-keyword">bytes32</span></span>) </span>{
    <span class="hljs-comment">// keccak-256 hash of the encoded schema for the order params struct</span>
    <span class="hljs-keyword">bytes32</span> eip712SchemaHash = <span class="hljs-built_in">keccak256</span>(<span class="hljs-built_in">abi</span>.<span class="hljs-built_in">encodePacked</span>(
        <span class="hljs-string">&quot;OrderParams(&quot;</span>,
        <span class="hljs-string">&quot;address traderAddress,&quot;</span>,
        <span class="hljs-string">&quot;bytes32 symbol,&quot;</span>,
        <span class="hljs-string">&quot;bytes32 strategy,&quot;</span>,
        <span class="hljs-string">&quot;uint256 side,&quot;</span>,
        <span class="hljs-string">&quot;uint256 orderType,&quot;</span>,
        <span class="hljs-string">&quot;bytes32 nonce,&quot;</span>,
        <span class="hljs-string">&quot;uint256 amount,&quot;</span>,
        <span class="hljs-string">&quot;uint256 price,&quot;</span>,
        <span class="hljs-string">&quot;uint256 stopPrice&quot;</span>,
        <span class="hljs-string">&quot;)&quot;</span>
    ));

    <span class="hljs-keyword">bytes32</span> messageStructHash = <span class="hljs-built_in">keccak256</span>(<span class="hljs-built_in">abi</span>.<span class="hljs-built_in">encodePacked</span>(
        eip712SchemaHash,
        <span class="hljs-keyword">uint256</span>(_traderAddress),
        _symbol,
        _strategy,
        _side,
        _orderType,
        _nonce,
        _amount,
        _price,
        _stopPrice
    ));

    <span class="hljs-keyword">return</span> messageStructHash;
}</code></pre><pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single
<span class="hljs-keyword">from</span> eth_utils.crypto <span class="hljs-keyword">import</span> keccak
<span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal, ROUND_DOWN

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_eip712_message_struct_hash</span>(<span class="hljs-params">trader_address: <span class="hljs-built_in">str</span>, symbol: <span class="hljs-built_in">str</span>, strategy: <span class="hljs-built_in">str</span>, side: <span class="hljs-built_in">str</span>, order_type: <span class="hljs-built_in">str</span>, nonce: <span class="hljs-built_in">str</span>, amount: Decimal, price: Decimal, stop_price: Decimal</span>) -&gt; bytes:</span>
    <span class="hljs-comment"># keccak-256 hash of the encoded schema for the place order command</span>
    eip712_schema_hash = keccak(
        <span class="hljs-string">b&quot;OrderParams(&quot;</span>
        + <span class="hljs-string">b&quot;address traderAddress,&quot;</span>
        + <span class="hljs-string">b&quot;bytes32 symbol,&quot;</span>
        + <span class="hljs-string">b&quot;bytes32 strategy,&quot;</span>
        + <span class="hljs-string">b&quot;uint256 side,&quot;</span>
        + <span class="hljs-string">b&quot;uint256 orderType,&quot;</span>
        + <span class="hljs-string">b&quot;bytes32 nonce,&quot;</span>
        + <span class="hljs-string">b&quot;uint256 amount,&quot;</span>
        + <span class="hljs-string">b&quot;uint256 price,&quot;</span>
        + <span class="hljs-string">b&quot;uint256 stopPrice&quot;</span>
        + <span class="hljs-string">b&quot;)&quot;</span>
    )

    <span class="hljs-comment"># Ensure decimal value has no more than 18 decimals of precision</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">round_to_unit</span>(<span class="hljs-params">val</span>):</span>
        <span class="hljs-keyword">return</span> val.quantize(Decimal(<span class="hljs-string">&quot;.000000000000000001&quot;</span>), rounding=ROUND_DOWN)

    <span class="hljs-comment"># Scale up to DDX grains format (i.e. multiply by 1e18)</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_base_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(round_to_unit(val) * <span class="hljs-number">10</span> ** decimals)

    <span class="hljs-comment"># Convert order side string to int representation</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">order_side_to_int</span>(<span class="hljs-params">order_side: <span class="hljs-built_in">str</span></span>) -&gt; int:</span>
        <span class="hljs-keyword">if</span> order_side == <span class="hljs-string">&#x27;Bid&#x27;</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>

    <span class="hljs-comment"># Convert order type string to int representation</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">order_type_to_int</span>(<span class="hljs-params">order_type: <span class="hljs-built_in">str</span></span>) -&gt; int:</span>
        <span class="hljs-keyword">if</span> order_type == <span class="hljs-string">&#x27;Limit&#x27;</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">elif</span> order_type == <span class="hljs-string">&#x27;Market&#x27;</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>

    <span class="hljs-keyword">return</span> keccak(
        eip712_schema_hash
        + encode_single(<span class="hljs-string">&#x27;address&#x27;</span>, trader_address)
        + <span class="hljs-built_in">len</span>(symbol).to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
        + encode_single(<span class="hljs-string">&quot;bytes32&quot;</span>, symbol.encode(<span class="hljs-string">&quot;utf8&quot;</span>))[:-<span class="hljs-number">1</span>]
        + <span class="hljs-built_in">len</span>(strategy).to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
        + encode_single(<span class="hljs-string">&quot;bytes32&quot;</span>, strategy.encode(<span class="hljs-string">&quot;utf8&quot;</span>))[:-<span class="hljs-number">1</span>]
        + encode_single(<span class="hljs-string">&#x27;uint256&#x27;</span>, order_side_to_int(side))
        + encode_single(<span class="hljs-string">&#x27;uint256&#x27;</span>, order_type_to_int(order_type))
        + encode_single(<span class="hljs-string">&#x27;bytes32&#x27;</span>, <span class="hljs-built_in">bytes</span>.fromhex(nonce[<span class="hljs-number">2</span>:]))
        + encode_single(<span class="hljs-string">&#x27;uint256&#x27;</span>, to_base_unit_amount(amount, <span class="hljs-number">18</span>))
        + encode_single(<span class="hljs-string">&#x27;uint256&#x27;</span>, to_base_unit_amount(price, <span class="hljs-number">18</span>))
        + encode_single(<span class="hljs-string">&#x27;uint256&#x27;</span>, to_base_unit_amount(stop_price, <span class="hljs-number">18</span>))
    )</code></pre>
            <p>The parameters that comprise the <code>message</code> for the <code>command</code> to place an order are as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>address</td>
                     <td>traderAddress</td>
                     <td>Trader&#39;s ETH address used to sign order intent</td>
                  </tr>
                  <tr>
                     <td>bytes32</td>
                     <td>symbol</td>
                     <td>32-byte encoding of the symbol length and symbol this order is for. The <code>symbol</code> of the order you send to the API is a string, however for signing purposes, you must bytes-encode and pad accordingly.</td>
                  </tr>
                  <tr>
                     <td>bytes32</td>
                     <td>strategy</td>
                     <td>32-byte encoding of the strategy length and strategy this order belongs to. The <code>strategy</code> of the order you send to the API is a string, however for signing purposes, you must bytes-encode and pad accordingly. The <code>strategy</code> refers to the cross-margined bucket this trade belongs to. Currently, there is only the default <code>main</code> strategy, but support for multiple strategies is coming soon!</td>
                  </tr>
                  <tr>
                     <td>uint256</td>
                     <td>side</td>
                     <td>An integer value either <code>0</code> (Bid) or <code>1</code> (Ask)</td>
                  </tr>
                  <tr>
                     <td>uint256</td>
                     <td>orderType</td>
                     <td>An integer value either <code>0</code> (Limit) or <code>1</code> (Market)</td>
                  </tr>
                  <tr>
                     <td>bytes32</td>
                     <td>nonce</td>
                     <td>32-byte value (an incrementing numeric identifier that is unique per user for all time) resulting in uniqueness of order</td>
                  </tr>
                  <tr>
                     <td>uint256</td>
                     <td>amount</td>
                     <td>Order amount (scaled up by 18 decimals; e.g. 2.5 =&gt; 2500000000000000000). The <code>amount</code> of the order you send to the API is a decimal, however for signing purposes, you must scale up by 18 decimals and convert to an integer.</td>
                  </tr>
                  <tr>
                     <td>uint256</td>
                     <td>price</td>
                     <td>Order price (scaled up by 18 decimals; e.g. 2001.37 =&gt; 2001370000000000000000). The <code>price</code> of the order you send to the API is a decimal, however for signing purposes, you must scale up by 18 decimals and convert to an integer.</td>
                  </tr>
                  <tr>
                     <td>uint256</td>
                     <td>stopPrice</td>
                     <td>Stop price (scaled up by 18 decimals). The <code>stopPrice</code> of the order you send to the API is a decimal, however for signing purposes, you must scale up by 18 decimals and convert to an integer.</td>
                  </tr>
               </tbody>
            </table>
            <p><strong>Take special note of the transformations done on several fields as described in the table above. In other words, the order intent you submit to the API will have different representations for some fields than the order intent you hash.</strong> You are welcome to do this however you like, but it must adhere to the standard eventually, otherwise the signature will not ultimately successfully recover. Example Solidity and Python reference implementations are displayed on the right, but feel free to utilize whichever language, tooling, and abstractions you see fit.</p>
            <h4 id="cancel-order-1">Cancel order</h4>
            <blockquote>
               <p>Sample computation of cancel order message struct hash</p>
            </blockquote>
            <pre class="highlight solidity"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compute_eip712_message_struct_hash</span>(<span class="hljs-params"><span class="hljs-keyword">bytes32</span> _symbol, <span class="hljs-keyword">bytes32</span> _orderHash, <span class="hljs-keyword">bytes32</span> _nonce</span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span> <span class="hljs-title"><span class="hljs-keyword">view</span></span> <span class="hljs-title"><span class="hljs-keyword">returns</span></span> (<span class="hljs-params"><span class="hljs-keyword">bytes32</span></span>) </span>{
    <span class="hljs-comment">// keccak-256 hash of the encoded schema for the cancel order params struct</span>
    <span class="hljs-keyword">bytes32</span> eip712SchemaHash = <span class="hljs-built_in">keccak256</span>(<span class="hljs-built_in">abi</span>.<span class="hljs-built_in">encodePacked</span>(
        <span class="hljs-string">&quot;CancelOrderParams(&quot;</span>,
        <span class="hljs-string">&quot;bytes32 symbol,&quot;</span>,
        <span class="hljs-string">&quot;bytes32 orderHash,&quot;</span>,
        <span class="hljs-string">&quot;bytes32 nonce&quot;</span>,
        <span class="hljs-string">&quot;)&quot;</span>
    ));

    <span class="hljs-keyword">bytes32</span> messageStructHash = <span class="hljs-built_in">keccak256</span>(<span class="hljs-built_in">abi</span>.<span class="hljs-built_in">encodePacked</span>(
        eip712SchemaHash,
        _symbol,
        _orderHash,
        _nonce,
    ));

    <span class="hljs-keyword">return</span> messageStructHash;
}</code></pre><pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single
<span class="hljs-keyword">from</span> eth_utils.crypto <span class="hljs-keyword">import</span> keccak
<span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal, ROUND_DOWN

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_eip712_message_struct_hash</span>(<span class="hljs-params">symbol: <span class="hljs-built_in">str</span>, order_hash: <span class="hljs-built_in">str</span>, nonce: <span class="hljs-built_in">str</span></span>) -&gt; bytes:</span>
    <span class="hljs-comment"># keccak-256 hash of the encoded schema for the cancel order command</span>
    eip712_schema_hash = keccak(
        <span class="hljs-string">b&quot;CancelOrderParams(&quot;</span>
        + <span class="hljs-string">b&quot;bytes32 symbol,&quot;</span>
        + <span class="hljs-string">b&quot;bytes32 orderHash,&quot;</span>
        + <span class="hljs-string">b&quot;bytes32 nonce&quot;</span>
        + <span class="hljs-string">b&quot;)&quot;</span>
    )

    <span class="hljs-keyword">return</span> keccak(
        eip712_schema_hash
        + <span class="hljs-built_in">len</span>(symbol).to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
        + encode_single(<span class="hljs-string">&quot;bytes32&quot;</span>, symbol.encode(<span class="hljs-string">&quot;utf8&quot;</span>))[:-<span class="hljs-number">1</span>]
        + encode_single(<span class="hljs-string">&quot;bytes32&quot;</span>, <span class="hljs-built_in">bytes</span>.fromhex(order_hash[<span class="hljs-number">2</span>:]))
        + encode_single(<span class="hljs-string">&quot;bytes32&quot;</span>, <span class="hljs-built_in">bytes</span>.fromhex(nonce[<span class="hljs-number">2</span>:]))
    )</code></pre>
            <p>The parameters that comprise the <code>message</code> for the <code>command</code> to cancel an order are as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>bytes32</td>
                     <td>symbol</td>
                     <td>32-byte encoding of the symbol length and symbol this order is for. The <code>symbol</code> of the order you send to the API is a string, however for signing purposes, you must bytes-encode and pad accordingly.</td>
                  </tr>
                  <tr>
                     <td>bytes32</td>
                     <td>orderHash</td>
                     <td>32-byte EIP-712 hash of the order at the time of placement</td>
                  </tr>
                  <tr>
                     <td>bytes32</td>
                     <td>nonce</td>
                     <td>32-byte value (an incrementing numeric identifier that is unique per user for all time) resulting in uniqueness of order cancellation</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="tying-it-all-together">Tying it all together</h3>
            <blockquote>
               <p>Computing the final EIP-712 hash</p>
            </blockquote>
            <pre class="highlight solidity"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compute_eip712_hash</span>(<span class="hljs-params"><span class="hljs-keyword">bytes2</span> _eip191_header, <span class="hljs-keyword">bytes32</span> _domainStructHash, <span class="hljs-keyword">bytes32</span> _messageStructHash</span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span> <span class="hljs-title"><span class="hljs-keyword">view</span></span> <span class="hljs-title"><span class="hljs-keyword">returns</span></span> (<span class="hljs-params"><span class="hljs-keyword">bytes32</span></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">keccak256</span>(<span class="hljs-built_in">abi</span>.<span class="hljs-built_in">encodePacked</span>(
        _eip191_header,
        _domainStructHash,
        _messageStructHash
    ));
}</code></pre><pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_utils.crypto <span class="hljs-keyword">import</span> keccak

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_eip712_hash</span>(<span class="hljs-params">eip191_header: <span class="hljs-built_in">bytes</span>, eip712_domain_struct_hash: <span class="hljs-built_in">bytes</span>, eip712_message_struct_hash: <span class="hljs-built_in">bytes</span></span>) -&gt; str:</span>
    <span class="hljs-comment"># Converting bytes result to a hexadecimal string</span>
    <span class="hljs-keyword">return</span> keccak(
        eip191_header
        + eip712_domain_struct_hash
        + eip712_message_struct_hash
    ).<span class="hljs-built_in">hex</span>()</code></pre>
            <p>To derive the final EIP-712 hash of the typed data you will sign, you will need to <code>keccak256</code> hash the <code>header</code>, <code>eip712_domain_struct_hash</code>, and <code>eip712_message_struct_hash</code> (will vary depending on which <code>command</code> specifically you are sending). You are welcome to do this however you like, but it must adhere to the standard eventually, otherwise the signature will not ultimately successfully recover. Example Solidity and Python reference implementations are displayed on the right, but feel free to utilize whichever language, tooling, and abstractions you see fit.</p>
            <h3 id="samples">Samples</h3>
            <p><strong>Please feel free to use these ground truth samples to validate your EIP-712 hashing implementation for correctness.</strong> For the following samples, assume a <code>chainId = 42</code> and <code>verifyingContract = 0x80ead6c2d69acc72dad76fb3151820a9b5d6a9e9</code>.</p>
            <h4 id="place-order-2">Place order</h4>
            <p>The following sample order placement data results in an EIP-712 hash of: <code>0x6bdd72b4b9ffff78e8faf419cb6e12f9fa9aed99869f55ef2b5f68de6b658345</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>traderAddress</td>
                     <td>&quot;0x4DbaEb213F91B022D0f238a2510380BE149b091a&quot;</td>
                  </tr>
                  <tr>
                     <td>symbol</td>
                     <td>&quot;ETHPERP&quot;</td>
                  </tr>
                  <tr>
                     <td>strategy</td>
                     <td>&quot;main&quot;</td>
                  </tr>
                  <tr>
                     <td>side</td>
                     <td>&quot;Ask&quot;</td>
                  </tr>
                  <tr>
                     <td>orderType</td>
                     <td>&quot;Limit&quot;</td>
                  </tr>
                  <tr>
                     <td>nonce</td>
                     <td>&quot;0x3136323735363831333834363032353830303000000000000000000000000000&quot;</td>
                  </tr>
                  <tr>
                     <td>amount</td>
                     <td>8.4</td>
                  </tr>
                  <tr>
                     <td>price</td>
                     <td>2329.9</td>
                  </tr>
                  <tr>
                     <td>stopPrice</td>
                     <td>0</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="cancel-order-2">Cancel order</h4>
            <p>The following sample cancellation data results in an EIP-712 hash of: <code>0x4e66b356549c78264c084a4b3fdcd542119725e0310db11aec048c0a06d3d250</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>symbol</td>
                     <td>&quot;ETHPERP&quot;</td>
                  </tr>
                  <tr>
                     <td>orderHash</td>
                     <td>&quot;0xff942700e46eb66ca2f8ca53530b57a09579ffa84221149a4400000000000000&quot;</td>
                  </tr>
                  <tr>
                     <td>nonce</td>
                     <td>&quot;0x3136323735363833383437323639313330303000000000000000000000000000&quot;</td>
                  </tr>
               </tbody>
            </table>
            <h2 id="encryption">Encryption</h2>
            <blockquote>
               <p>Sample encryption (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code><span class="hljs-comment">// Sample unencrypted order placement request</span>
{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Order&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0xc10f3E99a255CC053b8E9A62c9C416485fdCd20b&quot;</span>,
        <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
        <span class="hljs-attr">&quot;strategy&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
        <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Ask&quot;</span>,
        <span class="hljs-attr">&quot;orderType&quot;</span>: <span class="hljs-string">&quot;Limit&quot;</span>,
        <span class="hljs-attr">&quot;nonce&quot;</span>: <span class="hljs-string">&quot;0x3136323737363235343138383430383030303000000000000000000000000000&quot;</span>,
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-number">10.6</span>,
        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-number">2472.1</span>,
        <span class="hljs-attr">&quot;stopPrice&quot;</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">&quot;signature&quot;</span>: <span class="hljs-string">&quot;0x1b1f419961c742861a41396f14892ea4a665b7b89086637d37d53ec20364a7ef3aaf1e1472867f5a18fa3f27a2748ed16c603eccd13472cfd61d43df1c3ed22a1b&quot;</span>
    }
}

<span class="hljs-comment">// Sample encrypted order placement request</span>
<span class="hljs-string">&quot;0x3bb4fec9257fb81c846c075fb3944151838c32ce41dadb585049fa7788ae591bb970ea295993d42b238e95595fde09d80d675aa960112533cf61ed4b91b9d77dd3f97d6ecf1cf809800854a11b43d27c5da51d69f550463bddeb471be94fb6a17de3e54cf99665be081ec7f8c24b7eebaef691baa27de167e448ed3a0facf6af0c4fec0e856f56515590c40479cf95f6e25918a42a60b4c15b4362614f91bfbd67eba6a6aad6de9edd45ba5fa7fc33e4473fb9e94a14f492c65bfecc08ff97d7c3126d6ce697aa955234e98ebb027fb042500122c299826267deb278b44a7dfc7f06fad6174f448f4fb41ce13e1003c2013b6de2e9a0bf3d9871658c84644fc41d7e5482bd4efad8370172e64b7220d2a2e596c9a5b3ce38997bae79200b3b62839e47bc6aa876128cb6d4430e18b1f51588d7741161e1a9734d0e203d725c9f4d7dae174a0e75fcdb3882c23590437fbc3330046b150bc90818e7b1c3a42571b62363343f2e46bc7cf6fcd0dfd2550ec83d453641d7a236a3a6677e806125b0c50246d5f26c2db3f61ebc78b955d5095d8b0cd7f4929f5bc2adf53c455b2170f546a09d2e11b463db6cc582a771c6aaad96c3c56123d5010643e584849e6f7cf998495e28b018b4c00bcb64a3aa2b7b7e0cb3faea33c7034887c86a15d5c0a01db2c8bc27a4b6ec2acc2e06ccabde4a64962ab3aec63f36&quot;</span></code></pre>
            <blockquote>
               <p>Sample encryption implementation (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encrypt_with_nonce</span>(<span class="hljs-params">msg: <span class="hljs-built_in">str</span></span>) -&gt; bytes:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    Encrypt the JSON-stringified command contents

    Parameters
    ----------
    msg : str
        JSON-stringified command contents
    &quot;&quot;&quot;</span>

    network_public_key = PublicKey(
        <span class="hljs-built_in">bytes</span>.fromhex(
            <span class="hljs-string">&quot;0x0215cad31f884747d1c870458fea0c8e580044577be35276cbfbf6c212c813e722&quot;</span>[<span class="hljs-number">2</span>:]
        )
    )
    my_secret_key = PrivateKey(get_random_bytes(<span class="hljs-number">32</span>))
    my_public_key = my_secret_key.public_key
    shared_pub = network_public_key.multiply(my_secret_key.secret)
    keccak_256 = keccak.new(digest_bits=<span class="hljs-number">256</span>)
    keccak_256.update(shared_pub.<span class="hljs-built_in">format</span>())
    derived_key = keccak_256.digest()[:<span class="hljs-number">16</span>]
    nonce = get_random_bytes(<span class="hljs-number">12</span>)

    cipher = AES.new(derived_key, AES.MODE_GCM, nonce=nonce)
    encoded_message = msg.encode(<span class="hljs-string">&quot;utf8&quot;</span>)
    ciphertext, tag = cipher.encrypt_and_digest(
        <span class="hljs-built_in">len</span>(encoded_message).to_bytes(<span class="hljs-number">4</span>, byteorder=<span class="hljs-string">&quot;big&quot;</span>) + encoded_message
    )

    <span class="hljs-keyword">return</span> ciphertext + tag + nonce + my_public_key.<span class="hljs-built_in">format</span>()
</code></pre>
            <p>DerivaDEX is a front-running resistant decentralized exchange, achieved with sending encrypted data that can only be decrypted from inside the Operator&#39;s trusted hardware. All <code>commands</code> must be encrypted using an AES-GCM128 scheme. The encryption steps are as follows:</p>
            <ol>
               <li>
                  <p>Generate n 16-byte (128-bit) ECDH shared key using the operator&#39;s public key (<code>0x0215cad31f884747d1c870458fea0c8e580044577be35276cbfbf6c212c813e722</code>) and a 32-byte private key of your choosing (you can randomly generate this each time you are sending a <code>command</code>). Make sure you are using a <code>keccak256</code> ECDH key generation scheme, but since you need a 16-byte shared key, make sure you take only the first 16 bytes of the 32-byte key generated.</p>
               </li>
               <li>
                  <p>Generate a 12-byte random nonce</p>
               </li>
               <li>
                  <p>Setup the payload you want to encrypt, which is the bytes-encoded <code>command</code>&#39;s contents prefixed with a 4-byte value indicating the length of this bytes-encoded <code>command</code>&#39;s contents</p>
               </li>
               <li>
                  <p>Generate the ciphertext and MAC tag using AES-GCM128</p>
               </li>
               <li>
                  <p>Return the encrypted bytes in the format of [ciphertext][tag][nonce][client_public_key_compressed_format]</p>
               </li>
            </ol>
            <p>To validate your encryption implementation for correctness (assuming you are not using the DerivaDEX Python client library), please reference what follows and the display on the right:</p>
            <ul>
               <li>Step 1: Assuming a random client secret key of <code>0xfa2751cb3d428e917226a46141f6d91448e73e07fba672dc2b80de492e6138da</code>, you should arrive at a ECDH shared key of <code>0xc0d7c330fe00314a35751f74260cec81</code></li>
               <li>Step 2: Assume a random nonce of <code>0x64a3aa2b7b7e0cb3faea33c7</code></li>
               <li>Step 3: Assuming a stringified unencrypted order placement message content of the following form <code>{&quot;t&quot;: &quot;Order&quot;, &quot;c&quot;: {&quot;traderAddress&quot;: &quot;0xc10f3E99a255CC053b8E9A62c9C416485fdCd20b&quot;, &quot;symbol&quot;: &quot;ETHPERP&quot;, &quot;strategy&quot;: &quot;main&quot;, &quot;side&quot;: &quot;Ask&quot;, &quot;orderType&quot;: &quot;Limit&quot;, &quot;nonce&quot;: &quot;0x3136323737363235343138383430383030303000000000000000000000000000&quot;, &quot;amount&quot;: 10.6, &quot;price&quot;: 2472.1, &quot;stopPrice&quot;: 0, &quot;signature&quot;: &quot;0x1b1f419961c742861a41396f14892ea4a665b7b89086637d37d53ec20364a7ef3aaf1e1472867f5a18fa3f27a2748ed16c603eccd13472cfd61d43df1c3ed22a1b&quot;}}</code>, you should arrive at a bytes-encoded payload (prefixed with the length) to encrypt of: <code>0x000001b77b2274223a20224f72646572222c202263223a207b2274726164657241646472657373223a2022307863313066334539396132353543433035336238453941363263394334313634383566644364323062222c202273796d626f6c223a202245544850455250222c20227374726174656779223a20226d61696e222c202273696465223a202241736b222c20226f7264657254797065223a20224c696d6974222c20226e6f6e6365223a2022307833313336333233373337333633323335333433313338333833343330333833303330333033303030303030303030303030303030303030303030303030303030222c2022616d6f756e74223a2031302e362c20227072696365223a20323437322e312c202273746f705072696365223a20302c20227369676e6174757265223a2022307831623166343139393631633734323836316134313339366631343839326561346136363562376238393038363633376433376435336563323033363461376566336161663165313437323836376635613138666133663237613237343865643136633630336563636431333437326366643631643433646631633365643232613162227d7d</code></li>
               <li>Step 4: The above will generate a ciphertext of <code>0x3bb4fec9257fb81c846c075fb3944151838c32ce41dadb585049fa7788ae591bb970ea295993d42b238e95595fde09d80d675aa960112533cf61ed4b91b9d77dd3f97d6ecf1cf809800854a11b43d27c5da51d69f550463bddeb471be94fb6a17de3e54cf99665be081ec7f8c24b7eebaef691baa27de167e448ed3a0facf6af0c4fec0e856f56515590c40479cf95f6e25918a42a60b4c15b4362614f91bfbd67eba6a6aad6de9edd45ba5fa7fc33e4473fb9e94a14f492c65bfecc08ff97d7c3126d6ce697aa955234e98ebb027fb042500122c299826267deb278b44a7dfc7f06fad6174f448f4fb41ce13e1003c2013b6de2e9a0bf3d9871658c84644fc41d7e5482bd4efad8370172e64b7220d2a2e596c9a5b3ce38997bae79200b3b62839e47bc6aa876128cb6d4430e18b1f51588d7741161e1a9734d0e203d725c9f4d7dae174a0e75fcdb3882c23590437fbc3330046b150bc90818e7b1c3a42571b62363343f2e46bc7cf6fcd0dfd2550ec83d453641d7a236a3a6677e806125b0c50246d5f26c2db3f61ebc78b955d5095d8b0cd7f4929f5bc2adf53c455b2170f546a09d2e11b463db6cc582a771c6aaad96c3c56123d5010643e5</code> and a tag of <code>0x84849e6f7cf998495e28b018b4c00bcb</code></li>
               <li>Step 5: After deriving the public key from the secret key from Step 1 (<code>0x034887c86a15d5c0a01db2c8bc27a4b6ec2acc2e06ccabde4a64962ab3aec63f36</code>), you will arrive at the final encrypted message of: <code>0x3bb4fec9257fb81c846c075fb3944151838c32ce41dadb585049fa7788ae591bb970ea295993d42b238e95595fde09d80d675aa960112533cf61ed4b91b9d77dd3f97d6ecf1cf809800854a11b43d27c5da51d69f550463bddeb471be94fb6a17de3e54cf99665be081ec7f8c24b7eebaef691baa27de167e448ed3a0facf6af0c4fec0e856f56515590c40479cf95f6e25918a42a60b4c15b4362614f91bfbd67eba6a6aad6de9edd45ba5fa7fc33e4473fb9e94a14f492c65bfecc08ff97d7c3126d6ce697aa955234e98ebb027fb042500122c299826267deb278b44a7dfc7f06fad6174f448f4fb41ce13e1003c2013b6de2e9a0bf3d9871658c84644fc41d7e5482bd4efad8370172e64b7220d2a2e596c9a5b3ce38997bae79200b3b62839e47bc6aa876128cb6d4430e18b1f51588d7741161e1a9734d0e203d725c9f4d7dae174a0e75fcdb3882c23590437fbc3330046b150bc90818e7b1c3a42571b62363343f2e46bc7cf6fcd0dfd2550ec83d453641d7a236a3a6677e806125b0c50246d5f26c2db3f61ebc78b955d5095d8b0cd7f4929f5bc2adf53c455b2170f546a09d2e11b463db6cc582a771c6aaad96c3c56123d5010643e584849e6f7cf998495e28b018b4c00bcb64a3aa2b7b7e0cb3faea33c7034887c86a15d5c0a01db2c8bc27a4b6ec2acc2e06ccabde4a64962ab3aec63f36</code></li>
            </ul>
            <h2 id="operator-api--auditor">Operator API &lt;&gt; Auditor</h2>
            <p>As mentioned in the <a href="#auditor-api">Auditor API</a> section above, the Auditor is an abstraction that exposes a more convenient and familiar API for programmatic traders. It&#39;s connects more directly to the DerivaDEX Operator API&#39;s transaction log WebSocket endpoint. This endpoint provides a snapshot of the Sparse Merkle Tree and streaming transaction&#39;s that transition the state of this data store. Technically, to trade on DerivaDEX you won&#39;t need to understand all of these details as this has been abstracted away using the setup presented above. However, if you are interested in 1) learning more about how the system works, 2) considering rewriting the Auditor, or 3) exploring connecting to the Operator API directly, you should read on to best understand the data you will be working with.</p>
            <h3 id="sparse-merkle-tree-state">Sparse merkle tree (state)</h3>
            <p>DerivaDEX utilizes a <a href="https://medium.com/@kelvinfichter/whats-a-sparse-merkle-tree-acda70aeb837">Sparse Merkle Tree (SMT)</a> in order to efficiently maintain the state of the exchange at all times. Storing data on-chain (such as user&#39;s balances and positions), something most decentralized exchanges do, is very costly and one that is usually passed on to the user, making exchange use prohibitively expensive to most. An SMT, however, allows the system to only store a single root hash (the root of the tree) on-chain, while still allowing for any one to verify the integrity of the data (leaves) through inclusion (or non-inclusion) proofs.</p>
            <p>So what kind of data is stored and where in the SMT? The short answer is - everything. This means any data pertaining to a trader (their account-level data, strategy-level data, positions, and volume statistics), to a given market (the various open orders and the price feed information), and to the system (the insurance fund capitalization) is stored as individual leaf entries in the SMT. The DerivaDEX SMT consists of 2^256 possible leaves, each uniquely located at a specific leaf location (as indicated by its <code>key</code>, which is a 32-byte value). As you might surmise, the <em>vast</em> majority of the SMT will be empty (2^256 is very, <em>very</em>, <em><strong>very</strong></em> large number), but the data that does exist can exist at a location anywhere within these large bounds. For efficient querying and data management (while maintaining practical collision-resistance), the various types of leaf items are prefixed to reside in the same general vicinity as one another. Each leaf item type is described in detail below. The full set of leaf types can be seen in the following table, along with their corresponding numeric discriminants.</p>
            <table>
               <thead>
                  <tr>
                     <th>Item</th>
                     <th>Discriminant</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>Trader</td>
                     <td>0</td>
                  </tr>
                  <tr>
                     <td>Strategy</td>
                     <td>1</td>
                  </tr>
                  <tr>
                     <td>Position</td>
                     <td>2</td>
                  </tr>
                  <tr>
                     <td>BookOrder</td>
                     <td>3</td>
                  </tr>
                  <tr>
                     <td>Price</td>
                     <td>4</td>
                  </tr>
                  <tr>
                     <td>InsuranceFund</td>
                     <td>5</td>
                  </tr>
                  <tr>
                     <td>Stats</td>
                     <td>6</td>
                  </tr>
                  <tr>
                     <td>Member</td>
                     <td>7</td>
                  </tr>
                  <tr>
                     <td>MarketSpecs</td>
                     <td>8</td>
                  </tr>
                  <tr>
                     <td>PriceSource</td>
                     <td>9</td>
                  </tr>
                  <tr>
                     <td>Empty</td>
                     <td>7</td>
                  </tr>
               </tbody>
            </table>
            <p>Each item type is described in detail below.</p>
            <h4 id="trader-2">Trader</h4>
            <p>A <code>Trader</code> contains information pertaining to a trader&#39;s free and frozen DDX balances, and referral address.</p>
            <h5 id="key-encoding--decoding">Key encoding / decoding</h5>
            <blockquote>
               <p>Key encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_abi.utils.padding <span class="hljs-keyword">import</span> zpad32_right

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode_key</span>(<span class="hljs-params">trader_address: <span class="hljs-built_in">str</span></span>):</span>
    <span class="hljs-comment"># ItemType.TRADER == 0</span>
    <span class="hljs-keyword">return</span> zpad32_right(
        ItemType.TRADER.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
        + <span class="hljs-built_in">bytes</span>.fromhex(trader_address[<span class="hljs-number">2</span>:])
    )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_key</span>(<span class="hljs-params">trader_key: <span class="hljs-built_in">bytes</span></span>):</span>
    <span class="hljs-comment"># trader_address</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;0x<span class="hljs-subst">{trader_key[<span class="hljs-number">1</span>:<span class="hljs-number">22</span>].<span class="hljs-built_in">hex</span>()}</span>&quot;</span></code></pre>
            <p>The location of a <code>Trader</code> leaf is determined by its key, which is encoded as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>Bytes</th>
                     <th>Value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>0</td>
                     <td>Trader discriminant</td>
                  </tr>
                  <tr>
                     <td>[1, 21]</td>
                     <td>Trader&#39;s Ethereum address prefixed with the chain discriminant</td>
                  </tr>
                  <tr>
                     <td>[22, 31]</td>
                     <td>Zero-padding</td>
                  </tr>
               </tbody>
            </table>
            <p>The following sample <code>Trader</code> materials generates the following encoded key: <code>0x0000603699848c84529987e14ba32c8a66def67e9ece00000000000000000000</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>trader_address</td>
                     <td>&quot;0x00603699848c84529987E14Ba32C8a66DEF67E9eCE&quot;</td>
                  </tr>
               </tbody>
            </table>
            <h5 id="value-definition">Value definition</h5>
            <blockquote>
               <p>Value encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal, ROUND_DOWN
<span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">round_to_unit</span>(<span class="hljs-params">val</span>):</span>
    <span class="hljs-keyword">return</span> val.quantize(Decimal(<span class="hljs-string">&quot;.000000000000000001&quot;</span>), rounding=ROUND_DOWN)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_base_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(round_to_unit(val) * <span class="hljs-number">10</span> ** decimals)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> Decimal(<span class="hljs-built_in">str</span>(val)) / <span class="hljs-number">10</span> ** decimals

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_encoded_value</span>(<span class="hljs-params">self, free_ddx_balance: Decimal, frozen_ddx_balance: Decimal, referral_address: <span class="hljs-built_in">str</span></span>):</span>
    <span class="hljs-comment"># Trader item discriminant</span>
    item_type = <span class="hljs-number">0</span>

    <span class="hljs-comment"># Scale collateral amounts to DDX grains (to_base_unit_amount</span>
    <span class="hljs-keyword">return</span> encode_single(
        <span class="hljs-string">&quot;(uint8,(uint128,uint128,address))&quot;</span>,
        [
            self.item_type,
            [
                to_base_unit_amount(free_ddx_balance, <span class="hljs-number">18</span>),
                to_base_unit_amount(frozen_ddx_balance, <span class="hljs-number">18</span>),
                self.referral_address,
            ],
        ],
    )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_decoded_value</span>(<span class="hljs-params">abi_encoded_value: <span class="hljs-built_in">str</span></span>):</span>
    (
        item_type,
        (free_ddx_balance, frozen_ddx_balance, referral_address),
    ) = decode_single(
        <span class="hljs-string">&quot;(uint8,(uint128,uint128,address))&quot;</span>, w3.toBytes(hexstr=abi_encoded_value),
    )

    <span class="hljs-comment"># Scale collateral amounts from DDX grains</span>
    <span class="hljs-keyword">return</span> (
        to_unit_amount(free_ddx_balance, <span class="hljs-number">18</span>),
        to_unit_amount(frozen_ddx_balance, <span class="hljs-number">18</span>),
        referral_address,
    )</code></pre>
            <p>A <code>Trader</code> leaf holds the following data:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>decimal</td>
                     <td>free_ddx_balance</td>
                     <td>DDX collateral available for staking/fees</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>frozen_ddx_balance</td>
                     <td>DDX collateral available for on-chain withdrawal</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>referral_address</td>
                     <td>Referral address pertaining to the Ethereum address who referred this trader (if applicable)</td>
                  </tr>
               </tbody>
            </table>
            <p>These contents are always stored in the tree in ABI-encoded form: <code>(uint8,(uint128,uint128,address))</code>. Meaning, you will want to decode the contents into a more suitable form for your purposes as necessary (for example loading data from a snapshot of the state), and will need to encode it back again if you are saving it back into the tree. A sample of Python code that derives this ABI-encoding, including the DDX grains conversion (10 ** 18) for certain variables, is shown on the right.</p>
            <p>The following sample <code>Trader</code> materials generates the following ABI-encoded value: <code>0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003635c9adc5dea000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a8dda8d7f5310e4a9e24f8eba77e091ac264f872</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>free_ddx_balance</td>
                     <td>1000</td>
                  </tr>
                  <tr>
                     <td>frozen_ddx_balance</td>
                     <td>0</td>
                  </tr>
                  <tr>
                     <td>referral_address</td>
                     <td>&quot;0xA8dDa8d7F5310E4A9E24F8eBA77E091Ac264f872&quot;</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="strategy-2">Strategy</h4>
            <p>A <code>Strategy</code> contains information pertaining to a trader&#39;s cross-margined strategy, such as their free and frozen collaterals and max leverage.</p>
            <h5 id="key-encoding--decoding-1">Key encoding / decoding</h5>
            <blockquote>
               <p>Key encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_abi.utils.padding <span class="hljs-keyword">import</span> zpad32_right, encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_strategy_id_hash</span>(<span class="hljs-params">strategy_id: <span class="hljs-built_in">str</span></span>) -&gt; bytes:</span>
    <span class="hljs-comment"># Get the first 4 bytes of the hash of the strategy id</span>
    <span class="hljs-keyword">return</span> w3.keccak(
        <span class="hljs-built_in">len</span>(strategy_id).to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
        + encode_single(<span class="hljs-string">&quot;bytes32&quot;</span>, strategy_id.encode(<span class="hljs-string">&quot;utf8&quot;</span>))[:-<span class="hljs-number">1</span>]
    )[:<span class="hljs-number">4</span>]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode_key</span>(<span class="hljs-params">trader_address: <span class="hljs-built_in">str</span>, strategy_id: <span class="hljs-built_in">str</span>, chain_discriminant: <span class="hljs-built_in">int</span></span>):</span>
    <span class="hljs-comment"># ItemType.STRATEGY == 1</span>
    <span class="hljs-keyword">return</span> zpad32_right(
            ItemType.STRATEGY.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
            + <span class="hljs-built_in">bytes</span>.fromhex(trader_address[<span class="hljs-number">2</span>:])
            + generate_strategy_id_hash(strategy_id)
        )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_key</span>(<span class="hljs-params">strategy_key: <span class="hljs-built_in">bytes</span></span>):</span>
    <span class="hljs-comment"># trader_address, strategy_id_hash</span>
    <span class="hljs-keyword">return</span> (
            <span class="hljs-string">f&quot;0x<span class="hljs-subst">{strategy_key[<span class="hljs-number">1</span>:<span class="hljs-number">22</span>].<span class="hljs-built_in">hex</span>()}</span>&quot;</span>,
            <span class="hljs-string">f&quot;0x<span class="hljs-subst">{strategy_key[<span class="hljs-number">22</span>:<span class="hljs-number">26</span>].<span class="hljs-built_in">hex</span>()}</span>&quot;</span>,
        )</code></pre>
            <p>The location of a <code>Strategy</code> leaf is determined by its key, which is encoded as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>Bytes</th>
                     <th>Value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>0</td>
                     <td>Strategy discriminant</td>
                  </tr>
                  <tr>
                     <td>[1, 21]</td>
                     <td>Trader&#39;s Ethereum address prefixed with the chain discriminant</td>
                  </tr>
                  <tr>
                     <td>[22, 25]</td>
                     <td>Abbreviated hash of strategy ID</td>
                  </tr>
                  <tr>
                     <td>[26, 25]</td>
                     <td>Zero-padding</td>
                  </tr>
               </tbody>
            </table>
            <p>The following sample <code>Strategy</code> materials generates the following encoded key: <code>0x0100603699848c84529987e14ba32c8a66def67e9ece2576ebd1000000000000</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>trader_address</td>
                     <td>&quot;0x00603699848c84529987E14Ba32C8a66DEF67E9eCE&quot;</td>
                  </tr>
                  <tr>
                     <td>strategy_id</td>
                     <td>&quot;main&quot;</td>
                  </tr>
               </tbody>
            </table>
            <h5 id="value-definition-1">Value definition</h5>
            <blockquote>
               <p>Value encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict
<span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal, ROUND_DOWN
<span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">round_to_unit</span>(<span class="hljs-params">val</span>):</span>
    <span class="hljs-keyword">return</span> val.quantize(Decimal(<span class="hljs-string">&quot;.000000000000000001&quot;</span>), rounding=ROUND_DOWN)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_base_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(round_to_unit(val) * <span class="hljs-number">10</span> ** decimals)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_base_unit_amount_list</span>(<span class="hljs-params">vals, decimals</span>):</span>
    <span class="hljs-keyword">return</span> [to_base_unit_amount(val, decimals) <span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> vals]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> Decimal(<span class="hljs-built_in">str</span>(val)) / <span class="hljs-number">10</span> ** decimals

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_unit_amount_list</span>(<span class="hljs-params">vals, decimals</span>):</span>
    <span class="hljs-keyword">return</span> [to_unit_amount(val, decimals) <span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> vals]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_encoded_value</span>(<span class="hljs-params">self, strategy_id: <span class="hljs-built_in">str</span>, free_collateral: Dict[<span class="hljs-built_in">str</span>, Decimal], frozen_collateral: Dict[<span class="hljs-built_in">str</span>, Decimal], max_leverage: <span class="hljs-built_in">int</span>, frozen: <span class="hljs-built_in">bool</span></span>):</span>
    <span class="hljs-comment"># Strategy item discriminant</span>
    item_type = <span class="hljs-number">1</span>

    <span class="hljs-comment"># Scale collateral amounts to DDX grains</span>
    <span class="hljs-keyword">return</span> encode_single(
        <span class="hljs-string">&quot;((uint8,(bytes32,(address[],uint128[]),(address[],uint128[]),uint64,bool)))&quot;</span>,
        [
            [
                item_type,
                [
                    <span class="hljs-built_in">len</span>(strategy_id).to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
                    + encode_single(<span class="hljs-string">&quot;bytes32&quot;</span>, strategy_id.encode(<span class="hljs-string">&quot;utf8&quot;</span>))[
                        :-<span class="hljs-number">1</span>
                    ],
                    [
                        <span class="hljs-built_in">list</span>(free_collateral.keys()),
                        to_base_unit_amount_list(
                            <span class="hljs-built_in">list</span>(free_collateral.values()), <span class="hljs-number">18</span>
                        ),
                    ],
                    [
                        <span class="hljs-built_in">list</span>(frozen_collateral.keys()),
                        to_base_unit_amount_list(
                            <span class="hljs-built_in">list</span>(frozen_collateral.values()), <span class="hljs-number">18</span>
                        ),
                    ],
                    max_leverage,
                    frozen,
                ],
            ]
        ],
    )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_decoded_value</span>(<span class="hljs-params">abi_encoded_value: <span class="hljs-built_in">str</span></span>):</span>
    (
        (
            item_type,
            (
                strategy_id,
                (free_collateral_tokens, free_collateral_amounts),
                (frozen_collateral_tokens, frozen_collateral_amounts),
                max_leverage,
                frozen,
            ),
        ),
    ) = decode_single(
        <span class="hljs-string">&quot;((uint8,(bytes32,(address[],uint128[]),(address[],uint128[]),uint64,bool)))&quot;</span>,
        w3.toBytes(hexstr=abi_encoded_value),
    )

    <span class="hljs-comment"># Scale collateral amounts from DDX grains</span>
    <span class="hljs-keyword">return</span> (
        strategy_id[<span class="hljs-number">1</span> : <span class="hljs-number">1</span> + strategy_id[<span class="hljs-number">0</span>]].decode(<span class="hljs-string">&quot;utf8&quot;</span>),
        {
            k: to_unit_amount(v, <span class="hljs-number">18</span>)
            <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(
                <span class="hljs-built_in">list</span>(free_collateral_tokens), <span class="hljs-built_in">list</span>(free_collateral_amounts)
            )
        },
        {
            k: to_unit_amount(v, <span class="hljs-number">18</span>)
            <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(
                <span class="hljs-built_in">list</span>(frozen_collateral_tokens), <span class="hljs-built_in">list</span>(frozen_collateral_amounts)
            )
        },
        max_leverage,
        frozen,
    )</code></pre>
            <p>A <code>Strategy</code> leaf holds the following data:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>strategy_id</td>
                     <td>Identifier for strategy (e.g. &quot;main&quot;)</td>
                  </tr>
                  <tr>
                     <td>dict&lt;address_s, decimal&gt;</td>
                     <td>free_collateral</td>
                     <td>Mapping of collateral address to free collateral amount</td>
                  </tr>
                  <tr>
                     <td>dict&lt;address_s, decimal&gt;</td>
                     <td>frozen_collateral</td>
                     <td>Mapping of collateral address to frozen collateral amount</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>max_leverage</td>
                     <td>Maximum leverage strategy can take</td>
                  </tr>
                  <tr>
                     <td>bool</td>
                     <td>frozen</td>
                     <td>Whether the strategy is frozen or not (relevant for tokenization)</td>
                  </tr>
               </tbody>
            </table>
            <p>These contents are always stored in the tree in ABI-encoded form: <code>((uint8,(bytes32,(address[],uint128[]),(address[],uint128[]),uint64,bool)))</code>. Meaning, you will want to decode the contents into a more suitable form for your purposes as necessary (for example loading data from a snapshot of the state), and will need to encode it back again if you are saving it back into the tree. A sample of Python code that derives this ABI-encoding, including the DDX grains conversion (10 ** 18) for certain variables, is shown on the right.</p>
            <p>The following sample <code>Strategy</code> materials generates the following ABI-encoded value: <code>0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000040046d61696e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000001000000000000000000000000b69e673309512a9d726f87304c6984054f87a93b0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000002a58743747cf74b400000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>strategy_id</td>
                     <td>&quot;main&quot;</td>
                  </tr>
                  <tr>
                     <td>free_collateral</td>
                     <td>{&quot;0xb69e673309512a9d726f87304c6984054f87a93b&quot;: 199971.08}</td>
                  </tr>
                  <tr>
                     <td>frozen_collateral</td>
                     <td>{}</td>
                  </tr>
                  <tr>
                     <td>max_leverage</td>
                     <td>20</td>
                  </tr>
                  <tr>
                     <td>frozen</td>
                     <td>False</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="position-2">Position</h4>
            <p>A <code>Position</code> contains information pertaining to an open position.</p>
            <h5 id="key-encoding--decoding-2">Key encoding / decoding</h5>
            <blockquote>
               <p>Key encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_abi.utils.padding <span class="hljs-keyword">import</span> zpad32_right, encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_strategy_id_hash</span>(<span class="hljs-params">strategy_id: <span class="hljs-built_in">str</span></span>) -&gt; bytes:</span>
    <span class="hljs-comment"># Get the first 4 bytes of the hash of the strategy id</span>
    <span class="hljs-keyword">return</span> w3.keccak(
        <span class="hljs-built_in">len</span>(strategy_id).to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
        + encode_single(<span class="hljs-string">&quot;bytes32&quot;</span>, strategy_id.encode(<span class="hljs-string">&quot;utf8&quot;</span>))[:-<span class="hljs-number">1</span>]
    )[:<span class="hljs-number">4</span>]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pack_bytes</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>):</span>
    charset = <span class="hljs-string">&quot;0ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
    symbol_bits = <span class="hljs-string">&quot;&quot;</span>
    <span class="hljs-keyword">for</span> letter <span class="hljs-keyword">in</span> text:
        <span class="hljs-keyword">for</span> i, char <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(charset):
            <span class="hljs-keyword">if</span> char == letter:
                bits = <span class="hljs-built_in">format</span>(i, <span class="hljs-string">&quot;08b&quot;</span>)[::-<span class="hljs-number">1</span>]
                symbol_bits += bits[:<span class="hljs-number">5</span>]

    symbol_bytes = <span class="hljs-built_in">int</span>(symbol_bits[::-<span class="hljs-number">1</span>], <span class="hljs-number">2</span>).to_bytes(
        (<span class="hljs-built_in">len</span>(symbol_bits) + <span class="hljs-number">7</span>) // <span class="hljs-number">8</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>
    )
    <span class="hljs-keyword">return</span> zpad_right(symbol_bytes, <span class="hljs-number">6</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unpack_bytes</span>(<span class="hljs-params">packed_text: <span class="hljs-built_in">bytes</span></span>):</span>
    charset = <span class="hljs-string">&quot;0ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
    symbol_bits = <span class="hljs-built_in">format</span>(<span class="hljs-built_in">int</span>.from_bytes(packed_text, <span class="hljs-string">&quot;little&quot;</span>), <span class="hljs-string">&quot;030b&quot;</span>)[::-<span class="hljs-number">1</span>]
    symbol_char_bit_chunks = [
        symbol_bits[i : i + <span class="hljs-number">5</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(symbol_bits), <span class="hljs-number">5</span>)
    ]
    symbol = <span class="hljs-string">&quot;&quot;</span>
    <span class="hljs-keyword">for</span> symbol_char_bit_chunk <span class="hljs-keyword">in</span> symbol_char_bit_chunks:
        reversed_bit_chunk = symbol_char_bit_chunk[::-<span class="hljs-number">1</span>]
        char_index = <span class="hljs-built_in">int</span>(reversed_bit_chunk, <span class="hljs-number">2</span>)
        symbol += charset[char_index]
    <span class="hljs-keyword">return</span> symbol

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode_key</span>(<span class="hljs-params">trader_address: <span class="hljs-built_in">str</span>, strategy_id: <span class="hljs-built_in">str</span>, symbol: <span class="hljs-built_in">str</span>, chain_discriminant: <span class="hljs-built_in">int</span></span>):</span>
    <span class="hljs-comment"># ItemType.POSITION == 2</span>
    <span class="hljs-keyword">return</span> (
            ItemType.POSITION.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
            + pack_bytes(symbol)
            + <span class="hljs-built_in">bytes</span>.fromhex(trader_address[<span class="hljs-number">2</span>:])
            + generate_strategy_id_hash(strategy_id)
        )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_key</span>(<span class="hljs-params">position_key: <span class="hljs-built_in">bytes</span></span>):</span>
    <span class="hljs-comment"># symbol, trader_address, strategy_id_hash</span>
    <span class="hljs-keyword">return</span> (
            unpack_bytes(position_key[<span class="hljs-number">1</span>:<span class="hljs-number">7</span>]),
            <span class="hljs-string">f&quot;0x<span class="hljs-subst">{position_key[<span class="hljs-number">7</span>:<span class="hljs-number">28</span>].<span class="hljs-built_in">hex</span>()}</span>&quot;</span>,
            <span class="hljs-string">f&quot;0x<span class="hljs-subst">{position_key[<span class="hljs-number">28</span>:].<span class="hljs-built_in">hex</span>()}</span>&quot;</span>,
        )</code></pre>
            <p>The location of a <code>Position</code> leaf is determined by its key, which is encoded as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>Bytes</th>
                     <th>Value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>0</td>
                     <td>Position discriminant</td>
                  </tr>
                  <tr>
                     <td>[1, 6]</td>
                     <td>Symbol (5-bit encoded/packed)</td>
                  </tr>
                  <tr>
                     <td>[7, 27]</td>
                     <td>Trader&#39;s Ethereum address prefixed with the chain discriminant</td>
                  </tr>
                  <tr>
                     <td>[28, 31]</td>
                     <td>Abbreviated hash of strategy ID</td>
                  </tr>
               </tbody>
            </table>
            <p>The following sample <code>Position</code> materials generates the following encoded key: <code>0x0285225824040000603699848c84529987e14ba32c8a66def67e9ece2576ebd1</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>trader_address</td>
                     <td>&quot;0x603699848c84529987E14Ba32C8a66DEF67E9eCE&quot;</td>
                  </tr>
                  <tr>
                     <td>strategy_id</td>
                     <td>&quot;main&quot;</td>
                  </tr>
                  <tr>
                     <td>symbol</td>
                     <td>&quot;ETHPERP&quot;</td>
                  </tr>
               </tbody>
            </table>
            <h5 id="value-definition-2">Value definition</h5>
            <blockquote>
               <p>Value encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict
<span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal, ROUND_DOWN
<span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">round_to_unit</span>(<span class="hljs-params">val</span>):</span>
    <span class="hljs-keyword">return</span> val.quantize(Decimal(<span class="hljs-string">&quot;.000000000000000001&quot;</span>), rounding=ROUND_DOWN)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_base_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(round_to_unit(val) * <span class="hljs-number">10</span> ** decimals)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> Decimal(<span class="hljs-built_in">str</span>(val)) / <span class="hljs-number">10</span> ** decimals

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_encoded_value</span>(<span class="hljs-params">self, side: <span class="hljs-built_in">int</span>, balance: Decimal, avg_entry_price: Decimal</span>):</span>
    <span class="hljs-comment"># Position item discriminant</span>
    item_type = <span class="hljs-number">2</span>

    <span class="hljs-comment"># Scale balance and average entry price to DDX grains</span>
    <span class="hljs-keyword">return</span> encode_single(
        <span class="hljs-string">&quot;(uint8,(uint8,uint128,uint128))&quot;</span>,
        [
            item_type,
            [
                side,
                to_base_unit_amount(balance, <span class="hljs-number">18</span>),
                to_base_unit_amount(avg_entry_price, <span class="hljs-number">18</span>),
            ],
        ],
    )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_decoded_value</span>(<span class="hljs-params">abi_encoded_value: <span class="hljs-built_in">str</span></span>):</span>
    (item_type, (side, balance, avg_entry_price)) = decode_single(
        <span class="hljs-string">&quot;(uint8,(uint8,uint128,uint128))&quot;</span>, w3.toBytes(hexstr=abi_encoded_value),
    )

    <span class="hljs-comment"># Scale balance and average entry price from DDX grains</span>
    <span class="hljs-keyword">return</span> (
        side, to_unit_amount(balance, <span class="hljs-number">18</span>), to_unit_amount(avg_entry_price, <span class="hljs-number">18</span>)
    )</code></pre>
            <p>A <code>Position</code> leaf holds the following data:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>int</td>
                     <td>side</td>
                     <td>Side of position (<code>Long=1</code>, <code>Short=2</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>balance</td>
                     <td>Size of the position</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>average_entry_price</td>
                     <td>Average entry price of the position</td>
                  </tr>
               </tbody>
            </table>
            <p>These contents are always stored in the tree in ABI-encoded form: <code>(uint8,(uint8,uint128,uint128))</code>. Meaning, you will want to decode the contents into a more suitable form for your purposes as necessary (for example loading data from a snapshot of the state), and will need to encode it back again if you are saving it back into the tree. A sample of Python code that derives this ABI-encoding, including the DDX grains conversion (10 ** 18) for certain variables, is shown on the right.</p>
            <p>The following sample <code>Position</code> materials generates the following ABI-encoded value: <code>0x000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000068155a43676e0000000000000000000000000000000000000000000000000000d4eff354906660000</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>side</td>
                     <td>1</td>
                  </tr>
                  <tr>
                     <td>balance</td>
                     <td>120</td>
                  </tr>
                  <tr>
                     <td>avg_entry_price</td>
                     <td>245.5</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="book-order-2">Book order</h4>
            <p>A <code>BookOrder</code> contains information pertaining to a maker order in the order book.</p>
            <h5 id="key-encoding--decoding-3">Key encoding / decoding</h5>
            <blockquote>
               <p>Key encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_abi.utils.padding <span class="hljs-keyword">import</span> zpad32_right, encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_strategy_id_hash</span>(<span class="hljs-params">strategy_id: <span class="hljs-built_in">str</span></span>) -&gt; bytes:</span>
    <span class="hljs-comment"># Get the first 4 bytes of the hash of the strategy id</span>
    <span class="hljs-keyword">return</span> w3.keccak(
        <span class="hljs-built_in">len</span>(strategy_id).to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
        + encode_single(<span class="hljs-string">&quot;bytes32&quot;</span>, strategy_id.encode(<span class="hljs-string">&quot;utf8&quot;</span>))[:-<span class="hljs-number">1</span>]
    )[:<span class="hljs-number">4</span>]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pack_bytes</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>):</span>
    charset = <span class="hljs-string">&quot;0ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
    symbol_bits = <span class="hljs-string">&quot;&quot;</span>
    <span class="hljs-keyword">for</span> letter <span class="hljs-keyword">in</span> text:
        <span class="hljs-keyword">for</span> i, char <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(charset):
            <span class="hljs-keyword">if</span> char == letter:
                bits = <span class="hljs-built_in">format</span>(i, <span class="hljs-string">&quot;08b&quot;</span>)[::-<span class="hljs-number">1</span>]
                symbol_bits += bits[:<span class="hljs-number">5</span>]

    symbol_bytes = <span class="hljs-built_in">int</span>(symbol_bits[::-<span class="hljs-number">1</span>], <span class="hljs-number">2</span>).to_bytes(
        (<span class="hljs-built_in">len</span>(symbol_bits) + <span class="hljs-number">7</span>) // <span class="hljs-number">8</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>
    )
    <span class="hljs-keyword">return</span> zpad_right(symbol_bytes, <span class="hljs-number">6</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unpack_bytes</span>(<span class="hljs-params">packed_text: <span class="hljs-built_in">bytes</span></span>):</span>
    charset = <span class="hljs-string">&quot;0ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
    symbol_bits = <span class="hljs-built_in">format</span>(<span class="hljs-built_in">int</span>.from_bytes(packed_text, <span class="hljs-string">&quot;little&quot;</span>), <span class="hljs-string">&quot;030b&quot;</span>)[::-<span class="hljs-number">1</span>]
    symbol_char_bit_chunks = [
        symbol_bits[i : i + <span class="hljs-number">5</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(symbol_bits), <span class="hljs-number">5</span>)
    ]
    symbol = <span class="hljs-string">&quot;&quot;</span>
    <span class="hljs-keyword">for</span> symbol_char_bit_chunk <span class="hljs-keyword">in</span> symbol_char_bit_chunks:
        reversed_bit_chunk = symbol_char_bit_chunk[::-<span class="hljs-number">1</span>]
        char_index = <span class="hljs-built_in">int</span>(reversed_bit_chunk, <span class="hljs-number">2</span>)
        symbol += charset[char_index]
    <span class="hljs-keyword">return</span> symbol

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode_key</span>(<span class="hljs-params">symbol: <span class="hljs-built_in">str</span>, order_hash: <span class="hljs-built_in">str</span></span>):</span>
    <span class="hljs-comment"># ItemType.BOOK_ORDER == 3</span>
    <span class="hljs-keyword">return</span> (
            ItemType.BOOK_ORDER.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
            + pack_bytes(symbol)
            + <span class="hljs-built_in">bytes</span>.fromhex(order_hash[<span class="hljs-number">2</span>:<span class="hljs-number">52</span>])
        )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_key</span>(<span class="hljs-params">book_order_key: <span class="hljs-built_in">bytes</span></span>):</span>
    <span class="hljs-comment"># symbol, first 25 bytes of order_hash</span>
    <span class="hljs-keyword">return</span> (
            unpack_bytes(book_order_key[<span class="hljs-number">1</span>:<span class="hljs-number">7</span>]),
            <span class="hljs-string">f&quot;0x<span class="hljs-subst">{book_order_key[<span class="hljs-number">7</span>:].<span class="hljs-built_in">hex</span>()}</span>&quot;</span>,
        )</code></pre>
            <p>The location of a <code>BookOrder</code> leaf is determined by its key, which is encoded as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>Bytes</th>
                     <th>Value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>0</td>
                     <td>Book order discriminant</td>
                  </tr>
                  <tr>
                     <td>[1, 6]</td>
                     <td>Symbol (5-bit encoded/packed)</td>
                  </tr>
                  <tr>
                     <td>[7, 31]</td>
                     <td>First 25 bytes of order&#39;s unique hash</td>
                  </tr>
               </tbody>
            </table>
            <p>The following sample <code>BookOrder</code> materials generates the following encoded key: <code>0x038522582404009fcf480aa9606f5bbb64ab36e642566bd893f715b346df244e</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>symbol</td>
                     <td>&quot;ETHPERP&quot;</td>
                  </tr>
                  <tr>
                     <td>order_hash</td>
                     <td>&quot;0x9fcf480aa9606f5bbb64ab36e642566bd893f715b346df244eABABABABABABAB&quot;</td>
                  </tr>
               </tbody>
            </table>
            <h5 id="value-definition-3">Value definition</h5>
            <blockquote>
               <p>Value encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict
<span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal, ROUND_DOWN
<span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">round_to_unit</span>(<span class="hljs-params">val</span>):</span>
    <span class="hljs-keyword">return</span> val.quantize(Decimal(<span class="hljs-string">&quot;.000000000000000001&quot;</span>), rounding=ROUND_DOWN)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_base_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(round_to_unit(val) * <span class="hljs-number">10</span> ** decimals)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> Decimal(<span class="hljs-built_in">str</span>(val)) / <span class="hljs-number">10</span> ** decimals

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_encoded_value</span>(<span class="hljs-params">self, side: <span class="hljs-built_in">int</span>, amount: Decimal, price: Decimal, trader_address: <span class="hljs-built_in">str</span>, strategy_id_hash: <span class="hljs-built_in">str</span>, book_ordinal: <span class="hljs-built_in">int</span></span>):</span>
    <span class="hljs-comment"># BookOrder item discriminant</span>
    item_type = <span class="hljs-number">3</span>

    <span class="hljs-comment"># Scale amount and price to DDX grains</span>
    <span class="hljs-keyword">return</span> encode_single(
        <span class="hljs-string">&quot;(uint8,(uint8,uint128,uint128,bytes21,bytes32,uint64))&quot;</span>,
        [
            self.item_type,
            [
                side,
                to_base_unit_amount(amount, <span class="hljs-number">18</span>),
                to_base_unit_amount(price, <span class="hljs-number">18</span>),
                <span class="hljs-built_in">bytes</span>.fromhex(trader_address[<span class="hljs-number">2</span>:]),
                <span class="hljs-built_in">bytes</span>.fromhex(strategy_id_hash[<span class="hljs-number">2</span>:]),
                book_ordinal,
            ],
        ],
    )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_decoded_value</span>(<span class="hljs-params">abi_encoded_value: <span class="hljs-built_in">str</span></span>):</span>
    (
        item_type,
        (side, amount, price, trader_address, strategy_id_hash, book_ordinal),
    ) = decode_single(
        <span class="hljs-string">&quot;(uint8,(uint8,uint128,uint128,bytes21,bytes32,uint64))&quot;</span>,
        w3.toBytes(hexstr=abi_encoded_value),
    )

    <span class="hljs-comment"># Scale amount and price from DDX grains</span>
    <span class="hljs-keyword">return</span> (
        side,
        to_unit_amount(amount, <span class="hljs-number">18</span>),
        to_unit_amount(price, <span class="hljs-number">18</span>),
        <span class="hljs-string">f&quot;0x<span class="hljs-subst">{trader_address.<span class="hljs-built_in">hex</span>()}</span>&quot;</span>,
        <span class="hljs-string">f&quot;0x<span class="hljs-subst">{strategy_id_hash[:<span class="hljs-number">4</span>].<span class="hljs-built_in">hex</span>()}</span>&quot;</span>,
        book_ordinal,
    )</code></pre>
            <p>A <code>BookOrder</code> leaf holds the following data:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>str</td>
                     <td>side</td>
                     <td>Side of order (<code>Bid</code>, <code>Ask</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>amount</td>
                     <td>Amount/size of order</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>price</td>
                     <td>Price the order has been placed at</td>
                  </tr>
                  <tr>
                     <td>str</td>
                     <td>trader_address</td>
                     <td>The order creator&#39;s Ethereum address prefixed with the chain discriminant</td>
                  </tr>
                  <tr>
                     <td>str</td>
                     <td>strategy_id_hash</td>
                     <td>First 4 bytes of strategy ID hash this order belongs to</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>book_ordinal</td>
                     <td>Numerical sequencing identifier for a BookOrder, which can be used to sort orders at any given price level</td>
                  </tr>
               </tbody>
            </table>
            <p>These contents are always stored in the tree in ABI-encoded form: <code>(uint8,(uint8,uint128,uint128,address,bytes32,uint64))</code>. Meaning, you will want to decode the contents into a more suitable form for your purposes as necessary (for example loading data from a snapshot of the state), and will need to encode it back again if you are saving it back into the tree. A sample of Python code that derives this ABI-encoding, including the DDX grains conversion (10 ** 18) for certain variables, is shown on the right.</p>
            <p>The following sample <code>BookOrder</code> materials generates the following ABI-encoded value: <code>0x000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007068fb1598aa000000000000000000000000000000000000000000000000010191888088a17a000000e36ea790bc9d7ab70c55260c66d52b1eca985f8400000000000000000000002576ebd10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000149ae</code></p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>side</td>
                     <td>&quot;Bid&quot;</td>
                  </tr>
                  <tr>
                     <td>amount</td>
                     <td>8.1</td>
                  </tr>
                  <tr>
                     <td>price</td>
                     <td>4751.3</td>
                  </tr>
                  <tr>
                     <td>trader_address</td>
                     <td>&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</td>
                  </tr>
                  <tr>
                     <td>strategy_id_hash</td>
                     <td>&quot;0x2576ebd1&quot;</td>
                  </tr>
                  <tr>
                     <td>book_ordinal</td>
                     <td>84398</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="price">Price</h4>
            <p>A <code>Price</code> contains information pertaining to a market&#39;s price checkpoint.</p>
            <h5 id="key-encoding--decoding-4">Key encoding / decoding</h5>
            <blockquote>
               <p>Key encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_abi.utils.padding <span class="hljs-keyword">import</span> zpad32_right, encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pack_bytes</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>):</span>
    charset = <span class="hljs-string">&quot;0ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
    symbol_bits = <span class="hljs-string">&quot;&quot;</span>
    <span class="hljs-keyword">for</span> letter <span class="hljs-keyword">in</span> text:
        <span class="hljs-keyword">for</span> i, char <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(charset):
            <span class="hljs-keyword">if</span> char == letter:
                bits = <span class="hljs-built_in">format</span>(i, <span class="hljs-string">&quot;08b&quot;</span>)[::-<span class="hljs-number">1</span>]
                symbol_bits += bits[:<span class="hljs-number">5</span>]

    symbol_bytes = <span class="hljs-built_in">int</span>(symbol_bits[::-<span class="hljs-number">1</span>], <span class="hljs-number">2</span>).to_bytes(
        (<span class="hljs-built_in">len</span>(symbol_bits) + <span class="hljs-number">7</span>) // <span class="hljs-number">8</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>
    )
    <span class="hljs-keyword">return</span> zpad_right(symbol_bytes, <span class="hljs-number">6</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unpack_bytes</span>(<span class="hljs-params">packed_text: <span class="hljs-built_in">bytes</span></span>):</span>
    charset = <span class="hljs-string">&quot;0ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
    symbol_bits = <span class="hljs-built_in">format</span>(<span class="hljs-built_in">int</span>.from_bytes(packed_text, <span class="hljs-string">&quot;little&quot;</span>), <span class="hljs-string">&quot;030b&quot;</span>)[::-<span class="hljs-number">1</span>]
    symbol_char_bit_chunks = [
        symbol_bits[i : i + <span class="hljs-number">5</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(symbol_bits), <span class="hljs-number">5</span>)
    ]
    symbol = <span class="hljs-string">&quot;&quot;</span>
    <span class="hljs-keyword">for</span> symbol_char_bit_chunk <span class="hljs-keyword">in</span> symbol_char_bit_chunks:
        reversed_bit_chunk = symbol_char_bit_chunk[::-<span class="hljs-number">1</span>]
        char_index = <span class="hljs-built_in">int</span>(reversed_bit_chunk, <span class="hljs-number">2</span>)
        symbol += charset[char_index]
    <span class="hljs-keyword">return</span> symbol

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode_key</span>(<span class="hljs-params">symbol: <span class="hljs-built_in">str</span>, index_price_hash: <span class="hljs-built_in">str</span></span>):</span>
    <span class="hljs-comment"># ItemType.PRICE == 4</span>
    <span class="hljs-keyword">return</span> zpad32_right(
            ItemType.PRICE.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
            + pack_bytes(symbol)
            + <span class="hljs-built_in">bytes</span>.fromhex(index_price_hash[<span class="hljs-number">2</span>:])
        )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_key</span>(<span class="hljs-params">price_key: <span class="hljs-built_in">bytes</span></span>):</span>
    <span class="hljs-comment"># symbol, index price hash</span>
    <span class="hljs-keyword">return</span> (
            unpack_bytes(price_key[<span class="hljs-number">1</span>:<span class="hljs-number">7</span>]),
            <span class="hljs-string">f&quot;0x<span class="hljs-subst">{leaf_key[<span class="hljs-number">7</span>:].<span class="hljs-built_in">hex</span>()}</span>&quot;</span>,
        )</code></pre>
            <p>The location of a <code>Price</code> leaf is determined by its key, which is encoded as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>Bytes</th>
                     <th>Value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>0</td>
                     <td>Price discriminant</td>
                  </tr>
                  <tr>
                     <td>[1, 6]</td>
                     <td>Symbol (5-bit encoded/packed)</td>
                  </tr>
                  <tr>
                     <td>[7, 31]</td>
                     <td>25 bytes of index price&#39;s unique hash</td>
                  </tr>
               </tbody>
            </table>
            <p>The following sample <code>Price</code> materials generates the following encoded key: <code>0x0485225824040023c2b28e94b9dfcb8630a369fed134cdb6689dcb2528578779</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>symbol</td>
                     <td>&quot;ETHPERP&quot;</td>
                  </tr>
                  <tr>
                     <td>index_price_hash</td>
                     <td>&quot;0x23c2b28e94b9dfcb8630a369fed134cdb6689dcb2528578779ABABABABABABAB&quot;</td>
                  </tr>
               </tbody>
            </table>
            <h5 id="value-definition-4">Value definition</h5>
            <blockquote>
               <p>Value encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict
<span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal, ROUND_DOWN
<span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">round_to_unit</span>(<span class="hljs-params">val</span>):</span>
    <span class="hljs-keyword">return</span> val.quantize(Decimal(<span class="hljs-string">&quot;.000000000000000001&quot;</span>), rounding=ROUND_DOWN)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_base_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(round_to_unit(val) * <span class="hljs-number">10</span> ** decimals)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> Decimal(<span class="hljs-built_in">str</span>(val)) / <span class="hljs-number">10</span> ** decimals

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_encoded_value</span>(<span class="hljs-params">self, index_price: Decimal, index_price_hash: <span class="hljs-built_in">bytes</span>, ema: Decimal</span>):</span>
    <span class="hljs-comment"># Price item discriminant</span>
    item_type = <span class="hljs-number">4</span>

    <span class="hljs-comment"># Scale index price and ema to DDX grains</span>
    price_encoding = encode_single(
        <span class="hljs-string">&quot;(uint8,(uint128,uint256,uint64))&quot;</span>,
        [
            self.item_type,
            [
                to_base_unit_amount(index_price, <span class="hljs-number">18</span>),
                to_base_unit_amount(<span class="hljs-built_in">abs</span>(ema), <span class="hljs-number">18</span>),
                ordinal,
            ],
        ],
    )
    <span class="hljs-keyword">if</span> self.ema &lt; <span class="hljs-number">0</span>:
        price_encoding_byte_array = <span class="hljs-built_in">bytearray</span>(price_encoding)
        price_encoding_byte_array[-<span class="hljs-number">49</span>] = <span class="hljs-number">1</span>
        price_encoding = <span class="hljs-built_in">bytes</span>(price_encoding_byte_array)

    <span class="hljs-keyword">return</span> price_encoding

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_decoded_value</span>(<span class="hljs-params">abi_encoded_value: <span class="hljs-built_in">str</span></span>):</span>
    price_encoding_byte_array = <span class="hljs-built_in">bytearray</span>(<span class="hljs-built_in">bytes</span>.fromhex(abi_encoded_value[<span class="hljs-number">2</span>:]))
    multiplier = -<span class="hljs-number">1</span> <span class="hljs-keyword">if</span> price_encoding_byte_array[-<span class="hljs-number">49</span>] == <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1</span>
    price_encoding_byte_array[-<span class="hljs-number">49</span>] = <span class="hljs-number">0</span>
    abi_encoded_value = <span class="hljs-built_in">bytes</span>(price_encoding_byte_array).<span class="hljs-built_in">hex</span>()

    (item_type, (index_price, ema, ordinal)) = decode_single(
        <span class="hljs-string">&quot;(uint8,(uint128,uint256,uint64))&quot;</span>, w3.toBytes(hexstr=abi_encoded_value),
    )

    <span class="hljs-comment"># Scale index price and ema from DDX grains</span>
    <span class="hljs-keyword">return</span> (
        to_unit_amount(index_price, <span class="hljs-number">18</span>),
        to_unit_amount(ema * multiplier, <span class="hljs-number">18</span>),
        ordinal,
    )</code></pre>
            <p>A <code>Price</code> leaf holds the following data:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>decimal</td>
                     <td>index_price</td>
                     <td>Composite index price perpetual is tracking</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>ema</td>
                     <td>EMA component of price, tracking the difference between the DerivaDEX order book price and the underlying</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>ordinal</td>
                     <td>Numerical sequencing identifier for PriceCheckpoint that created this Price state leaf, can be used to arrange Price leaves in order of entry</td>
                  </tr>
               </tbody>
            </table>
            <p>These contents are always stored in the tree in ABI-encoded form: <code>(uint8,(uint128,uint256,uint64))</code>. Meaning, you will want to decode the contents into a more suitable form for your purposes as necessary (for example loading data from a snapshot of the state), and will need to encode it back again if you are saving it back into the tree. A sample of Python code that derives this ABI-encoding, including the DDX grains conversion (10 ** 18) for certain variables, is shown on the right. It&#39;s demonstrated in the code sample, but it&#39;s worth highlighting that the <code>ema</code> component, which can be a negative value, is ABI-encoded to a 32-byte value where the first 16 bytes will either be <code>0x00000000000000000000000000000000</code> (positive) or <code>0x00000000000000000000000000000001</code> (negative), and the next 16 bytes is the absolute value of the <code>ema</code>.</p>
            <p>The following sample <code>Price</code> materials generates the following ABI-encoded value: <code>0x00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000ff439f867f838f4000000000000000000000000000000000000000000000000004d94aaad5556854d300000000000000000000000000000000000000000000000000000000000020e2</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>index_price</td>
                     <td>4708.7925</td>
                  </tr>
                  <tr>
                     <td>ema</td>
                     <td>89.444491182582813907</td>
                  </tr>
                  <tr>
                     <td>ordinal</td>
                     <td>8418</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="insurance-fund">Insurance fund</h4>
            <p>An <code>InsuranceFund</code> contains information pertaining to the insurance fund&#39;s capitalization.</p>
            <h5 id="key-encoding--decoding-5">Key encoding / decoding</h5>
            <blockquote>
               <p>Key encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_abi.utils.padding <span class="hljs-keyword">import</span> zpad32_right

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode_key</span>():</span>
    <span class="hljs-comment"># ItemType.INSURANCE_FUND == 5</span>
    <span class="hljs-keyword">return</span> zpad32_right(
        ItemType.INSURANCE_FUND.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
        + <span class="hljs-string">&quot;OrganicInsuranceFund&quot;</span>.encode(<span class="hljs-string">&quot;utf8&quot;</span>)
    )</code></pre>
            <p>The location of an <code>InsuranceFund</code> leaf is determined by its key, which is encoded as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>Bytes</th>
                     <th>Value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>0</td>
                     <td>Insurance fund discriminant</td>
                  </tr>
                  <tr>
                     <td>[1, 20]</td>
                     <td>&quot;OrganicInsuranceFund&quot; bytes-encoded</td>
                  </tr>
                  <tr>
                     <td>[21, 31]</td>
                     <td>Zero-padding</td>
                  </tr>
               </tbody>
            </table>
            <p>The <code>InsuranceFund</code> leaf is located at the encoded key: <code>0x054f7267616e6963496e737572616e636546756e640000000000000000000000</code>.</p>
            <h5 id="value-definition-5">Value definition</h5>
            <blockquote>
               <p>Value encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict
<span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal, ROUND_DOWN
<span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">round_to_unit</span>(<span class="hljs-params">val</span>):</span>
    <span class="hljs-keyword">return</span> val.quantize(Decimal(<span class="hljs-string">&quot;.000000000000000001&quot;</span>), rounding=ROUND_DOWN)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_base_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(round_to_unit(val) * <span class="hljs-number">10</span> ** decimals)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> Decimal(<span class="hljs-built_in">str</span>(val)) / <span class="hljs-number">10</span> ** decimals

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_encoded_value</span>(<span class="hljs-params">self, capitalization: Dict[<span class="hljs-built_in">str</span>, Decimal]</span>):</span>
    <span class="hljs-comment"># InsuranceFund item discriminant</span>
    item_type = <span class="hljs-number">5</span>

    <span class="hljs-comment"># Scale collateral amounts to DDX grains</span>
    <span class="hljs-keyword">return</span> encode_single(
        <span class="hljs-string">&quot;((uint8,(address[],uint128[])))&quot;</span>,
        [
            [
                self.item_type,
                [
                    <span class="hljs-built_in">list</span>(capitalization.keys()),
                    to_base_unit_amount_list(
                        <span class="hljs-built_in">list</span>(capitalization.values()), <span class="hljs-number">18</span>
                    ),
                ],
            ]
        ],
    )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_decoded_value</span>(<span class="hljs-params">abi_encoded_value: <span class="hljs-built_in">str</span></span>):</span>
    (
        (item_type, (capitalization_tokens, capitalization_amounts,),),
    ) = decode_single(
        <span class="hljs-string">&quot;((uint8,(address[],uint128[])))&quot;</span>, w3.toBytes(hexstr=abi_encoded_value),
    )

    <span class="hljs-comment"># Scale collateral amounts from DDX grains</span>
    <span class="hljs-keyword">return</span> cls(
        {
            k: to_unit_amount(v, <span class="hljs-number">18</span>)
            <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(
                <span class="hljs-built_in">list</span>(capitalization_tokens), <span class="hljs-built_in">list</span>(capitalization_amounts)
            )
        },
    )</code></pre>
            <p>An <code>InsuranceFund</code> leaf holds the following data:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict&lt;address_s, decimal&gt;</td>
                     <td>capitalization</td>
                     <td>Mapping of collateral address to organic insurance fund capitalization</td>
                  </tr>
               </tbody>
            </table>
            <p>These contents are always stored in the tree in ABI-encoded form: <code>((uint8,(address[],uint128[])))</code>. Meaning, you will want to decode the contents into a more suitable form for your purposes as necessary (for example loading data from a snapshot of the state), and will need to encode it back again if you are saving it back into the tree. A sample of Python code that derives this ABI-encoding, including the DDX grains conversion (10 ** 18) for certain variables, is shown on the right.</p>
            <p>The following sample <code>InsuranceFund</code> materials generates the following ABI-encoded value: <code>0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000001000000000000000000000000cfc18cec799fbd1793b5c43e773c98d4d61cc2db000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000532d4737cf8c716f0000</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>capitalization</td>
                     <td>{&#39;0xcfc18cec799fbd1793b5c43e773c98d4d61cc2db&#39;: 392791.65336}</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="stats">Stats</h4>
            <p>A <code>Stats</code> contains data such as volume info for trade mining for any given trader.</p>
            <h5 id="key-encoding--decoding-6">Key encoding / decoding</h5>
            <blockquote>
               <p>Key encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> eth_abi.utils.padding <span class="hljs-keyword">import</span> zpad32_right

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode_key</span>(<span class="hljs-params">trader_address: <span class="hljs-built_in">str</span></span>):</span>
    <span class="hljs-comment"># ItemType.STATS == 6</span>
    <span class="hljs-keyword">return</span> zpad32_right(
            ItemType.STATS.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;little&quot;</span>)
            + <span class="hljs-built_in">bytes</span>.fromhex(trader_address[<span class="hljs-number">2</span>:])
        )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_key</span>(<span class="hljs-params">stats_key: <span class="hljs-built_in">bytes</span></span>):</span>
    <span class="hljs-comment"># chain_discriminant, trader_address</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;0x<span class="hljs-subst">{stats_key[<span class="hljs-number">1</span>:<span class="hljs-number">22</span>].<span class="hljs-built_in">hex</span>()}</span>&quot;</span></code></pre>
            <p>The location of a <code>Stats</code> leaf is determined by its key, which is encoded as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>Bytes</th>
                     <th>Value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>0</td>
                     <td>Stats discriminant</td>
                  </tr>
                  <tr>
                     <td>[1, 21]</td>
                     <td>Trader&#39;s Ethereum address prefixed with the chain discriminant</td>
                  </tr>
                  <tr>
                     <td>[22, 31]</td>
                     <td>Zero-padding</td>
                  </tr>
               </tbody>
            </table>
            <p>The following sample <code>Stats</code> materials generates the following encoded key: <code>0x0600603699848c84529987e14ba32c8a66def67e9ece00000000000000000000</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>trader_address</td>
                     <td>&quot;0x00603699848c84529987E14Ba32C8a66DEF67E9eCE&quot;</td>
                  </tr>
               </tbody>
            </table>
            <h5 id="value-definition-6">Value definition</h5>
            <blockquote>
               <p>Value encoding / decoding (Python)</p>
            </blockquote>
            <pre class="highlight python"><code><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict
<span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal, ROUND_DOWN
<span class="hljs-keyword">from</span> eth_abi <span class="hljs-keyword">import</span> encode_single, decode_single
<span class="hljs-keyword">from</span> web3.auto <span class="hljs-keyword">import</span> w3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">round_to_unit</span>(<span class="hljs-params">val</span>):</span>
    <span class="hljs-keyword">return</span> val.quantize(Decimal(<span class="hljs-string">&quot;.000000000000000001&quot;</span>), rounding=ROUND_DOWN)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_base_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(round_to_unit(val) * <span class="hljs-number">10</span> ** decimals)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_unit_amount</span>(<span class="hljs-params">val, decimals</span>):</span>
    <span class="hljs-keyword">return</span> Decimal(<span class="hljs-built_in">str</span>(val)) / <span class="hljs-number">10</span> ** decimals

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_encoded_value</span>(<span class="hljs-params">self, maker_volume: Decimal, taker_volume: Decimal</span>):</span>
    <span class="hljs-comment"># Stats item discriminant</span>
    item_type = <span class="hljs-number">6</span>

    <span class="hljs-comment"># Scale volume amounts to DDX grains</span>
    <span class="hljs-keyword">return</span> encode_single(
        <span class="hljs-string">&quot;(uint8,(uint128,uint128))&quot;</span>,
        [
            item_type,
            [
                to_base_unit_amount(maker_volume, <span class="hljs-number">18</span>),
                to_base_unit_amount(taker_volume, <span class="hljs-number">18</span>),
            ],
        ],
    )

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">abi_decoded_value</span>(<span class="hljs-params">abi_encoded_value: <span class="hljs-built_in">str</span></span>):</span>
    (item_type, (maker_volume, taker_volume)) = decode_single(
        <span class="hljs-string">&quot;(uint8,(uint128,uint128))&quot;</span>, w3.toBytes(hexstr=abi_encoded_value),
    )

    <span class="hljs-comment"># Scale volumes from DDX grains</span>
    <span class="hljs-keyword">return</span> (to_unit_amount(maker_volume, <span class="hljs-number">18</span>), to_unit_amount(taker_volume, <span class="hljs-number">18</span>))</code></pre>
            <p>A <code>Stats</code> leaf holds the following data:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>decimal</td>
                     <td>maker_volume</td>
                     <td>Maker volume of trader during this trade mining epoch</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>taker_volume</td>
                     <td>Taker volume of trader during this trade mining epoch</td>
                  </tr>
               </tbody>
            </table>
            <p>These contents are always stored in the tree in ABI-encoded form: <code>(uint8,(uint128,uint128))</code>. Meaning, you will want to decode the contents into a more suitable form for your purposes as necessary (for example loading data from a snapshot of the state), and will need to encode it back again if you are saving it back into the tree. A sample of Python code that derives this ABI-encoding, including the DDX grains conversion (10 ** 18) for certain variables, is shown on the right.</p>
            <p>The following sample <code>Stats</code> materials generates the following ABI-encoded value: <code>0x000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000032d26d12e980b60000000000000000000000000000000000000000000000000030fe0cfcba2f4700000</code>.</p>
            <table>
               <thead>
                  <tr>
                     <th>field</th>
                     <th>value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>maker_volume</td>
                     <td>15000</td>
                  </tr>
                  <tr>
                     <td>taker_volume</td>
                     <td>14460</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="transactions">Transactions</h3>
            <p>Transactions refer to the state-changing events that modify the SMT and its leaves (thus the root hash) described above.</p>
            <p>There are 12 various types of transactions on DerivaDEX. The full set of transactions along with their corresponding numeric discrimants can be seen in the table below:</p>
            <table>
               <thead>
                  <tr>
                     <th>Event</th>
                     <th>Discriminant</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>PartialFill</td>
                     <td>0</td>
                  </tr>
                  <tr>
                     <td>CompleteFill</td>
                     <td>1</td>
                  </tr>
                  <tr>
                     <td>Post</td>
                     <td>2</td>
                  </tr>
                  <tr>
                     <td>Cancel</td>
                     <td>3</td>
                  </tr>
                  <tr>
                     <td>Liquidation</td>
                     <td>4</td>
                  </tr>
                  <tr>
                     <td>StrategyUpdate</td>
                     <td>5</td>
                  </tr>
                  <tr>
                     <td>TraderUpdate</td>
                     <td>6</td>
                  </tr>
                  <tr>
                     <td>Withdraw</td>
                     <td>7</td>
                  </tr>
                  <tr>
                     <td>WithdrawDDX</td>
                     <td>8</td>
                  </tr>
                  <tr>
                     <td>PriceCheckpoint</td>
                     <td>9</td>
                  </tr>
                  <tr>
                     <td>PnlSettlement</td>
                     <td>10</td>
                  </tr>
                  <tr>
                     <td>Funding</td>
                     <td>11</td>
                  </tr>
                  <tr>
                     <td>TradeMining</td>
                     <td>12</td>
                  </tr>
                  <tr>
                     <td>MembershipChange</td>
                     <td>60</td>
                  </tr>
                  <tr>
                     <td>EpochMarker</td>
                     <td>100</td>
                  </tr>
                  <tr>
                     <td>NoTransition</td>
                     <td>13</td>
                  </tr>
               </tbody>
            </table>
            <p>Each of these transaction types as received from the Operator WebSocket API are described at length below.</p>
            <h4 id="partial-fill">Partial fill</h4>
            <blockquote>
               <p>Sample PartialFill (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: [
        [{
            <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;1860&quot;</span>,
            <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;2.54&quot;</span>,
            <span class="hljs-attr">&quot;reason&quot;</span>: <span class="hljs-string">&quot;Trade&quot;</span>,
            <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
            <span class="hljs-attr">&quot;takerSide&quot;</span>: <span class="hljs-string">&quot;Ask&quot;</span>,
            <span class="hljs-attr">&quot;makerOutcome&quot;</span>: {
                <span class="hljs-attr">&quot;fee&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;trader&quot;</span>: <span class="hljs-string">&quot;0x006ecbe1db9ef729cbe972c83fb886247691fb6beb&quot;</span>,
                <span class="hljs-attr">&quot;strategy&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
                <span class="hljs-attr">&quot;realizedPnl&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;positionSide&quot;</span>: <span class="hljs-string">&quot;Long&quot;</span>,
                <span class="hljs-attr">&quot;newCollateral&quot;</span>: <span class="hljs-string">&quot;1000000&quot;</span>,
                <span class="hljs-attr">&quot;ddxFeeElection&quot;</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">&quot;newPositionBalance&quot;</span>: <span class="hljs-string">&quot;5&quot;</span>,
                <span class="hljs-attr">&quot;newPositionAvgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1860&quot;</span>
            },
            <span class="hljs-attr">&quot;takerOutcome&quot;</span>: {
                <span class="hljs-attr">&quot;fee&quot;</span>: <span class="hljs-string">&quot;9.4488&quot;</span>,
                <span class="hljs-attr">&quot;trader&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
                <span class="hljs-attr">&quot;strategy&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
                <span class="hljs-attr">&quot;realizedPnl&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
                <span class="hljs-attr">&quot;positionSide&quot;</span>: <span class="hljs-string">&quot;Short&quot;</span>,
                <span class="hljs-attr">&quot;newCollateral&quot;</span>: <span class="hljs-string">&quot;999981.4&quot;</span>,
                <span class="hljs-attr">&quot;ddxFeeElection&quot;</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">&quot;newPositionBalance&quot;</span>: <span class="hljs-string">&quot;5&quot;</span>,
                <span class="hljs-attr">&quot;newPositionAvgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1860&quot;</span>
            },
            <span class="hljs-attr">&quot;makerOrderHash&quot;</span>: <span class="hljs-string">&quot;0x542ad7f2640447d3e93723253099fd45ae721925e0df64702e&quot;</span>,
            <span class="hljs-attr">&quot;takerOrderHash&quot;</span>: <span class="hljs-string">&quot;0x7854e5da6e9fb7a4e9fca62dc26a5d574afb07950a6ed110ed&quot;</span>,
            <span class="hljs-attr">&quot;makerOrderRemainingAmount&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>
        }], {
            <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Ask&quot;</span>,
            <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;1859&quot;</span>,
            <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;2.46&quot;</span>,
            <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
            <span class="hljs-attr">&quot;orderHash&quot;</span>: <span class="hljs-string">&quot;0x7854e5da6e9fb7a4e9fca62dc26a5d574afb07950a6ed110ed&quot;</span>,
            <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
            <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>
        }
    ]
}</code></pre>
            <p>A <code>PartialFill</code> transaction is a scenario where the taker order has been partially filled across 1 or more maker orders and thus has a remaining order that enters the order book. The event portion of the transaction response consists of a 2-item array. The first item is a list of <code>TradeFill</code> events and the second item is the remaining <code>Post</code> event.</p>
            <h4 id="complete-fill">Complete fill</h4>
            <blockquote>
               <p>Sample CompleteFill (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: [{
        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;1860&quot;</span>,
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1.23&quot;</span>,
        <span class="hljs-attr">&quot;reason&quot;</span>: <span class="hljs-string">&quot;Trade&quot;</span>,
        <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
        <span class="hljs-attr">&quot;takerSide&quot;</span>: <span class="hljs-string">&quot;Ask&quot;</span>,
        <span class="hljs-attr">&quot;makerOutcome&quot;</span>: {
            <span class="hljs-attr">&quot;fee&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
            <span class="hljs-attr">&quot;trader&quot;</span>: <span class="hljs-string">&quot;0x006ecbe1db9ef729cbe972c83fb886247691fb6beb&quot;</span>,
            <span class="hljs-attr">&quot;strategy&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
            <span class="hljs-attr">&quot;realizedPnl&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
            <span class="hljs-attr">&quot;positionSide&quot;</span>: <span class="hljs-string">&quot;Long&quot;</span>,
            <span class="hljs-attr">&quot;newCollateral&quot;</span>: <span class="hljs-string">&quot;1000000&quot;</span>,
            <span class="hljs-attr">&quot;ddxFeeElection&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">&quot;newPositionBalance&quot;</span>: <span class="hljs-string">&quot;2.46&quot;</span>,
            <span class="hljs-attr">&quot;newPositionAvgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1860&quot;</span>
        },
        <span class="hljs-attr">&quot;takerOutcome&quot;</span>: {
            <span class="hljs-attr">&quot;fee&quot;</span>: <span class="hljs-string">&quot;4.5756&quot;</span>,
            <span class="hljs-attr">&quot;trader&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
            <span class="hljs-attr">&quot;strategy&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
            <span class="hljs-attr">&quot;realizedPnl&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
            <span class="hljs-attr">&quot;positionSide&quot;</span>: <span class="hljs-string">&quot;Short&quot;</span>,
            <span class="hljs-attr">&quot;newCollateral&quot;</span>: <span class="hljs-string">&quot;999990.8488&quot;</span>,
            <span class="hljs-attr">&quot;ddxFeeElection&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">&quot;newPositionBalance&quot;</span>: <span class="hljs-string">&quot;2.46&quot;</span>,
            <span class="hljs-attr">&quot;newPositionAvgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1860&quot;</span>
        },
        <span class="hljs-attr">&quot;makerOrderHash&quot;</span>: <span class="hljs-string">&quot;0x542ad7f2640447d3e93723253099fd45ae721925e0df64702e&quot;</span>,
        <span class="hljs-attr">&quot;takerOrderHash&quot;</span>: <span class="hljs-string">&quot;0x100d1edd45edede9eedc0e3aac28e7df17168fbef9b459ffc8&quot;</span>,
        <span class="hljs-attr">&quot;makerOrderRemainingAmount&quot;</span>: <span class="hljs-string">&quot;2.54&quot;</span>
    }]
}</code></pre>
            <p>A <code>CompleteFill</code> is a scenario where the taker order has been completely filled across 1 or more maker orders. The event portion of the transaction response consists of a list of <code>TradeFill</code> events.</p>
            <h4 id="post-1">Post</h4>
            <blockquote>
               <p>Sample Post (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Bid&quot;</span>,
        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;1870.25&quot;</span>,
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1.39&quot;</span>,
        <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
        <span class="hljs-attr">&quot;orderHash&quot;</span>: <span class="hljs-string">&quot;0x860b1065b629df495de7a0d97432a48b098cadcbb37a1fdbd9&quot;</span>,
        <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
        <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>
    }
}</code></pre>
            <p>A <code>Post</code> is an order that enters the order book. The event portion of the transaction has attributes defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.amount</td>
                     <td>Size of order posted to the order book</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>event.orderHash</td>
                     <td>Hexstr representation of the first 25 bytes of the unique EIP-712 hash of the order being placed</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.price</td>
                     <td>Price the order has been placed at</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.side</td>
                     <td>Side of order (<code>Bid</code> or <code>Ask</code>)</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.strategyId</td>
                     <td>Strategy ID this order belongs to (e.g. &quot;main&quot;)</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.symbol</td>
                     <td>Symbol for the market this order has been placed (e.g. <code>ETHPERP</code>)</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>event.bookOrdinal</td>
                     <td>Numerical value signifying sequence of order placement, which can be used to arrange multiple orders at the same price level to achieve FIFO priority in a local order book</td>
                  </tr>
                  <tr>
                     <td>address_pre_s</td>
                     <td>event.traderAddress</td>
                     <td>Trader&#39;s Ethereum address prefixed with the chain discriminant</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="cancel">Cancel</h4>
            <blockquote>
               <p>Sample Cancel (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1.39&quot;</span>,
        <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
        <span class="hljs-attr">&quot;orderHash&quot;</span>: <span class="hljs-string">&quot;0x860b1065b629df495de7a0d97432a48b098cadcbb37a1fdbd9&quot;</span>
    }
}</code></pre>
            <p>A <code>Cancel</code> is when an existing order is canceled and removed from the order book. The event portion of the transaction has attributes defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.amount</td>
                     <td>Size of order canceled from the order book</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.symbol</td>
                     <td>Symbol for the market this order has been canceled (e.g. <code>ETHPERP</code>)</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>event.orderHash</td>
                     <td>Hexstr representation of the first 25 bytes of the unique EIP-712 hash of the order being canceled</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="liquidation">Liquidation</h4>
            <p>TBD</p>
            <h4 id="strategy-update-1">Strategy update</h4>
            <blockquote>
               <p>Sample StrategyUpdate (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1000000&quot;</span>,
        <span class="hljs-attr">&quot;trader&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
        <span class="hljs-attr">&quot;txHash&quot;</span>: <span class="hljs-string">&quot;0x239a452c6abc453e153c8c53e4bdb995c558619b3aa1980c8977cbc4c283618f&quot;</span>,
        <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
        <span class="hljs-attr">&quot;updateType&quot;</span>: <span class="hljs-string">&quot;Deposit&quot;</span>,
        <span class="hljs-attr">&quot;collateralAddress&quot;</span>: <span class="hljs-string">&quot;0xb69e673309512a9d726f87304c6984054f87a93b&quot;</span>
    }
}</code></pre>
            <p>A <code>StrategyUpdate</code> is an update to a trader&#39;s strategy (such as depositing or withdrawing collateral). The event portion of the transaction has attributes defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.amount</td>
                     <td>Amount deposited or withdrawn</td>
                  </tr>
                  <tr>
                     <td>address_pre_s</td>
                     <td>event.trader</td>
                     <td>Trader&#39;s Ethereum address prefixed with the chain discriminant</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>event.txHash</td>
                     <td>Ethereum transaction hash for the on-chain deposit / withdrawal</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.strategyId</td>
                     <td>Strategy ID deposited to or withdrawn from (e.g. &quot;main&quot;)</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.updateType</td>
                     <td>Action corresponding to either &quot;Deposit&quot; or &quot;Withdraw&quot;</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>event.collateralAddress</td>
                     <td>Deposited / withdrawn collateral token&#39;s Ethereum address</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="trader-update">Trader update</h4>
            <blockquote>
               <p>Sample TraderUpdate (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1000000&quot;</span>,
        <span class="hljs-attr">&quot;trader&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
        <span class="hljs-attr">&quot;txHash&quot;</span>: <span class="hljs-string">&quot;0x239a452c6abc453e153c8c53e4bdb995c558619b3aa1980c8977cbc4c283618f&quot;</span>,
        <span class="hljs-attr">&quot;updateType&quot;</span>: <span class="hljs-string">&quot;Deposit&quot;</span>
    }
}</code></pre>
            <p>A <code>TraderUpdate</code> is an update to a trader&#39;s DDX account (such as depositing or withdrawing DDX). The event portion of the transaction has attributes defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.amount</td>
                     <td>Amount of DDX deposited or withdrawn</td>
                  </tr>
                  <tr>
                     <td>address_pre_s</td>
                     <td>event.trader</td>
                     <td>Trader&#39;s Ethereum address prefixed with the chain discriminant</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>event.txHash</td>
                     <td>Ethereum transaction hash for the on-chain deposit / withdrawal</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.updateType</td>
                     <td>Action corresponding to either &quot;Deposit&quot; or &quot;Withdraw&quot;</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="withdraw-1">Withdraw</h4>
            <blockquote>
               <p>Sample Withdraw (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code> {
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1000&quot;</span>,
        <span class="hljs-attr">&quot;currency&quot;</span>: <span class="hljs-string">&quot;0xb69e673309512a9d726f87304c6984054f87a93b&quot;</span>,
        <span class="hljs-attr">&quot;strategy&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
        <span class="hljs-attr">&quot;signerAddress&quot;</span>: <span class="hljs-string">&quot;0x6ecbe1db9ef729cbe972c83fb886247691fb6beb&quot;</span>,
        <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x006ecbe1db9ef729cbe972c83fb886247691fb6beb&quot;</span>
    }
 }</code></pre>
            <p>A <code>Withdraw</code> is when a withdrawal of a collateral token is signaled. The event portion of the transaction has attributes defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.amount</td>
                     <td>Amount of collateral token withdrawal has been signaled for</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>event.currency</td>
                     <td>Collateral ERC-20 token address</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.strategy</td>
                     <td>Strategy ID the withdrawal applies to</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>event.signerAddress</td>
                     <td>Signer&#39;s Ethereum address withdrawal is taking place from</td>
                  </tr>
                  <tr>
                     <td>address_pre_s</td>
                     <td>event.traderAddress</td>
                     <td>Trader&#39;s Ethereum address prefixed with the chain discriminant collateral is being withdrawn to</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="withdraw-ddx">Withdraw DDX</h4>
            <blockquote>
               <p>Sample WithdrawDDX (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;100&quot;</span>,
        <span class="hljs-attr">&quot;signerAddress&quot;</span>: <span class="hljs-string">&quot;0xa8dda8d7f5310e4a9e24f8eba77e091ac264f872&quot;</span>,
        <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00603699848c84529987e14ba32c8a66def67e9ece&quot;</span>
    }
}</code></pre>
            <p>A <code>WithdrawDDX</code> is when a withdrawal of DDX is signaled. The event portion of the transaction has attributes defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.amount</td>
                     <td>Amount of DDX withdrawal has been signaled for</td>
                  </tr>
                  <tr>
                     <td>address_s</td>
                     <td>event.signerAddress</td>
                     <td>Signer&#39;s Ethereum address withdrawal is taking place from</td>
                  </tr>
                  <tr>
                     <td>address_pre_s</td>
                     <td>event.traderAddress</td>
                     <td>Trader&#39;s Ethereum address prefixed with the chain discriminant DDX is being withdrawn to</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="price-checkpoint-1">Price checkpoint</h4>
            <blockquote>
               <p>Sample PriceCheckpoint (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>
{
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;ETHPERP&quot;</span>: {
            <span class="hljs-attr">&quot;ema&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
            <span class="hljs-attr">&quot;indexPrice&quot;</span>: <span class="hljs-string">&quot;1874.075454545454545454&quot;</span>,
            <span class="hljs-attr">&quot;indexPriceHash&quot;</span>: <span class="hljs-string">&quot;0xa35d3dac391cc18671daacab1c393554aac1546a2cbfe630da1e4e86fb44f542&quot;</span>
        }
    }
}</code></pre>
            <p>A <code>PriceCheckpoint</code> is when a market registers an update to the composite index price a perpetual is tracking along with the ema component. The event portion of the transaction essentially emits the latest <code>Price</code> leaf contents, and is defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.symbol</td>
                     <td>The market name for which this <code>PriceCheckpoint</code> transaction applies</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.symbol.ema</td>
                     <td>Captures a smoothed average of the spread between the underlying index price and the DerivaDEX order book for the market</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.symbol.indexPrice</td>
                     <td>Composite index price (a weighted average across several price feed sources)</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>event.symbol.indexPriceHash</td>
                     <td>Index price hash</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="pnl-settlement">PNL Settlement</h4>
            <blockquote>
               <p>Sample PnlSettlement (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;timeValue&quot;</span>: <span class="hljs-number">2166</span>,
        <span class="hljs-attr">&quot;settlementEpochId&quot;</span>: <span class="hljs-number">19</span>
    }
}</code></pre>
            <p>A <code>PNLSettlement</code> is when a there is a PNL settlement event. This event realizes the PNL of all open positions and adjusts the average entry price to the current mark price. The event portion of the transaction has attributes defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>event.settlementEpochId</td>
                     <td>The epoch id for the PNL settlement event</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>event.timeValue</td>
                     <td>Time value</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="funding">Funding</h4>
            <blockquote>
               <p>Sample Funding (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;timeValue&quot;</span>: <span class="hljs-number">1766</span>,
        <span class="hljs-attr">&quot;fundingRates&quot;</span>: {
            <span class="hljs-attr">&quot;ETHPERP&quot;</span>: <span class="hljs-string">&quot;0.0024&quot;</span>
        },
        <span class="hljs-attr">&quot;settlementEpochId&quot;</span>: <span class="hljs-number">15</span>
    }
}</code></pre>
            <p>A <code>Funding</code> is when a there is a funding rate distribution. At this time, all strategies are either credited or debited an amount based on the current funding rate and their position notional values and side. The event portion of the transaction has attributes defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>event.timeValue</td>
                     <td>Time value</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>event.settlementEpochId</td>
                     <td>The epoch id for the funding event</td>
                  </tr>
                  <tr>
                     <td>dict&lt;string, decimal_s&gt;</td>
                     <td>event.fundingRates</td>
                     <td>Mapping of market symbol to funding rate</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="trade-mining">Trade mining</h4>
            <blockquote>
               <p>Sample TradeMining (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;timeValue&quot;</span>: <span class="hljs-number">1766</span>,
        <span class="hljs-attr">&quot;totalVolume&quot;</span>: {
            <span class="hljs-attr">&quot;makerVolume&quot;</span>: <span class="hljs-string">&quot;41249.393239489105059823&quot;</span>,
            <span class="hljs-attr">&quot;takerVolume&quot;</span>: <span class="hljs-string">&quot;40101.194995030184814398&quot;</span>
        },
        <span class="hljs-attr">&quot;ddxDistributed&quot;</span>: <span class="hljs-string">&quot;3192.388588391993848193&quot;</span>,
        <span class="hljs-attr">&quot;tradeMiningEpochId&quot;</span>: <span class="hljs-number">15</span>
    }
}</code></pre>
            <p>A <code>TradeMining</code> is when there is a trade mining distribution. Traders will receive a portion of the overall DDX distributed proportional to their volume traded that interval. Makers will receive 20% of the DDX allocation and takers will receive 80% of the allocation. The event portion of the transaction has attributes defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>event.timeValue</td>
                     <td>Time value</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>event.totalVolume</td>
                     <td>Holds the total volume information for this trade mining interval</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.totalVolume.makerVolume</td>
                     <td>Maker volume total for this trade mining interval</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.totalVolume.takerVolume</td>
                     <td>Taker volume total for this trade mining interval. Note that this number may be &lt;= the <code>makerTotalVolume</code>, and any discrepancy is due to liquidations only counting towards maker allocation (i.e. the liquidation engine does not receive any DDX per trade mining)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.ddxDistributed</td>
                     <td>Total DDX distributed for trade mining for this interval</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>event.tradeMiningEpochId</td>
                     <td>Interval counter for when trade mining occurred</td>
                  </tr>
               </tbody>
            </table>
            <h4 id="tradefill">TradeFill</h4>
            <blockquote>
               <p>Sample TradeFill (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;event&quot;</span>: {
        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;1860&quot;</span>,
        <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;1.23&quot;</span>,
        <span class="hljs-attr">&quot;reason&quot;</span>: <span class="hljs-string">&quot;Trade&quot;</span>,
        <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
        <span class="hljs-attr">&quot;takerSide&quot;</span>: <span class="hljs-string">&quot;Ask&quot;</span>,
        <span class="hljs-attr">&quot;makerOutcome&quot;</span>: {
            <span class="hljs-attr">&quot;fee&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
            <span class="hljs-attr">&quot;trader&quot;</span>: <span class="hljs-string">&quot;0x006ecbe1db9ef729cbe972c83fb886247691fb6beb&quot;</span>,
            <span class="hljs-attr">&quot;strategy&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
            <span class="hljs-attr">&quot;realizedPnl&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
            <span class="hljs-attr">&quot;positionSide&quot;</span>: <span class="hljs-string">&quot;Long&quot;</span>,
            <span class="hljs-attr">&quot;newCollateral&quot;</span>: <span class="hljs-string">&quot;1000000&quot;</span>,
            <span class="hljs-attr">&quot;ddxFeeElection&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">&quot;newPositionBalance&quot;</span>: <span class="hljs-string">&quot;2.46&quot;</span>,
            <span class="hljs-attr">&quot;newPositionAvgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1860&quot;</span>
        },
        <span class="hljs-attr">&quot;takerOutcome&quot;</span>: {
            <span class="hljs-attr">&quot;fee&quot;</span>: <span class="hljs-string">&quot;4.5756&quot;</span>,
            <span class="hljs-attr">&quot;trader&quot;</span>: <span class="hljs-string">&quot;0x00e36ea790bc9d7ab70c55260c66d52b1eca985f84&quot;</span>,
            <span class="hljs-attr">&quot;strategy&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
            <span class="hljs-attr">&quot;realizedPnl&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,
            <span class="hljs-attr">&quot;positionSide&quot;</span>: <span class="hljs-string">&quot;Short&quot;</span>,
            <span class="hljs-attr">&quot;newCollateral&quot;</span>: <span class="hljs-string">&quot;999990.8488&quot;</span>,
            <span class="hljs-attr">&quot;ddxFeeElection&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">&quot;newPositionBalance&quot;</span>: <span class="hljs-string">&quot;2.46&quot;</span>,
            <span class="hljs-attr">&quot;newPositionAvgEntryPrice&quot;</span>: <span class="hljs-string">&quot;1860&quot;</span>
        },
        <span class="hljs-attr">&quot;makerOrderHash&quot;</span>: <span class="hljs-string">&quot;0x542ad7f2640447d3e93723253099fd45ae721925e0df64702e&quot;</span>,
        <span class="hljs-attr">&quot;takerOrderHash&quot;</span>: <span class="hljs-string">&quot;0x100d1edd45edede9eedc0e3aac28e7df17168fbef9b459ffc8&quot;</span>,
        <span class="hljs-attr">&quot;makerOrderRemainingAmount&quot;</span>: <span class="hljs-string">&quot;2.54&quot;</span>
    }
}</code></pre>
            <p>A <code>TradeFill</code> is when there is a fill / match that has taken place. Technically, a <code>TradeFill</code> is not a transaction in it of itself, but rather a part of <code>CompleteFill</code> and <code>PartialFill</code> transactions. We often look to these individual <code>TradeFill</code> events as their own dedicated transaction type, however, for Traders to subscribe to and follow as they would other transactions. The event portion of the transaction has attributes defined as follows:</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>dict</td>
                     <td>event</td>
                     <td>The contents of the transaction event</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>event.price</td>
                     <td>Price the fill took place</td>
                  </tr>
                  <tr>
                     <td>decimal</td>
                     <td>event.amount</td>
                     <td>Size of the fill</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.reason</td>
                     <td>Reason for fill (<code>Trade</code>, <code>Liquidation</code>)</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.symbol</td>
                     <td>Market symbol for which this fill took place</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.takerSide</td>
                     <td>Taker / aggressor side (<code>Bid</code>, <code>Ask</code>)</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>event.makerOutcome</td>
                     <td>Data containing the some relevant information pertaining to the maker in the trade</td>
                  </tr>
                  <tr>
                     <td>address_pre_s</td>
                     <td>event.makerOutcome.traderAddress</td>
                     <td>Maker trader&#39;s Ethereum address prefixed with the chain discrimimant</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.makerOutcome.strategyId</td>
                     <td>Cross-margined strategy identifier for the maker trader</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.makerOutcome.fee</td>
                     <td>Fees paid by the maker as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>bool</td>
                     <td>event.makerOutcome.ddxFeeElection</td>
                     <td>Whether maker fees are being paid in DDX (<code>true</code>) or USDC (<code>false</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.makerOutcome.realizedPNL</td>
                     <td>Realized profits and losses for the maker as a result of the trade (not including fees)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.makerOutcome.newCollateral</td>
                     <td>New free collateral in maker trader&#39;s strategy as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.makerOutcome.newPositionAvgEntryPrice</td>
                     <td>New average entry price for maker&#39;s position as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.makerOutcome.newPositionBalance</td>
                     <td>New size for maker&#39;s position as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>event..makerOutcome.positionSide</td>
                     <td>New side for maker&#39;s position (<code>long=1</code>, <code>short=2</code>) as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>event.takerOutcome</td>
                     <td>Data containing the some relevant information pertaining to the taker in the trade</td>
                  </tr>
                  <tr>
                     <td>address_pre_s</td>
                     <td>event.takerOutcome.traderAddress</td>
                     <td>Taker trader&#39;s Ethereum address prefixed with the chain discrimimant</td>
                  </tr>
                  <tr>
                     <td>string</td>
                     <td>event.takerOutcome.strategyId</td>
                     <td>Cross-margined strategy identifier for the taker trader</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event..takerOutcome.fee</td>
                     <td>Fees paid by the taker as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>bool</td>
                     <td>event.takerOutcome.ddxFeeElection</td>
                     <td>Whether taker fees are being paid in DDX (<code>true</code>) or USDC (<code>false</code>)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.takerOutcome.realizedPNL</td>
                     <td>Realized profits and losses for the taker as a result of the trade (not including fees)</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.takerOutcome.newCollateral</td>
                     <td>New free collateral in taker trader&#39;s strategy as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.takerOutcome.newPositionAvgEntryPrice</td>
                     <td>New average entry price for taker&#39;s position as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>decimal_s</td>
                     <td>event.takerOutcome.newPositionBalance</td>
                     <td>New size for taker&#39;s position as a result of the trade</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>event.takerOutcome.positionSide</td>
                     <td>New side for taker&#39;s position (<code>long=1</code>, <code>short=2</code>) as a result of the trade</td>
                  </tr>
               </tbody>
            </table>
            <h3 id="subscription">Subscription</h3>
            <p>You may subscribe to the SMT state leaves and transaction log in raw fashion (much like how the Auditor does behind the scenes prior to exposing a clean API for your consumption).</p>
            <p>Operator transaction log WS endpoint URL: wss://api.derivadex.io/node0/v2/txlog</p>
            <h4 id="response-15">Response</h4>
            <blockquote>
               <p>Snapshot response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Snapshot&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;epochId&quot;</span>: <span class="hljs-number">169</span>,
        <span class="hljs-attr">&quot;leaves&quot;</span>: {
            <span class="hljs-attr">&quot;0x04820e582404007b98abbb2526d07a2cdc0d67f35907d62f0e21bbbe45e9961a&quot;</span>: <span class="hljs-string">&quot;0x0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000e576eaa6c85d2cd80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000147a&quot;</span>,
            <span class="hljs-attr">&quot;0x03852258240400788b9b1a5b0add97f65952f7cbe9a86b2a8e5f6bfeb5bbf534&quot;</span>: <span class="hljs-string">&quot;0x000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000004563918244f400000000000000000000000000000000000000000000000001064092f6c4533a000000e36ea790bc9d7ab70c55260c66d52b1eca985f8400000000000000000000002576ebd10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000149ab&quot;</span>,
            <span class="hljs-attr">&quot;0x04820e582404001de62df182b9019c994b3d82deb541ddca7c086a8ff691902d&quot;</span>: <span class="hljs-string">&quot;0x0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000e1b23e43485b035c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001281&quot;</span>,
            <span class="hljs-attr">&quot;0x04820e58240400f1771fba7a7e4a9365b0e06d5ac603bd60f7f871edbcf1e0ab&quot;</span>: <span class="hljs-string">&quot;0x0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000e54354372e48b48400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000144&quot;</span>
        },
        <span class="hljs-attr">&quot;offset&quot;</span>: <span class="hljs-number">0</span>
    }
}</code></pre>
            <p>Upon subscription, you will first receive a set of <code>Snapshot</code> entries back, containing a snapshot of the DerivaDEX state as of the latest checkpoint. DerivaDEX has on-chain checkpoints roughly every 10 minutes. Say you were to connect to the API and subscribe to this endpoint 7 minutes after Checkpoint 168 had completed (i.e., Checkpoint 169 had begun). You would first receive the entire state as of Checkpoint 169.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to, which in this case will be <code>Snapshot</code></td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c</td>
                     <td><code>Snapshot</code> WebSocket message contents</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>epochId</td>
                     <td>Current epoch ID</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>leaves</td>
                     <td>Snapshot leaf data</td>
                  </tr>
                  <tr>
                     <td>dict&lt;bytes32_s, bytes_s&gt;</td>
                     <td>leaves</td>
                     <td>Snapshot leaf data mapping leaf key to leaf value (ABI-encoding of SMT leaf&#39;s value)</td>
                  </tr>
               </tbody>
            </table>
            <blockquote>
               <p>Head response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Head&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;epochId&quot;</span>: <span class="hljs-number">169</span>,
        <span class="hljs-attr">&quot;ordinal&quot;</span>: <span class="hljs-number">14</span>,
        <span class="hljs-attr">&quot;stateRootHash&quot;</span>: <span class="hljs-string">&quot;0xe0870028a6d8f2dd98961a15b27279d5a1e7deedea3b55e8342e06ce81ea5d9c&quot;</span>,
        <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">282626</span>,
        <span class="hljs-attr">&quot;batchId&quot;</span>: <span class="hljs-number">282626</span>,
        <span class="hljs-attr">&quot;event&quot;</span>: {
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Post&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;orderHash&quot;</span>: <span class="hljs-string">&quot;0x773ac90b2eefd0b7e772b6f59c41d2ae8b2f7ad17985d94fd3&quot;</span>,
                <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e834ec434daba538cd1b9fe1582052b880bd7e63&quot;</span>,
                <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
                <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
                <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Bid&quot;</span>,
                <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;4831.9&quot;</span>,
                <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;5.4&quot;</span>,
                <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">95749</span>
            }
        },
        <span class="hljs-attr">&quot;signature&quot;</span>: <span class="hljs-string">&quot;0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;</span>
    }
}</code></pre>
            <p>After the snapshot messages, you will next receive a set of <code>Head</code> entries back, containing all of the transactions that have already occurred from the beginning of this epoch to now. Say you were to connect to the API and subscribe to this endpoint 7 minutes after Checkpoint 168 had completed (i.e., Checkpoint 169 had begun). You would receive all the transactions that have occurred during these 7 minutes.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to, which in this case will be <code>Head</code></td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c</td>
                     <td><code>Head</code> WebSocket message contents</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.epochId</td>
                     <td>Current epoch ID</td>
                  </tr>
                  <tr>
                     <td>int_s</td>
                     <td>c.ordinal</td>
                     <td>Monotonically increasing numerical value representing when a transaction took place in a given epoch. This will necessarily increase by 1 in order of being processed, and will only be reset to 0 when a new epoch has begun.</td>
                  </tr>
                  <tr>
                     <td>int_s</td>
                     <td>c.requestIndex</td>
                     <td>Sequenced identifier for the request initially made. This will be the same as the <code>requestIndex</code> you receive in a successful <code>command</code>.</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.stateRootHash</td>
                     <td>SMT&#39;s state root hash prior to the transaction being applied</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.batchId</td>
                     <td>Monotonically increasing numerical value representing when a batch of transactions took place in a given epoch. This is different from the transaction&#39;s ordinal value, which may actually be the same across transactions that are batched (e.g., multiple deposits in the same Ethereum block, or settlement transactions bunched together).</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.signature</td>
                     <td>Enclave&#39;s signature of transaction data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.event</td>
                     <td>Event data (structure and contents are different depending on the kind of event). Examples for each transaction type are shown above in the <a href="#transactions">Transactions</a> section.</td>
                  </tr>
               </tbody>
            </table>
            <blockquote>
               <p>Tail response (JSON)</p>
            </blockquote>
            <pre class="highlight json"><code>{
    <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Tail&quot;</span>,
    <span class="hljs-attr">&quot;c&quot;</span>: {
        <span class="hljs-attr">&quot;epochId&quot;</span>: <span class="hljs-number">169</span>,
        <span class="hljs-attr">&quot;ordinal&quot;</span>: <span class="hljs-number">691</span>,
        <span class="hljs-attr">&quot;stateRootHash&quot;</span>: <span class="hljs-string">&quot;0xb359790e85a5f4d9b0a9b5317ec0f28a1c28fab368d155eeedd29fb96c2999f2&quot;</span>,
        <span class="hljs-attr">&quot;requestIndex&quot;</span>: <span class="hljs-number">283687</span>,
        <span class="hljs-attr">&quot;batchId&quot;</span>: <span class="hljs-number">283687</span>,
        <span class="hljs-attr">&quot;event&quot;</span>: {
            <span class="hljs-attr">&quot;t&quot;</span>: <span class="hljs-string">&quot;Post&quot;</span>,
            <span class="hljs-attr">&quot;c&quot;</span>: {
                <span class="hljs-attr">&quot;orderHash&quot;</span>: <span class="hljs-string">&quot;0x97824f71decfaba632ea794fa648f772e64d0bc90ddd397995&quot;</span>,
                <span class="hljs-attr">&quot;traderAddress&quot;</span>: <span class="hljs-string">&quot;0x00e834ec434daba538cd1b9fe1582052b880bd7e63&quot;</span>,
                <span class="hljs-attr">&quot;strategyId&quot;</span>: <span class="hljs-string">&quot;main&quot;</span>,
                <span class="hljs-attr">&quot;symbol&quot;</span>: <span class="hljs-string">&quot;ETHPERP&quot;</span>,
                <span class="hljs-attr">&quot;side&quot;</span>: <span class="hljs-string">&quot;Ask&quot;</span>,
                <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-string">&quot;4803.9&quot;</span>,
                <span class="hljs-attr">&quot;amount&quot;</span>: <span class="hljs-string">&quot;6.2&quot;</span>,
                <span class="hljs-attr">&quot;bookOrdinal&quot;</span>: <span class="hljs-number">95936</span>
            }
        },
        <span class="hljs-attr">&quot;signature&quot;</span>: <span class="hljs-string">&quot;0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;</span>
    }
}</code></pre>
            <p>After the head messages, you will next receive <code>Tail</code> entries one by one streaming through with every new transaction processed.</p>
            <table>
               <thead>
                  <tr>
                     <th>type</th>
                     <th>field</th>
                     <th>description</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>string</td>
                     <td>t</td>
                     <td>WebSocket message type, pertaining to the topic subscribed to, which in this case will be <code>Tail</code></td>
                  </tr>
                  <tr>
                     <td>list</td>
                     <td>c</td>
                     <td><code>Tail</code> WebSocket message contents</td>
                  </tr>
                  <tr>
                     <td>int</td>
                     <td>c.epochId</td>
                     <td>Current epoch ID</td>
                  </tr>
                  <tr>
                     <td>int_s</td>
                     <td>c.ordinal</td>
                     <td>Monotonically increasing numerical value representing when a transaction took place in a given epoch. This will necessarily increase by 1 in order of being processed, and will only be reset to 0 when a new epoch has begun.</td>
                  </tr>
                  <tr>
                     <td>int_s</td>
                     <td>c.requestIndex</td>
                     <td>Sequenced identifier for the request initially made. This will be the same as the <code>requestIndex</code> you receive in a successful <code>command</code>.</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.stateRootHash</td>
                     <td>SMT&#39;s state root hash prior to the transaction being applied</td>
                  </tr>
                  <tr>
                     <td>bytes32_s</td>
                     <td>c.batchId</td>
                     <td>Monotonically increasing numerical value representing when a batch of transactions took place in a given epoch. This is different from the transaction&#39;s ordinal value, which may actually be the same across transactions that are batched (e.g., multiple deposits in the same Ethereum block, or settlement transactions bunched together).</td>
                  </tr>
                  <tr>
                     <td>bytes_s</td>
                     <td>c.signature</td>
                     <td>Enclave&#39;s signature of transaction data</td>
                  </tr>
                  <tr>
                     <td>dict</td>
                     <td>c.event</td>
                     <td>Event data (structure and contents are different depending on the kind of event). Examples for each transaction type are shown above in the <a href="#transactions">Transactions</a> section.</td>
                  </tr>
               </tbody>
            </table>
            <h1 id="validation">Validation</h1>
            <h2 id="order-notional">Order notional</h2>
            <p>You will not be able to place orders exceeding $1,000,000 in notional. The notional value of an order is computed as follows: <code>notional = order_amount * mark_price</code>.</p>
            <h2 id="omf--imf">OMF &lt; IMF</h2>
            <p>You will not be able to place orders if the resulting open margin fraction (OMF) would become less than the initial margin fraction (IMF).</p>
            <h2 id="max-taker-price-deviation">Max taker price deviation</h2>
            <p>You will not be able to place a limit order at a price more than 2% through the best level on the other side of the book. In other words, you cannot place a limit buy order at a price greater than 2% higher than the lowest available offer. Conversely, you cannot place a limit sell order at a price less than 2% lower than the highest available bid. If there is no liquidity on the other side of the book, the mark price is used instead.</p>
            <h2 id="self-match-prevention">Self-match prevention</h2>
            <p>You will not be able to trade against yourself. Although this is technically not an API validation, it is worth mentioning here regardless. The self-match rules are such that the remainder of the incoming order will be canceled if it were to self-match.</p>
            <h1 id="rate-limits">Rate limits</h1>
            <p>The websocket API will (eventually) use tiers to determine rate limits for each ethereum account. Rate limits restrict the number of &quot;Commands&quot; an account can place per minute.</p>
            <p>Subscriptions are not rate limited.</p>
            <h1 id="errors">Errors</h1>
            <aside class=error> This error section is stored in a separate file in `includes/_errors.md`. Slate allows you to optionally separate out your docs into many files...just save them to the `includes` folder and add them to the top of your `index.md`'s front matter. Files are included in the order listed. </aside>
            <p>The DerivaDEX API uses the following error codes:</p>
            <p>TBD</p>
         </div>
         <div class=dark-box>
            <div class=lang-selector>
               <a href=# data-language-name="json">json</a>
               <a href=# data-language-name="solidity">solidity</a>
               <a href=# data-language-name="python">python</a>
            </div>
         </div>
      </div>
   </body>
</html>